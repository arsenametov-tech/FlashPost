<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Editor Fix - updateAllControls</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #0f0f14 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            font-family: 'Inter', sans-serif;
            padding: 20px;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .test-button {
            background: linear-gradient(45deg, #833ab4, #fd1d1d);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
            font-size: 16px;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(131, 58, 180, 0.3);
        }
        
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .status-success {
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
            color: #28a745;
        }
        
        .status-error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            color: #dc3545;
        }
        
        .status-info {
            background: rgba(23, 162, 184, 0.2);
            border: 1px solid #17a2b8;
            color: #17a2b8;
        }
        
        .code-block {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîß Test Editor Fix - updateAllControls</h1>
        <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ "this.editor.updateAllControls is not a function"</p>
        
        <!-- –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–µ—Ç–æ–¥–∞ -->
        <div class="test-section">
            <h2>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–µ—Ç–æ–¥–∞ updateAllControls</h2>
            <button class="test-button" onclick="testMethodExists()">
                –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–∞
            </button>
            <div id="methodResults"></div>
        </div>
        
        <!-- –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ Editor -->
        <div class="test-section">
            <h2>üèóÔ∏è –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ Editor</h2>
            <button class="test-button" onclick="testEditorCreation()">
                –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä Editor
            </button>
            <div id="creationResults"></div>
        </div>
        
        <!-- –¢–µ—Å—Ç 3: –í—ã–∑–æ–≤ updateAllControls -->
        <div class="test-section">
            <h2>üöÄ –¢–µ—Å—Ç –≤—ã–∑–æ–≤–∞ updateAllControls</h2>
            <button class="test-button" onclick="testUpdateAllControls()">
                –í—ã–∑–≤–∞—Ç—å updateAllControls
            </button>
            <div id="callResults"></div>
        </div>
        
        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ -->
        <div class="test-section">
            <h2>üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏</h2>
            <div class="status status-info">
                <strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –û—à–∏–±–∫–∞ "this.editor.updateAllControls is not a function"<br>
                <strong>–ü—Ä–∏—á–∏–Ω–∞:</strong> –ú–µ—Ç–æ–¥ updateAllControls –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª –≤ –∫–ª–∞—Å—Å–µ Editor<br>
                <strong>–†–µ—à–µ–Ω–∏–µ:</strong> –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ updateAllControls –≤ flashpost-mini-app/src/editor.js
            </div>
            
            <h3>–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥:</h3>
            <div class="code-block">
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–ª–∞–π–¥–∞
updateAllControls() {
    console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞...');
    
    try {
        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–Ω—Ç—Ä–æ–ª—ã —Ñ–æ–Ω–∞
        this.updateBackgroundControls();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ñ–æ–Ω–∞
        this.updateSlideBackgroundDisplay();
        
        // –ï—Å–ª–∏ –µ—Å—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–π –±–ª–æ–∫, –æ–±–Ω–æ–≤–ª—è–µ–º –µ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—ã
        if (this.selectedBlockId) {
            const activeSlide = this.state.getActiveSlide();
            if (activeSlide) {
                const block = activeSlide.textBlocks && 
                    activeSlide.textBlocks.find(b => b.id === this.selectedBlockId);
                if (block) {
                    this.updateFontControlsWithoutFocus(this.selectedBlockId);
                }
            }
        }
        
        console.log('‚úÖ –í—Å–µ –∫–æ–Ω—Ç—Ä–æ–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
    } catch (error) {
        console.warn('‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤:', error);
    }
}
            </div>
        </div>
        
        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="test-section">
            <h2>üìä –û–±—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
            <div id="overallResults">
                <p>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤—ã—à–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è...</p>
            </div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <script src="flashpost-mini-app/src/state.js"></script>
    <script src="flashpost-mini-app/src/renderer.js"></script>
    <script src="flashpost-mini-app/src/editor.js"></script>
    
    <script>
        let testResults = {
            methodExists: false,
            editorCreation: false,
            methodCall: false
        };

        function showResult(containerId, message, type) {
            const container = document.getElementById(containerId);
            const statusClass = `status-${type}`;
            
            container.innerHTML = `
                <div class="status ${statusClass}">
                    ${message}
                </div>
            `;
        }

        function updateOverallResults() {
            const container = document.getElementById('overallResults');
            const passed = Object.values(testResults).filter(r => r).length;
            const total = Object.keys(testResults).length;
            
            let html = `<h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${passed}/${total}</h3>`;
            
            for (const [test, result] of Object.entries(testResults)) {
                const status = result ? '‚úÖ' : '‚ùå';
                const testName = {
                    methodExists: '–ù–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–∞',
                    editorCreation: '–°–æ–∑–¥–∞–Ω–∏–µ Editor',
                    methodCall: '–í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞'
                }[test];
                
                html += `<div class="status ${result ? 'status-success' : 'status-error'}">
                    ${status} ${testName}
                </div>`;
            }
            
            if (passed === total) {
                html += `<div class="status status-success">
                    üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã! –û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞.
                </div>`;
            }
            
            container.innerHTML = html;
        }

        function testMethodExists() {
            showResult('methodResults', 'üîÑ –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–∞ updateAllControls...', 'info');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–ª–∞—Å—Å Editor —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                if (typeof Editor === 'undefined') {
                    throw new Error('–ö–ª–∞—Å—Å Editor –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–µ—Ç–æ–¥ updateAllControls —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ø—Ä–æ—Ç–æ—Ç–∏–ø–µ
                if (typeof Editor.prototype.updateAllControls !== 'function') {
                    throw new Error('–ú–µ—Ç–æ–¥ updateAllControls –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–ª–∞—Å—Å–µ Editor');
                }
                
                testResults.methodExists = true;
                showResult('methodResults', '‚úÖ –ú–µ—Ç–æ–¥ updateAllControls –Ω–∞–π–¥–µ–Ω –≤ –∫–ª–∞—Å—Å–µ Editor!', 'success');
                
            } catch (error) {
                testResults.methodExists = false;
                showResult('methodResults', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
            
            updateOverallResults();
        }

        function testEditorCreation() {
            showResult('creationResults', 'üîÑ –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä Editor...', 'info');
            
            try {
                // –°–æ–∑–¥–∞–µ–º mock –æ–±—ä–µ–∫—Ç—ã –¥–ª—è StateManager –∏ Renderer
                const mockState = {
                    getActiveSlide: () => null,
                    setPropertyChangeCallback: () => {}
                };
                
                const mockRenderer = {
                    render: () => {}
                };
                
                // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä Editor
                const editor = new Editor(mockState, mockRenderer);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º–µ—Ç–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                if (typeof editor.updateAllControls !== 'function') {
                    throw new Error('–ú–µ—Ç–æ–¥ updateAllControls –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —ç–∫–∑–µ–º–ø–ª—è—Ä–µ');
                }
                
                testResults.editorCreation = true;
                showResult('creationResults', '‚úÖ –≠–∫–∑–µ–º–ø–ª—è—Ä Editor —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ —Å –º–µ—Ç–æ–¥–æ–º updateAllControls!', 'success');
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ç–µ—Å—Ç–∞
                window.testEditor = editor;
                
            } catch (error) {
                testResults.editorCreation = false;
                showResult('creationResults', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
            
            updateOverallResults();
        }

        function testUpdateAllControls() {
            showResult('callResults', 'üîÑ –í—ã–∑—ã–≤–∞–µ–º updateAllControls...', 'info');
            
            try {
                if (!window.testEditor) {
                    throw new Error('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —ç–∫–∑–µ–º–ø–ª—è—Ä Editor');
                }
                
                // –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥
                window.testEditor.updateAllControls();
                
                testResults.methodCall = true;
                showResult('callResults', '‚úÖ –ú–µ—Ç–æ–¥ updateAllControls –≤—ã–∑–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ –±–µ–∑ –æ—à–∏–±–æ–∫!', 'success');
                
            } catch (error) {
                testResults.methodCall = false;
                showResult('callResults', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–∑–æ–≤–µ: ${error.message}`, 'error');
            }
            
            updateOverallResults();
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(() => {
                testMethodExists();
            }, 500);
        });
    </script>
</body>
</html>
</content>