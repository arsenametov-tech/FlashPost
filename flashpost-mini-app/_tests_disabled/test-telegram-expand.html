<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram WebApp Expand Test</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #0f0f14;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: #ffffff;
        }
        
        .test-container {
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .status-card {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            backdrop-filter: blur(10px);
        }
        
        .success { border-left: 4px solid #28a745; }
        .warning { border-left: 4px solid #ffc107; }
        .error { border-left: 4px solid #dc3545; }
        
        .code-block {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin: 10px 0;
            overflow-x: auto;
        }
        
        button {
            background: #833ab4;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        
        button:hover {
            background: #6c2e8f;
        }
        
        .viewport-info {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .height-demo {
            background: linear-gradient(135deg, #833ab4, #fd1d1d);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin: 10px 0;
            text-align: center;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Telegram WebApp SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <div class="test-container">
        <h1>üì± Telegram WebApp Expand Test</h1>
        
        <div class="status-card warning">
            <h3>‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞:</h3>
            <p>–ï—Å–ª–∏ –Ω–µ –≤—ã–∑–≤–∞—Ç—å <code>expand()</code>, Telegram –º–æ–∂–µ—Ç –æ—Ç—Ä–∏—Å–æ–≤–∞—Ç—å WebView —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç–æ–π!</p>
        </div>
        
        <div class="status-card success">
            <h3>‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:</h3>
            <div class="code-block">
const tg = window.Telegram?.WebApp;
if (tg) {
    tg.ready();   // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    tg.expand();  // ‚Üê –ö–†–ò–¢–ò–ß–ù–û –¥–ª—è –ø–æ–ª–Ω–æ–π –≤—ã—Å–æ—Ç—ã
}
            </div>
        </div>
        
        <div class="status-card" id="telegramStatus">
            <h3>üìä –°—Ç–∞—Ç—É—Å Telegram WebApp:</h3>
            <div id="telegramInfo">–ü—Ä–æ–≤–µ—Ä—è–µ–º...</div>
        </div>
        
        <div class="status-card">
            <h3>üìè –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ viewport:</h3>
            <div class="viewport-info" id="viewportInfo">–ó–∞–≥—Ä—É–∂–∞–µ–º...</div>
        </div>
        
        <div class="status-card">
            <h3>üß™ –¢–µ—Å—Ç—ã:</h3>
            <div>
                <button onclick="testTelegramInit()">üöÄ Test Telegram Init</button>
                <button onclick="testExpand()">üìè Test Expand</button>
                <button onclick="testViewportInfo()">üìä Check Viewport</button>
                <button onclick="simulateWithoutExpand()">‚ö†Ô∏è Simulate Without Expand</button>
            </div>
        </div>
        
        <div id="testResults"></div>
        
        <div class="height-demo" id="heightDemo">
            <h3>üìè Height Demo</h3>
            <p>–≠—Ç–æ—Ç –±–ª–æ–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—É—é –≤—ã—Å–æ—Ç—É</p>
            <div id="heightInfo">–ò–∑–º–µ—Ä—è–µ–º...</div>
        </div>
    </div>

    <script>
        let tg = window.Telegram?.WebApp;
        
        function updateTelegramStatus() {
            const statusEl = document.getElementById('telegramInfo');
            const statusCard = document.getElementById('telegramStatus');
            
            if (tg) {
                statusCard.className = 'status-card success';
                statusEl.innerHTML = `
                    <strong>‚úÖ Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω</strong><br>
                    ‚Ä¢ –í–µ—Ä—Å–∏—è: ${tg.version || 'unknown'}<br>
                    ‚Ä¢ –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞: ${tg.platform || 'unknown'}<br>
                    ‚Ä¢ –†–∞–∑–≤–µ—Ä–Ω—É—Ç: ${tg.isExpanded ? '–î–∞' : '–ù–µ—Ç'}<br>
                    ‚Ä¢ –í—ã—Å–æ—Ç–∞ viewport: ${tg.viewportHeight || 'unknown'}px<br>
                    ‚Ä¢ –°—Ç–∞–±–∏–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞: ${tg.viewportStableHeight || 'unknown'}px
                `;
            } else {
                statusCard.className = 'status-card warning';
                statusEl.innerHTML = `
                    <strong>‚ö†Ô∏è Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω</strong><br>
                    –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ –≤–Ω–µ Telegram –∏–ª–∏ SDK –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
                `;
            }
        }
        
        function updateViewportInfo() {
            const viewportEl = document.getElementById('viewportInfo');
            const heightEl = document.getElementById('heightInfo');
            
            const info = {
                windowHeight: window.innerHeight,
                windowWidth: window.innerWidth,
                screenHeight: screen.height,
                screenWidth: screen.width,
                documentHeight: document.documentElement.clientHeight,
                bodyHeight: document.body.clientHeight,
                telegramHeight: tg ? tg.viewportHeight : 'N/A',
                telegramStableHeight: tg ? tg.viewportStableHeight : 'N/A'
            };
            
            viewportEl.innerHTML = Object.entries(info)
                .map(([key, value]) => `${key}: ${value}px`)
                .join('<br>');
            
            heightEl.innerHTML = `
                Window: ${info.windowHeight}px<br>
                ${tg ? `Telegram: ${info.telegramHeight}px` : 'Telegram: N/A'}
            `;
        }
        
        function testTelegramInit() {
            console.log('üß™ Testing Telegram WebApp initialization...');
            
            if (!tg) {
                showResult('error', 'Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≤ Telegram.');
                return;
            }
            
            try {
                console.log('üì± Calling tg.ready()...');
                tg.ready();
                
                console.log('üìè Calling tg.expand()...');
                tg.expand();
                
                setTimeout(() => {
                    updateTelegramStatus();
                    updateViewportInfo();
                    
                    const isExpanded = tg.isExpanded;
                    const height = tg.viewportHeight;
                    
                    if (isExpanded && height > 400) {
                        showResult('success', `‚úÖ Telegram WebApp –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç! –í—ã—Å–æ—Ç–∞: ${height}px`);
                    } else {
                        showResult('warning', `‚ö†Ô∏è WebApp –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç. –í—ã—Å–æ—Ç–∞: ${height}px, –†–∞–∑–≤–µ—Ä–Ω—É—Ç: ${isExpanded}`);
                    }
                }, 500);
                
            } catch (error) {
                showResult('error', `‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`);
            }
        }
        
        function testExpand() {
            console.log('üìè Testing expand() method...');
            
            if (!tg) {
                showResult('error', 'Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                return;
            }
            
            const beforeHeight = tg.viewportHeight;
            console.log('üìä –í—ã—Å–æ—Ç–∞ –¥–æ expand():', beforeHeight);
            
            try {
                tg.expand();
                
                setTimeout(() => {
                    const afterHeight = tg.viewportHeight;
                    console.log('üìä –í—ã—Å–æ—Ç–∞ –ø–æ—Å–ª–µ expand():', afterHeight);
                    
                    updateViewportInfo();
                    
                    if (afterHeight > beforeHeight) {
                        showResult('success', `‚úÖ expand() —Å—Ä–∞–±–æ—Ç–∞–ª! –í—ã—Å–æ—Ç–∞ —É–≤–µ–ª–∏—á–∏–ª–∞—Å—å —Å ${beforeHeight}px –¥–æ ${afterHeight}px`);
                    } else if (afterHeight === beforeHeight && afterHeight > 400) {
                        showResult('success', `‚úÖ WebApp —É–∂–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –ø–æ–ª–Ω—É—é –≤—ã—Å–æ—Ç—É: ${afterHeight}px`);
                    } else {
                        showResult('warning', `‚ö†Ô∏è expand() –Ω–µ –∏–∑–º–µ–Ω–∏–ª –≤—ã—Å–æ—Ç—É –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ: ${afterHeight}px`);
                    }
                }, 300);
                
            } catch (error) {
                showResult('error', `‚ùå –û—à–∏–±–∫–∞ expand(): ${error.message}`);
            }
        }
        
        function testViewportInfo() {
            console.log('üìä Checking viewport information...');
            
            updateViewportInfo();
            
            const windowHeight = window.innerHeight;
            const telegramHeight = tg ? tg.viewportHeight : null;
            
            let message = `Window height: ${windowHeight}px`;
            if (telegramHeight) {
                message += `<br>Telegram height: ${telegramHeight}px`;
                
                if (Math.abs(windowHeight - telegramHeight) < 50) {
                    showResult('success', `‚úÖ –í—ã—Å–æ—Ç—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç! ${message}`);
                } else {
                    showResult('warning', `‚ö†Ô∏è –í—ã—Å–æ—Ç—ã —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è. ${message}`);
                }
            } else {
                showResult('warning', `‚ö†Ô∏è Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. ${message}`);
            }
        }
        
        function simulateWithoutExpand() {
            console.log('‚ö†Ô∏è Simulating initialization without expand()...');
            
            if (!tg) {
                showResult('error', 'Telegram WebApp –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏');
                return;
            }
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –±–µ–∑ expand()
            showResult('warning', `
                ‚ö†Ô∏è –°–∏–º—É–ª—è—Ü–∏—è –±–µ–∑ expand():<br>
                ‚Ä¢ WebView –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –≤—ã—Å–æ—Ç–æ–π<br>
                ‚Ä¢ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–º<br>
                ‚Ä¢ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞<br>
                <br>
                <strong>–†–µ—à–µ–Ω–∏–µ:</strong> –í—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–π—Ç–µ tg.expand() –ø–æ—Å–ª–µ tg.ready()!
            `);
            
            // –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º –ø—Ä–æ–±–ª–µ–º—É –≤–∏–∑—É–∞–ª—å–Ω–æ
            const demo = document.getElementById('heightDemo');
            demo.style.height = '200px';
            demo.style.background = 'linear-gradient(135deg, #dc3545, #fd7e14)';
            demo.innerHTML = `
                <h3>‚ö†Ô∏è –ë–µ–∑ expand()</h3>
                <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–º</p>
                <button onclick="fixExpand()" style="
                    background: white;
                    color: #333;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                ">
                    üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å
                </button>
            `;
        }
        
        function fixExpand() {
            console.log('üîß Fixing with expand()...');
            
            if (tg) {
                tg.expand();
            }
            
            const demo = document.getElementById('heightDemo');
            demo.style.height = 'auto';
            demo.style.background = 'linear-gradient(135deg, #833ab4, #fd1d1d)';
            demo.innerHTML = `
                <h3>‚úÖ –° expand()</h3>
                <p>–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ–ª–Ω—É—é –≤—ã—Å–æ—Ç—É</p>
                <div id="heightInfo">–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ!</div>
            `;
            
            showResult('success', '‚úÖ expand() –ø—Ä–∏–º–µ–Ω–µ–Ω! WebView —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ –ø–æ–ª–Ω—É—é –≤—ã—Å–æ—Ç—É.');
            
            setTimeout(updateViewportInfo, 300);
        }
        
        function showResult(type, message) {
            const resultsEl = document.getElementById('testResults');
            const statusClass = type === 'success' ? 'success' : type === 'error' ? 'error' : 'warning';
            const icon = type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ö†Ô∏è';
            
            resultsEl.innerHTML = `
                <div class="status-card ${statusClass}">
                    <strong>${icon} –†–µ–∑—É–ª—å—Ç–∞—Ç —Ç–µ—Å—Ç–∞:</strong><br>
                    ${message}
                </div>
            `;
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            console.log('üöÄ Telegram WebApp Expand Test loaded');
            
            updateTelegramStatus();
            updateViewportInfo();
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
            setTimeout(() => {
                if (tg) {
                    testTelegramInit();
                }
            }, 1000);
        });
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–æ–≤
        window.addEventListener('resize', () => {
            console.log('üìè Window resized, updating viewport info...');
            updateViewportInfo();
        });
        
        // –°–ª—É—à–∞–µ–º —Å–æ–±—ã—Ç–∏—è Telegram WebApp
        if (tg) {
            tg.onEvent('viewportChanged', () => {
                console.log('üì± Telegram viewport changed');
                updateTelegramStatus();
                updateViewportInfo();
            });
        }
    </script>
</body>
</html>