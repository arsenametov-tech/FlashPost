<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîß –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .module-status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .loaded {
            background: #d4edda;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
        }
        .loading {
            background: #d1ecf1;
            color: #0c5460;
        }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π Single Source of Truth</h1>
    <div id="moduleStatus"></div>
    <div id="testResults"></div>

    <script>
        const modules = [
            'StateManager',
            'Renderer', 
            'Editor',
            'DragManager',
            'ExportManager',
            'AIManager',
            'TemplateManager',
            'FlashPostApp'
        ];

        function updateStatus(module, status, message) {
            const statusDiv = document.getElementById('moduleStatus');
            const className = status === 'loaded' ? 'loaded' : status === 'error' ? 'error' : 'loading';
            const icon = status === 'loaded' ? '‚úÖ' : status === 'error' ? '‚ùå' : '‚è≥';
            
            statusDiv.innerHTML += `
                <div class="module-status ${className}">
                    ${icon} ${module}: ${message}
                </div>
            `;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è
        modules.forEach(module => {
            updateStatus(module, 'loading', '–ó–∞–≥—Ä—É–∑–∫–∞...');
        });
    </script>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É -->
    <script src="src/state.js" onload="updateStatus('StateManager', 'loaded', '–ó–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ')" onerror="updateStatus('StateManager', 'error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')"></script>
    <script src="src/renderer.js" onload="updateStatus('Renderer', 'loaded', '–ó–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ')" onerror="updateStatus('Renderer', 'error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')"></script>
    <script src="src/editor.js" onload="updateStatus('Editor', 'loaded', '–ó–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ')" onerror="updateStatus('Editor', 'error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')"></script>
    <script src="src/drag.js" onload="updateStatus('DragManager', 'loaded', '–ó–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ')" onerror="updateStatus('DragManager', 'error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')"></script>
    <script src="src/export.js" onload="updateStatus('ExportManager', 'loaded', '–ó–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ')" onerror="updateStatus('ExportManager', 'error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')"></script>
    <script src="src/ai.js" onload="updateStatus('AIManager', 'loaded', '–ó–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ')" onerror="updateStatus('AIManager', 'error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')"></script>
    <script src="src/templates.js" onload="updateStatus('TemplateManager', 'loaded', '–ó–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ')" onerror="updateStatus('TemplateManager', 'error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')"></script>
    <script src="src/app.js" onload="updateStatus('FlashPostApp', 'loaded', '–ó–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ')" onerror="updateStatus('FlashPostApp', 'error', '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏')"></script>

    <script>
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
        setTimeout(() => {
            const resultsDiv = document.getElementById('testResults');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—Å–µ –∫–ª–∞—Å—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã
                const checks = [
                    { name: 'StateManager', available: typeof StateManager !== 'undefined' },
                    { name: 'Renderer', available: typeof Renderer !== 'undefined' },
                    { name: 'Editor', available: typeof Editor !== 'undefined' },
                    { name: 'DragManager', available: typeof DragManager !== 'undefined' },
                    { name: 'ExportManager', available: typeof ExportManager !== 'undefined' },
                    { name: 'AIManager', available: typeof AIManager !== 'undefined' },
                    { name: 'TemplateManager', available: typeof TemplateManager !== 'undefined' },
                    { name: 'FlashPostApp', available: typeof FlashPostApp !== 'undefined' },
                    { name: 'App Instance', available: typeof window.flashPostApp !== 'undefined' }
                ];

                resultsDiv.innerHTML = '<h2>üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏:</h2>';
                
                let allGood = true;
                checks.forEach(check => {
                    const status = check.available ? 'loaded' : 'error';
                    const icon = check.available ? '‚úÖ' : '‚ùå';
                    const message = check.available ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                    
                    resultsDiv.innerHTML += `
                        <div class="module-status ${status}">
                            ${icon} ${check.name}: ${message}
                        </div>
                    `;
                    
                    if (!check.available) allGood = false;
                });

                if (allGood) {
                    resultsDiv.innerHTML += `
                        <div class="module-status loaded">
                            üéâ –í—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ! Single Source of Truth –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ.
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML += `
                        <div class="module-status error">
                            ‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥—É–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –¥–ª—è –¥–µ—Ç–∞–ª–µ–π.
                        </div>
                    `;
                }

            } catch (error) {
                resultsDiv.innerHTML += `
                    <div class="module-status error">
                        ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –º–æ–¥—É–ª–µ–π: ${error.message}
                    </div>
                `;
            }
        }, 2000);

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫
        window.addEventListener('error', (event) => {
            console.error('–ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞:', event.error);
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML += `
                <div class="module-status error">
                    ‚ùå –ì–ª–æ–±–∞–ª—å–Ω–∞—è –æ—à–∏–±–∫–∞: ${event.error?.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}
                </div>
            `;
        });
    </script>
</body>
</html>