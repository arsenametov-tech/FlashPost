<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Advanced AI Pipeline</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 28px;
            font-weight: 700;
        }
        
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .test-input {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        .test-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .test-btn {
            background: linear-gradient(135deg, #fd79a8 0%, #e84393 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .results {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .slide-preview {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #fd79a8;
        }
        
        .slide-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
            color: #fd79a8;
        }
        
        .slide-type {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 5px;
        }
        
        .slide-content {
            line-height: 1.4;
            white-space: pre-line;
        }
        
        .status {
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-weight: 600;
        }
        
        .status.success {
            background: rgba(0, 184, 148, 0.2);
            border: 1px solid #00b894;
        }
        
        .status.error {
            background: rgba(214, 48, 49, 0.2);
            border: 1px solid #d63031;
        }
        
        .status.info {
            background: rgba(116, 185, 255, 0.2);
            border: 1px solid #74b9ff;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Advanced AI Pipeline Test</h1>
        
        <div class="test-section">
            <h3>–¢–µ—Å—Ç –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–π AI –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏</h3>
            <input type="text" class="test-input" id="topicInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è –∫–∞—Ä—É—Å–µ–ª–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: '–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö')">
            <button class="test-btn" onclick="testAdvancedPipeline()">üöÄ –¢–µ—Å—Ç Advanced Pipeline</button>
            <button class="test-btn" onclick="testOutlineGeneration()">üìã –¢–µ—Å—Ç Outline Generation</button>
            <button class="test-btn" onclick="testContentGeneration()">‚úçÔ∏è –¢–µ—Å—Ç Content Generation</button>
            <button class="test-btn" onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>
        
        <div id="results" class="results" style="display: none;"></div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ -->
    <script src="src/state.js"></script>
    <script src="src/ai.js"></script>

    <script>
        let stateManager, aiManager;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            try {
                stateManager = new StateManager();
                aiManager = new AIManager(stateManager);
                
                logStatus('‚úÖ –ú–æ–¥—É–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —É—Å–ø–µ—à–Ω–æ', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å AI
                if (aiManager.isAvailable()) {
                    logStatus('‚úÖ AI –º–æ–¥—É–ª—å –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    logStatus('‚ö†Ô∏è AI –º–æ–¥—É–ª—å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ', 'info');
                }
                
            } catch (error) {
                logStatus('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ' + error.message, 'error');
            }
        });
        
        // –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ advanced pipeline
        async function testAdvancedPipeline() {
            const topic = document.getElementById('topicInput').value.trim();
            if (!topic) {
                logStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                return;
            }
            
            showResults();
            logStatus(`üöÄ –ó–∞–ø—É—Å–∫ Advanced AI Pipeline –¥–ª—è —Ç–µ–º—ã: "${topic}"`, 'info');
            
            try {
                // –¢–µ—Å—Ç–∏—Ä—É–µ–º PRO MODE –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
                const result = await aiManager.generateProModeCarousel(topic);
                
                logStatus(`‚úÖ Advanced Pipeline –∑–∞–≤–µ—Ä—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!`, 'success');
                logStatus(`üìä –°–æ–∑–¥–∞–Ω–æ —Å–ª–∞–π–¥–æ–≤: ${result.slides.length}`, 'info');
                logStatus(`üéØ –†–µ–∂–∏–º –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${result.generatedBy}`, 'info');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º outline –µ—Å–ª–∏ –µ—Å—Ç—å
                if (result.outline) {
                    logStatus(`üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–∞—Ä—É—Å–µ–ª–∏: ${result.outline.structure}`, 'info');
                    logStatus(`üë• –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: ${result.outline.targetAudience}`, 'info');
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é —Å–ª–∞–π–¥–æ–≤
                result.slides.forEach((slide, index) => {
                    displaySlidePreview(slide, index + 1);
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                validateAdvancedGeneration(result);
                
            } catch (error) {
                logStatus('‚ùå –û—à–∏–±–∫–∞ Advanced Pipeline: ' + error.message, 'error');
                console.error('Advanced Pipeline Error:', error);
            }
        }
        
        // –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ outline
        async function testOutlineGeneration() {
            const topic = document.getElementById('topicInput').value.trim();
            if (!topic) {
                logStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                return;
            }
            
            showResults();
            logStatus(`üìã –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ outline –¥–ª—è —Ç–µ–º—ã: "${topic}"`, 'info');
            
            try {
                const outline = await aiManager.generateCarouselOutline(topic);
                
                logStatus(`‚úÖ Outline —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!`, 'success');
                logStatus(`üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–∞–π–¥–æ–≤: ${outline.totalSlides}`, 'info');
                logStatus(`üèóÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞: ${outline.structure}`, 'info');
                logStatus(`üë• –¶–µ–ª–µ–≤–∞—è –∞—É–¥–∏—Ç–æ—Ä–∏—è: ${outline.targetAudience}`, 'info');
                logStatus(`üìà –ö–æ–Ω—Ç–µ–Ω—Ç–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è: ${outline.contentStrategy}`, 'info');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–≥–æ —Å–ª–∞–π–¥–∞
                outline.outline.forEach((slideOutline, index) => {
                    const outlineHtml = `
                        <div class="slide-preview">
                            <div class="slide-type">–°–ª–∞–π–¥ ${slideOutline.slideNumber} - ${slideOutline.type.toUpperCase()}</div>
                            <div class="slide-title">${slideOutline.keyMessage}</div>
                            <div class="slide-content">
                                <strong>–¶–µ–ª—å:</strong> ${slideOutline.purpose}
                                <strong>–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è:</strong> ${slideOutline.mainIdea}
                                <strong>–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω:</strong> ${slideOutline.emotionalTone}
                                <strong>–≠–ª–µ–º–µ–Ω—Ç—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞:</strong> ${slideOutline.contentElements.join(', ')}
                            </div>
                        </div>
                    `;
                    document.getElementById('results').innerHTML += outlineHtml;
                });
                
            } catch (error) {
                logStatus('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ outline: ' + error.message, 'error');
                console.error('Outline Generation Error:', error);
            }
        }
        
        // –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        async function testContentGeneration() {
            const topic = document.getElementById('topicInput').value.trim();
            if (!topic) {
                logStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ —Ç–µ–º—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
                return;
            }
            
            showResults();
            logStatus(`‚úçÔ∏è –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è —Ç–µ–º—ã: "${topic}"`, 'info');
            
            try {
                // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º outline
                const outline = await aiManager.generateCarouselOutline(topic);
                logStatus(`üìã Outline —Å–æ–∑–¥–∞–Ω (${outline.totalSlides} —Å–ª–∞–π–¥–æ–≤)`, 'info');
                
                // –ó–∞—Ç–µ–º –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
                const content = await aiManager.generateCarouselContent(topic, outline);
                logStatus(`‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!`, 'success');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –∫–∞–∂–¥–æ–≥–æ —Å–ª–∞–π–¥–∞
                content.slides.forEach((slide, index) => {
                    displaySlidePreview({
                        id: index + 1,
                        textBlocks: [
                            { text: slide.title },
                            { text: slide.text }
                        ],
                        slideType: slide.type,
                        keywordType: slide.keywordType,
                        emotionalTone: slide.emotionalTone
                    }, index + 1);
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
                validateContentQuality(content);
                
            } catch (error) {
                logStatus('‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞: ' + error.message, 'error');
                console.error('Content Generation Error:', error);
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–≤—å—é —Å–ª–∞–π–¥–∞
        function displaySlidePreview(slide, slideNumber) {
            const title = slide.textBlocks && slide.textBlocks[0] ? slide.textBlocks[0].text : `–°–ª–∞–π–¥ ${slideNumber}`;
            const content = slide.textBlocks && slide.textBlocks[1] ? slide.textBlocks[1].text : '–ù–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç–∞';
            const type = slide.slideType || 'unknown';
            const keywordType = slide.keywordType || 'unknown';
            const emotionalTone = slide.emotionalTone || 'neutral';
            
            const slideHtml = `
                <div class="slide-preview">
                    <div class="slide-type">–°–ª–∞–π–¥ ${slideNumber} - ${type.toUpperCase()} (${keywordType}, ${emotionalTone})</div>
                    <div class="slide-title">${title}</div>
                    <div class="slide-content">${content}</div>
                </div>
            `;
            
            document.getElementById('results').innerHTML += slideHtml;
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è advanced –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
        function validateAdvancedGeneration(result) {
            logStatus('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ Advanced –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏...', 'info');
            
            const issues = [];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–∞–π–¥–æ–≤ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 8-11)
            if (result.slides.length < 8 || result.slides.length > 11) {
                issues.push(`–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–∞–π–¥–æ–≤: ${result.slides.length} (–æ–∂–∏–¥–∞–µ—Ç—Å—è 8-11)`);
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–ª–∞–π–¥–æ–≤
            const requiredTypes = ['hook', 'problem', 'solution', 'benefits', 'cta'];
            const presentTypes = result.slides.map(s => s.slideType);
            
            requiredTypes.forEach(type => {
                if (!presentTypes.includes(type)) {
                    issues.push(`–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π —Ç–∏–ø —Å–ª–∞–π–¥–∞: ${type}`);
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É —Ç–µ–∫—Å—Ç–∞ (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 2-4 —Å—Ç—Ä–æ–∫–∏)
            result.slides.forEach((slide, index) => {
                if (slide.textBlocks && slide.textBlocks[1]) {
                    const lines = slide.textBlocks[1].text.split('\n').length;
                    if (lines < 2 || lines > 6) {
                        issues.push(`–°–ª–∞–π–¥ ${index + 1}: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ (${lines})`);
                    }
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
            result.slides.forEach((slide, index) => {
                if (!slide.autoKeywords || slide.autoKeywords.length === 0) {
                    issues.push(`–°–ª–∞–π–¥ ${index + 1}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞`);
                }
            });
            
            if (issues.length === 0) {
                logStatus('‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º Advanced AI Pipeline', 'success');
            } else {
                logStatus('‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã –∫–∞—á–µ—Å—Ç–≤–∞:', 'error');
                issues.forEach(issue => {
                    logStatus(`  ‚Ä¢ ${issue}`, 'error');
                });
            }
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        function validateContentQuality(content) {
            logStatus('üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...', 'info');
            
            const qualityMetrics = {
                averageLength: 0,
                keywordDensity: 0,
                emotionalVariety: new Set(),
                typeVariety: new Set()
            };
            
            content.slides.forEach(slide => {
                qualityMetrics.averageLength += slide.text.length;
                qualityMetrics.emotionalVariety.add(slide.emotionalTone);
                qualityMetrics.typeVariety.add(slide.type);
            });
            
            qualityMetrics.averageLength = Math.round(qualityMetrics.averageLength / content.slides.length);
            
            logStatus(`üìä –°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞: ${qualityMetrics.averageLength} —Å–∏–º–≤–æ–ª–æ–≤`, 'info');
            logStatus(`üé≠ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ: ${qualityMetrics.emotionalVariety.size} —Ç–æ–Ω–æ–≤`, 'info');
            logStatus(`üèóÔ∏è –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ —Ç–∏–ø–æ–≤: ${qualityMetrics.typeVariety.size} —Ç–∏–ø–æ–≤`, 'info');
            
            if (qualityMetrics.averageLength > 100 && qualityMetrics.emotionalVariety.size >= 3) {
                logStatus('‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤—ã—Å–æ–∫–æ–µ', 'success');
            } else {
                logStatus('‚ö†Ô∏è –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏—è', 'error');
            }
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showResults() {
            document.getElementById('results').style.display = 'block';
            document.getElementById('results').innerHTML = '';
        }
        
        function clearResults() {
            document.getElementById('results').style.display = 'none';
            document.getElementById('results').innerHTML = '';
        }
        
        function logStatus(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const statusHtml = `<div class="status ${type}">[${timestamp}] ${message}</div>`;
            document.getElementById('results').innerHTML += statusHtml;
            
            // –ê–≤—Ç–æ—Å–∫—Ä–æ–ª–ª –≤–Ω–∏–∑
            const results = document.getElementById('results');
            results.scrollTop = results.scrollHeight;
        }
    </script>
</body>
</html>