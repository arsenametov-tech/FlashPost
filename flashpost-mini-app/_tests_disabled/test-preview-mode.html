<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlashPost - Preview Mode Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            color: white;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }
        
        .status-card {
            background: rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }
        
        .status-card.warning {
            border-left-color: #ffc107;
        }
        
        .status-card.error {
            border-left-color: #dc3545;
        }
        
        .test-results {
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
        }
        
        .btn.success {
            background: #28a745;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-item {
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .feature-status {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .feature-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .feature-desc {
            font-size: 14px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="header">
            <h1>üîç FlashPost Preview Mode Test</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ standalone —Ä–µ–∂–∏–º–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏</p>
        </div>
        
        <div class="status-card" id="modeStatus">
            <h3>üìä –†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã</h3>
            <p id="modeDescription">–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º...</p>
        </div>
        
        <div class="status-card">
            <h3>üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
            <div class="test-results" id="testResults">
                –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...
            </div>
        </div>
        
        <div class="feature-grid" id="featureGrid">
            <!-- Features will be populated by JavaScript -->
        </div>
        
        <div style="text-align: center; margin-top: 30px;">
            <button class="btn success" onclick="openMainApp()">
                üöÄ –û—Ç–∫—Ä—ã—Ç—å FlashPost
            </button>
            <button class="btn" onclick="runTests()">
                üîÑ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã
            </button>
        </div>
    </div>

    <script>
        let testResults = [];
        
        function addTestResult(test, status, details = '') {
            const timestamp = new Date().toLocaleTimeString();
            const result = `[${timestamp}] ${status ? '‚úÖ' : '‚ùå'} ${test}${details ? ': ' + details : ''}`;
            testResults.push(result);
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = testResults.join('\n');
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }
        
        function testPreviewMode() {
            addTestResult('–ü—Ä–æ–≤–µ—Ä–∫–∞ PREVIEW_MODE —Ñ–ª–∞–≥–∞', typeof window.PREVIEW_MODE !== 'undefined');
            
            if (window.PREVIEW_MODE) {
                addTestResult('PREVIEW_MODE –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', true, 'Standalone —Ä–µ–∂–∏–º');
            } else {
                addTestResult('PREVIEW_MODE –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω', true, 'Telegram —Ä–µ–∂–∏–º');
            }
            
            // –¢–µ—Å—Ç Telegram API
            const hasTelegram = !!window.Telegram?.WebApp;
            addTestResult('Telegram WebApp –¥–æ—Å—Ç—É–ø–µ–Ω', hasTelegram);
            
            if (hasTelegram) {
                addTestResult('Telegram.WebApp.ready', typeof window.Telegram.WebApp.ready === 'function');
                addTestResult('Telegram.WebApp.expand', typeof window.Telegram.WebApp.expand === 'function');
                addTestResult('MainButton –¥–æ—Å—Ç—É–ø–µ–Ω', !!window.Telegram.WebApp.MainButton);
                addTestResult('BackButton –¥–æ—Å—Ç—É–ø–µ–Ω', !!window.Telegram.WebApp.BackButton);
            }
            
            // –¢–µ—Å—Ç –º–æ–¥—É–ª–µ–π
            setTimeout(() => {
                addTestResult('StateManager –∑–∞–≥—Ä—É–∂–µ–Ω', typeof StateManager !== 'undefined');
                addTestResult('Renderer –∑–∞–≥—Ä—É–∂–µ–Ω', typeof Renderer !== 'undefined');
                addTestResult('Editor –∑–∞–≥—Ä—É–∂–µ–Ω', typeof Editor !== 'undefined');
                addTestResult('AIManager –∑–∞–≥—Ä—É–∂–µ–Ω', typeof AIManager !== 'undefined');
                addTestResult('TemplateManager –∑–∞–≥—Ä—É–∂–µ–Ω', typeof TemplateManager !== 'undefined');
                addTestResult('FlashPostApp –∑–∞–≥—Ä—É–∂–µ–Ω', typeof FlashPostApp !== 'undefined');
                
                updateFeatureStatus();
            }, 1000);
        }
        
        function updateModeStatus() {
            const modeStatus = document.getElementById('modeStatus');
            const modeDescription = document.getElementById('modeDescription');
            
            if (window.PREVIEW_MODE) {
                modeStatus.className = 'status-card';
                modeDescription.innerHTML = `
                    <strong>üîç PREVIEW MODE –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</strong><br>
                    –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ standalone —Ä–µ–∂–∏–º–µ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.<br>
                    Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ mock —Ñ—É–Ω–∫—Ü–∏–∏.
                `;
            } else {
                modeStatus.className = 'status-card warning';
                modeDescription.innerHTML = `
                    <strong>üì± Telegram WebApp —Ä–µ–∂–∏–º</strong><br>
                    –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–∞–º–∫–∞—Ö Telegram Mini App.<br>
                    –î–æ—Å—Ç—É–ø–Ω—ã –≤—Å–µ Telegram-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.
                `;
            }
        }
        
        function updateFeatureStatus() {
            const features = [
                {
                    name: 'AI –ì–µ–Ω–µ—Ä–∞—Ü–∏—è',
                    test: () => typeof AIManager !== 'undefined',
                    desc: '–°–æ–∑–¥–∞–Ω–∏–µ —Å–ª–∞–π–¥–æ–≤ —Å –ø–æ–º–æ—â—å—é –ò–ò'
                },
                {
                    name: '–†–µ–¥–∞–∫—Ç–æ—Ä',
                    test: () => typeof Editor !== 'undefined',
                    desc: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∏ —Å—Ç–∏–ª–µ–π'
                },
                {
                    name: '–®–∞–±–ª–æ–Ω—ã',
                    test: () => typeof TemplateManager !== 'undefined',
                    desc: '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤'
                },
                {
                    name: '–≠–∫—Å–ø–æ—Ä—Ç',
                    test: () => typeof ExportManager !== 'undefined',
                    desc: '–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≥–æ—Ç–æ–≤—ã—Ö —Å–ª–∞–π–¥–æ–≤'
                },
                {
                    name: 'Drag & Drop',
                    test: () => typeof DragManager !== 'undefined',
                    desc: '–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤'
                },
                {
                    name: '–°–æ—Å—Ç–æ—è–Ω–∏–µ',
                    test: () => typeof StateManager !== 'undefined',
                    desc: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è'
                }
            ];
            
            const featureGrid = document.getElementById('featureGrid');
            featureGrid.innerHTML = features.map(feature => {
                const isWorking = feature.test();
                return `
                    <div class="feature-item">
                        <div class="feature-status">${isWorking ? '‚úÖ' : '‚ùå'}</div>
                        <div class="feature-name">${feature.name}</div>
                        <div class="feature-desc">${feature.desc}</div>
                    </div>
                `;
            }).join('');
        }
        
        function runTests() {
            testResults = [];
            document.getElementById('testResults').innerHTML = '–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤...';
            
            setTimeout(() => {
                testPreviewMode();
            }, 100);
        }
        
        function openMainApp() {
            window.open('index.html', '_blank');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üîç Preview Mode Test –∑–∞–≥—Ä—É–∂–µ–Ω');
            
            updateModeStatus();
            runTests();
        });
    </script>
    
    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <script>
        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º PREVIEW MODE –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.PREVIEW_MODE = true;
        
        // Mock Telegram API
        if (!window.Telegram?.WebApp) {
            window.Telegram = {
                WebApp: {
                    ready: () => console.log('üì± Mock: Telegram.WebApp.ready()'),
                    expand: () => console.log('üì± Mock: Telegram.WebApp.expand()'),
                    setHeaderColor: () => console.log('üì± Mock: setHeaderColor()'),
                    setBackgroundColor: () => console.log('üì± Mock: setBackgroundColor()'),
                    enableClosingConfirmation: () => console.log('üì± Mock: enableClosingConfirmation()'),
                    MainButton: {
                        setText: (text) => console.log('üì± Mock: MainButton.setText(' + text + ')'),
                        onClick: (callback) => console.log('üì± Mock: MainButton.onClick()'),
                        show: () => console.log('üì± Mock: MainButton.show()'),
                        hide: () => console.log('üì± Mock: MainButton.hide()'),
                        color: '#833ab4',
                        textColor: '#ffffff'
                    },
                    BackButton: {
                        show: () => console.log('üì± Mock: BackButton.show()'),
                        hide: () => console.log('üì± Mock: BackButton.hide()'),
                        onClick: (callback) => console.log('üì± Mock: BackButton.onClick()')
                    },
                    version: '6.1',
                    colorScheme: 'dark',
                    viewportHeight: window.innerHeight,
                    viewportStableHeight: window.innerHeight,
                    isExpanded: true
                }
            };
        }
    </script>
    
    <script src="src/state.js"></script>
    <script src="src/renderer.js"></script>
    <script src="src/editor.js"></script>
    <script src="src/drag.js"></script>
    <script src="src/export.js"></script>
    <script src="src/ai.js"></script>
    <script src="src/template-manager.js"></script>
</body>
</html>