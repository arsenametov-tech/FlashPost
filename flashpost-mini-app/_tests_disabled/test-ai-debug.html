<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Debug Test</title>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .log {
            background: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .info { color: #17a2b8; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç AI Debug Test</h1>
        <button class="btn" onclick="debugAIManager()">Debug AIManager</button>
        <button class="btn" onclick="testMethods()">Test Methods</button>
        <button class="btn" onclick="clearLog()">Clear</button>
        <div id="log" class="log"></div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª–∏ -->
    <script src="src/state.js"></script>
    <script src="src/ai.js"></script>

    <script>
        let stateManager, aiManager;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            try {
                log('üöÄ –ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...', 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–æ–≤
                log(`StateManager –¥–æ—Å—Ç—É–ø–µ–Ω: ${typeof StateManager}`, 'info');
                log(`AIManager –¥–æ—Å—Ç—É–ø–µ–Ω: ${typeof AIManager}`, 'info');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º StateManager
                stateManager = new StateManager();
                log('‚úÖ StateManager —Å–æ–∑–¥–∞–Ω', 'success');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º AIManager
                aiManager = new AIManager(stateManager);
                log('‚úÖ AIManager —Å–æ–∑–¥–∞–Ω', 'success');
                
                log('üéâ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ', 'success');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
                console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', error);
            }
        });

        function debugAIManager() {
            try {
                log('üîç –û—Ç–ª–∞–¥–∫–∞ AIManager...', 'info');
                
                if (!aiManager) {
                    log('‚ùå aiManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                log(`aiManager —Ç–∏–ø: ${typeof aiManager}`, 'info');
                log(`aiManager –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä: ${aiManager.constructor.name}`, 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–≤–æ–π—Å—Ç–≤–∞
                log(`state: ${typeof aiManager.state}`, 'info');
                log(`apiKey: ${typeof aiManager.apiKey}`, 'info');
                log(`baseURL: ${typeof aiManager.baseURL}`, 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–µ—Ç–æ–¥—ã
                const methods = [
                    'isAvailable',
                    'generateCarousel',
                    'generateHighQualityCarousel',
                    'generateCarouselOutline',
                    'generateCarouselContent',
                    'convertToProModeSlides',
                    'generateProModeCarousel'
                ];
                
                log('üìã –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–æ–≤:', 'info');
                methods.forEach(method => {
                    const exists = typeof aiManager[method] === 'function';
                    log(`  ${method}: ${exists ? '‚úÖ' : '‚ùå'} ${typeof aiManager[method]}`, exists ? 'success' : 'error');
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç–æ–¥—ã
                log('üìã –í—Å–µ –º–µ—Ç–æ–¥—ã AIManager:', 'info');
                const allMethods = Object.getOwnPropertyNames(Object.getPrototypeOf(aiManager))
                    .filter(name => typeof aiManager[name] === 'function' && name !== 'constructor');
                
                log(`–ù–∞–π–¥–µ–Ω–æ –º–µ—Ç–æ–¥–æ–≤: ${allMethods.length}`, 'info');
                allMethods.forEach(method => {
                    log(`  - ${method}`, 'info');
                });
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ª–∞–¥–∫–∏: ${error.message}`, 'error');
                console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', error);
            }
        }

        async function testMethods() {
            try {
                log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤...', 'info');
                
                if (!aiManager) {
                    log('‚ùå aiManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                // –¢–µ—Å—Ç 1: isAvailable
                try {
                    const available = aiManager.isAvailable();
                    log(`‚úÖ isAvailable(): ${available}`, 'success');
                } catch (error) {
                    log(`‚ùå isAvailable() –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
                
                // –¢–µ—Å—Ç 2: generateCarouselOutline
                try {
                    log('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ generateCarouselOutline...', 'info');
                    const outline = await aiManager.generateCarouselOutline('—Ç–µ—Å—Ç');
                    log(`‚úÖ generateCarouselOutline —Ä–∞–±–æ—Ç–∞–µ—Ç`, 'success');
                } catch (error) {
                    log(`‚ùå generateCarouselOutline –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
                
                // –¢–µ—Å—Ç 3: generateHighQualityCarousel
                try {
                    log('üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ generateHighQualityCarousel...', 'info');
                    const result = await aiManager.generateHighQualityCarousel('—Ç–µ—Å—Ç');
                    log(`‚úÖ generateHighQualityCarousel —Ä–∞–±–æ—Ç–∞–µ—Ç`, 'success');
                } catch (error) {
                    log(`‚ùå generateHighQualityCarousel –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}`, 'error');
                console.error('–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:', error);
            }
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
        window.addEventListener('error', function(event) {
            log(`‚ùå JavaScript –æ—à–∏–±–∫–∞: ${event.error.message}`, 'error');
            console.error('JavaScript –æ—à–∏–±–∫–∞:', event.error);
        });

        window.addEventListener('unhandledrejection', function(event) {
            log(`‚ùå –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–º–∏—Å–∞: ${event.reason}`, 'error');
            console.error('–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–æ–º–∏—Å–∞:', event.reason);
        });
    </script>
</body>
</html>