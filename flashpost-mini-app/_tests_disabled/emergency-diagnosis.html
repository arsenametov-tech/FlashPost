<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® Emergency Diagnosis - FlashPost</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { 
            height: 100%; 
            background: #0f0f14; 
            color: #fff; 
            font-family: Arial, sans-serif;
            overflow-x: hidden;
        }
        .container {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: #1a5f1a; border: 2px solid #28a745; }
        .error { background: #5f1a1a; border: 2px solid #dc3545; }
        .warning { background: #5f4a1a; border: 2px solid #ffc107; color: #000; }
        .info { background: #1a3a5f; border: 2px solid #007bff; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .test-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover { background: #0056b3; }
        .btn.success { background: #28a745; }
        .btn.danger { background: #dc3545; }
        .log {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        #app {
            min-height: 100vh;
            background: #0f0f14;
            color: #fff;
            display: block;
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® Emergency Diagnosis - FlashPost</h1>
        
        <div id="overallStatus" class="status info">
            üîÑ –ó–∞–ø—É—Å–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...
        </div>

        <div class="test-grid">
            <!-- DOM Structure Test -->
            <div class="test-card">
                <h3>üèóÔ∏è DOM Structure</h3>
                <div id="domStatus" class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
                <button class="btn" onclick="testDOM()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å DOM</button>
                <div id="domLog" class="log"></div>
            </div>

            <!-- CSS Loading Test -->
            <div class="test-card">
                <h3>üé® CSS Loading</h3>
                <div id="cssStatus" class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
                <button class="btn" onclick="testCSS()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å CSS</button>
                <div id="cssLog" class="log"></div>
            </div>

            <!-- JavaScript Modules Test -->
            <div class="test-card">
                <h3>üì¶ JavaScript Modules</h3>
                <div id="jsStatus" class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
                <button class="btn" onclick="testJS()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å JS</button>
                <div id="jsLog" class="log"></div>
            </div>

            <!-- FlashPost App Test -->
            <div class="test-card">
                <h3>üöÄ FlashPost App</h3>
                <div id="appStatus" class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
                <button class="btn" onclick="testApp()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å App</button>
                <div id="appLog" class="log"></div>
            </div>

            <!-- Render Test -->
            <div class="test-card">
                <h3>üñºÔ∏è Render Test</h3>
                <div id="renderStatus" class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
                <button class="btn" onclick="testRender()">–¢–µ—Å—Ç —Ä–µ–Ω–¥–µ—Ä–∞</button>
                <button class="btn success" onclick="forceRender()">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä</button>
                <div id="renderLog" class="log"></div>
            </div>

            <!-- Network Test -->
            <div class="test-card">
                <h3>üåê Network & Server</h3>
                <div id="networkStatus" class="status info">–ü—Ä–æ–≤–µ—Ä–∫–∞...</div>
                <button class="btn" onclick="testNetwork()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç—å</button>
                <div id="networkLog" class="log"></div>
            </div>
        </div>

        <div class="test-card">
            <h3>üîß Emergency Actions</h3>
            <button class="btn danger" onclick="emergencyReset()">–°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è</button>
            <button class="btn success" onclick="emergencyRender()">–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä</button>
            <button class="btn" onclick="runFullDiagnosis()">–ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞</button>
            <button class="btn" onclick="openMainApp()">–û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
        </div>

        <!-- Emergency App Container -->
        <div id="emergencyApp" style="display: none; margin-top: 20px; padding: 20px; background: #2a2a2a; border-radius: 8px;">
            <h3>üÜò Emergency FlashPost Interface</h3>
            <div id="emergencyContent"></div>
        </div>
    </div>

    <script>
        let diagnosticLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            diagnosticLog.push({timestamp, message, type});
            console.log(logEntry);
        }

        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }

        function updateLog(logId, message) {
            const logElement = document.getElementById(logId);
            logElement.innerHTML += message + '\n';
            logElement.scrollTop = logElement.scrollHeight;
        }

        // DOM Structure Test
        function testDOM() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DOM —Å—Ç—Ä—É–∫—Ç—É—Ä—ã...');
            updateLog('domLog', '–ü—Ä–æ–≤–µ—Ä–∫–∞ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤...');
            
            const tests = [
                {name: 'document.body', element: document.body},
                {name: '#app', element: document.getElementById('app')},
                {name: 'html element', element: document.documentElement}
            ];
            
            let passed = 0;
            tests.forEach(test => {
                if (test.element) {
                    updateLog('domLog', `‚úÖ ${test.name}: –Ω–∞–π–¥–µ–Ω`);
                    passed++;
                } else {
                    updateLog('domLog', `‚ùå ${test.name}: –ù–ï –Ω–∞–π–¥–µ–Ω`);
                }
            });
            
            if (passed === tests.length) {
                updateStatus('domStatus', '‚úÖ DOM —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ –ø–æ—Ä—è–¥–∫–µ', 'success');
            } else {
                updateStatus('domStatus', `‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å DOM (${passed}/${tests.length})`, 'error');
            }
        }

        // CSS Loading Test
        function testCSS() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ CSS...');
            updateLog('cssLog', '–ü—Ä–æ–≤–µ—Ä–∫–∞ CSS —Å—Ç–∏–ª–µ–π...');
            
            const bodyStyles = window.getComputedStyle(document.body);
            const backgroundColor = bodyStyles.backgroundColor;
            const color = bodyStyles.color;
            
            updateLog('cssLog', `Background: ${backgroundColor}`);
            updateLog('cssLog', `Color: ${color}`);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥—Ä—É–∑–∫—É app.css
            fetch('/app.css')
                .then(response => {
                    if (response.ok) {
                        updateLog('cssLog', '‚úÖ app.css –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                        updateStatus('cssStatus', '‚úÖ CSS –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                    } else {
                        updateLog('cssLog', `‚ùå app.css –æ—à–∏–±–∫–∞: ${response.status}`);
                        updateStatus('cssStatus', '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ CSS', 'error');
                    }
                })
                .catch(error => {
                    updateLog('cssLog', `‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`);
                    updateStatus('cssStatus', '‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞ CSS', 'error');
                });
        }

        // JavaScript Modules Test
        function testJS() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ JavaScript –º–æ–¥—É–ª–µ–π...');
            updateLog('jsLog', '–ü—Ä–æ–≤–µ—Ä–∫–∞ JS –º–æ–¥—É–ª–µ–π...');
            
            const modules = [
                '/src/state.js',
                '/src/renderer.js', 
                '/src/editor.js',
                '/src/app.js'
            ];
            
            let loadedModules = 0;
            modules.forEach(module => {
                fetch(module)
                    .then(response => {
                        if (response.ok) {
                            updateLog('jsLog', `‚úÖ ${module}: –∑–∞–≥—Ä—É–∂–µ–Ω`);
                            loadedModules++;
                            if (loadedModules === modules.length) {
                                updateStatus('jsStatus', '‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
                            }
                        } else {
                            updateLog('jsLog', `‚ùå ${module}: –æ—à–∏–±–∫–∞ ${response.status}`);
                            updateStatus('jsStatus', '‚ùå –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π', 'error');
                        }
                    })
                    .catch(error => {
                        updateLog('jsLog', `‚ùå ${module}: ${error.message}`);
                        updateStatus('jsStatus', '‚ùå –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ –º–æ–¥—É–ª–µ–π', 'error');
                    });
            });
        }

        // FlashPost App Test
        function testApp() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ FlashPost –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            updateLog('appLog', '–ü—Ä–æ–≤–µ—Ä–∫–∞ FlashPost App...');
            
            if (typeof window.FlashPostApp !== 'undefined') {
                updateLog('appLog', '‚úÖ FlashPostApp –∫–ª–∞—Å—Å –Ω–∞–π–¥–µ–Ω');
                
                if (window.flashPostApp) {
                    updateLog('appLog', '‚úÖ flashPostApp —ç–∫–∑–µ–º–ø–ª—è—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                    updateStatus('appStatus', '‚úÖ FlashPost App –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'success');
                } else {
                    updateLog('appLog', '‚ùå flashPostApp —ç–∫–∑–µ–º–ø–ª—è—Ä –ù–ï –Ω–∞–π–¥–µ–Ω');
                    updateStatus('appStatus', '‚ùå App –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                }
            } else {
                updateLog('appLog', '‚ùå FlashPostApp –∫–ª–∞—Å—Å –ù–ï –Ω–∞–π–¥–µ–Ω');
                updateStatus('appStatus', '‚ùå App –∫–ª–∞—Å—Å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω', 'error');
            }
        }

        // Render Test
        function testRender() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞...');
            updateLog('renderLog', '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞...');
            
            const appElement = document.getElementById('app');
            if (appElement) {
                const content = appElement.innerHTML;
                updateLog('renderLog', `–°–æ–¥–µ—Ä–∂–∏–º–æ–µ #app: ${content.length} —Å–∏–º–≤–æ–ª–æ–≤`);
                
                if (content.trim().length > 0) {
                    updateLog('renderLog', '‚úÖ #app —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–æ–Ω—Ç–µ–Ω—Ç');
                    updateStatus('renderStatus', '‚úÖ –†–µ–Ω–¥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                } else {
                    updateLog('renderLog', '‚ùå #app –ø—É—Å—Ç–æ–π');
                    updateStatus('renderStatus', '‚ùå #app –ø—É—Å—Ç–æ–π', 'error');
                }
            } else {
                updateLog('renderLog', '‚ùå #app —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω');
                updateStatus('renderStatus', '‚ùå #app –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
            }
        }

        // Force Render
        function forceRender() {
            log('–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä...');
            updateLog('renderLog', '–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –≤—Å—Ç–∞–≤–∫–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞...');
            
            const appElement = document.getElementById('app');
            if (appElement) {
                appElement.innerHTML = `
                    <div style="min-height:100vh;background:#0f0f14;color:#fff;padding:20px;text-align:center;">
                        <h1 style="color:#4CAF50;font-size:32px;margin:20px 0;">üî¥ EMERGENCY RENDER WORKS</h1>
                        <p style="font-size:18px;margin:10px 0;">–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä —É—Å–ø–µ—à–µ–Ω</p>
                        <p style="font-size:14px;color:#ccc;">–í—Ä–µ–º—è: ${new Date().toLocaleTimeString()}</p>
                        <button onclick="openMainApp()" style="background:#007bff;color:white;border:none;padding:15px 30px;border-radius:5px;font-size:16px;margin:20px;cursor:pointer;">
                            –û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                        </button>
                    </div>
                `;
                updateLog('renderLog', '‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω');
                updateStatus('renderStatus', '‚úÖ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
            }
        }

        // Network Test
        function testNetwork() {
            log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–∏...');
            updateLog('networkLog', '–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤–æ–≥–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è...');
            
            fetch('/app.css')
                .then(response => {
                    updateLog('networkLog', `‚úÖ –°–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç: ${response.status}`);
                    updateStatus('networkStatus', '‚úÖ –°–µ—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                })
                .catch(error => {
                    updateLog('networkLog', `‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞: ${error.message}`);
                    updateStatus('networkStatus', '‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–µ—Ç—å—é', 'error');
                });
        }

        // Emergency Actions
        function emergencyReset() {
            log('–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Å–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è...');
            localStorage.clear();
            sessionStorage.clear();
            location.reload();
        }

        function emergencyRender() {
            log('–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞...');
            const emergencyApp = document.getElementById('emergencyApp');
            const emergencyContent = document.getElementById('emergencyContent');
            
            emergencyContent.innerHTML = `
                <div style="text-align:center;padding:20px;">
                    <h2 style="color:#4CAF50;">üÜò Emergency FlashPost Interface</h2>
                    <p>–≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω</p>
                    <button onclick="location.href='/index.html'" style="background:#28a745;color:white;border:none;padding:15px 30px;border-radius:5px;margin:10px;cursor:pointer;">
                        –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
                    </button>
                </div>
            `;
            emergencyApp.style.display = 'block';
        }

        function runFullDiagnosis() {
            log('–ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...');
            updateStatus('overallStatus', 'üîÑ –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞...', 'info');
            
            setTimeout(() => testDOM(), 100);
            setTimeout(() => testCSS(), 500);
            setTimeout(() => testJS(), 1000);
            setTimeout(() => testApp(), 1500);
            setTimeout(() => testRender(), 2000);
            setTimeout(() => testNetwork(), 2500);
            
            setTimeout(() => {
                updateStatus('overallStatus', '‚úÖ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');
            }, 3000);
        }

        function openMainApp() {
            window.open('/index.html', '_blank');
        }

        // Auto-run diagnosis on load
        window.addEventListener('load', () => {
            setTimeout(runFullDiagnosis, 1000);
        });
    </script>
</body>
</html>