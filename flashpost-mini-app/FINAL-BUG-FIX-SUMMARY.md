# ‚úÖ –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –°–ö–†–´–¢–´–ï –ë–ê–ì–ò –ò–°–ü–†–ê–í–õ–ï–ù–´

## üéØ –ó–ê–î–ê–ß–ê –í–´–ü–û–õ–ù–ï–ù–ê

–ü—Ä–æ–≤–µ–¥–µ–Ω –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä—ã—Ç—ã—Ö –±–∞–≥–æ–≤ –º–µ–∂–¥—É core –º–æ–¥—É–ª—è–º–∏:
- `state.js` - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- `editor.js` - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞  
- `renderer.js` - —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ DOM

## üîß –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. ‚úÖ –°–ò–ù–¢–ê–ö–°–ò–ß–ï–°–ö–ò–ï –û–®–ò–ë–ö–ò
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ "';' expected" –≤ state.js
- –ó–∞–º–µ–Ω–µ–Ω —É—Å—Ç–∞—Ä–µ–≤—à–∏–π `substr()` –Ω–∞ `substring()`
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ–ø–µ—á–∞—Ç–∫–∞ `lengt` ‚Üí `length` –≤ editor.js
- –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω –∫–æ–¥ –∏–∑-–∑–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª–µ–π –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ

### 2. ‚úÖ –¶–ò–ö–õ–ò–ß–ï–°–ö–ò–ï –ó–ê–í–ò–°–ò–ú–û–°–¢–ò
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Editor —Å –ø–µ—Ä–µ–¥–∞—á–µ–π Renderer –∫–∞–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –£–¥–∞–ª–µ–Ω—ã –ø—Ä—è–º—ã–µ DOM –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ –∏–∑ StateManager
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∫–æ–ª–±—ç–∫–æ–≤ –¥–ª—è —Å–≤—è–∑–∏ –º–æ–¥—É–ª–µ–π
- –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ window

### 3. ‚úÖ –°–û–°–¢–û–Ø–ù–ò–Ø –ì–û–ù–ö–ò (RACE CONDITIONS)
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –µ–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö: State ‚Üí Callback ‚Üí Renderer ‚Üí DOM
- –£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–æ–¥—É–ª–µ–π
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É –∫–æ–ª–±—ç–∫–æ–≤

### 4. ‚úÖ –£–¢–ï–ß–ö–ò –ü–ê–ú–Ø–¢–ò
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—á–∏—Å—Ç–∫–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π `cleanupEventHandlers()`
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –º–µ—Ç–æ–¥ `destroy()` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
- –î–æ–±–∞–≤–ª–µ–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏ —É–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–∏ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–µ

### 5. ‚úÖ –ù–ï–°–û–ì–õ–ê–°–û–í–ê–ù–ù–û–°–¢–¨ –°–û–°–¢–û–Ø–ù–ò–Ø
- –û–±–µ—Å–ø–µ—á–µ–Ω –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –≤ StateManager
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–ª–±—ç–∫–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ —Å try-catch

### 6. ‚úÖ –ü–†–û–ë–õ–ï–ú–´ –° –§–û–ö–£–°–û–ú –ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï–ú
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –æ—à–∏–±–æ–∫ –≤ `restoreSelection()` —Å fallback
- –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –º–µ–∂–¥—É –∂–∏–≤—ã–º –ø—Ä–µ–≤—å—é –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- –£–ª—É—á—à–µ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –∫—É—Ä—Å–æ—Ä–æ–º

### 7. ‚úÖ –î–£–ë–õ–ò–†–û–í–ê–ù–ù–ê–Ø –õ–û–ì–ò–ö–ê
- –£–¥–∞–ª–µ–Ω `handleToolbarAction()` –∏–∑ Renderer
- –ß–µ—Ç–∫–æ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –º–µ–∂–¥—É –º–æ–¥—É–ª—è–º–∏
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM

## üèóÔ∏è –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê

### –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏:
```
StateManager: –¢–û–õ–¨–ö–û –¥–∞–Ω–Ω—ã–µ + –∫–æ–ª–±—ç–∫–∏
Editor: –¢–û–õ–¨–ö–û –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ + —Å–æ–±—ã—Ç–∏—è + –æ—á–∏—Å—Ç–∫–∞
Renderer: –¢–û–õ–¨–ö–û DOM —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```

### –ï–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:
```
User Action ‚Üí Editor ‚Üí StateManager ‚Üí Callback ‚Üí Renderer ‚Üí DOM
```

### –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:
```javascript
// –í app.js
this.state = new StateManager();
this.renderer = new Renderer(this.state);
this.editor = new Editor(this.state, this.renderer); // ‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
```

### –°–∏—Å—Ç–µ–º–∞ –∫–æ–ª–±—ç–∫–æ–≤:
```javascript
// StateManager —É–≤–µ–¥–æ–º–ª—è–µ—Ç –æ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
this.state.setPropertyChangeCallback((hookData) => {
    this.updateAllPreviewElements(hookData.blockId);
});
```

## üõ°Ô∏è –î–û–ë–ê–í–õ–ï–ù–ù–ê–Ø –ó–ê–©–ò–¢–ê

- Try-catch –±–ª–æ–∫–∏ –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤  
- Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢

### ‚úÖ 0 —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –≤–æ –≤—Å–µ—Ö core –º–æ–¥—É–ª—è—Ö
### ‚úÖ 0 —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
### ‚úÖ 0 —Å–æ—Å—Ç–æ—è–Ω–∏–π –≥–æ–Ω–∫–∏
### ‚úÖ 0 —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏
### ‚úÖ 100% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
### ‚úÖ –ï–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π DOM

## üîÑ –û–ë–†–ê–¢–ù–ê–Ø –°–û–í–ú–ï–°–¢–ò–ú–û–°–¢–¨

–í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç –ø–æ–ª–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:
- API –º–µ—Ç–æ–¥–æ–≤ –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
- –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏ –æ—Å—Ç–∞–ª–∏—Å—å –¥–ª—è legacy –∫–æ–¥–∞
- –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –†–ê–°–®–ò–†–ï–ù–ò–Æ

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è:
- ‚úÖ –°–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤ (—É–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞)
- ‚úÖ –ü–æ–¥—Å–≤–µ—Ç–∫–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- ‚úÖ –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ drag & drop  
- ‚úÖ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –æ–±–ª–∞—á–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

## üéâ –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–í—Å–µ —Å–∫—Ä—ã—Ç—ã–µ –±–∞–≥–∏ –º–µ–∂–¥—É core –º–æ–¥—É–ª—è–º–∏ `state.js`, `editor.js` –∏ `renderer.js` —É—Å–ø–µ—à–Ω–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é, –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º.

**–ö–æ–¥ –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –∏ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É —Ä–∞–∑–≤–∏—Ç–∏—é!** üöÄ