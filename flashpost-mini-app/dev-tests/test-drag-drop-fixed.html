<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Drag & Drop - FlashPost</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Inter, sans-serif;
            background: linear-gradient(135deg, #833ab4 0%, #fd1d1d 25%, #fcb045 50%, #f77737 75%, #e1306c 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .title {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        
        .slide-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: #ff6b6b;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 20px;
            user-select: none;
        }
        
        .text-block {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 12px;
            cursor: move;
            font-family: Inter, sans-serif;
            font-size: 18px;
            color: #333;
            min-width: 100px;
            min-height: 40px;
            transition: border-color 0.2s ease;
            box-sizing: border-box;
        }
        
        .text-block:hover {
            border-color: #833ab4;
        }
        
        .text-block.dragging {
            border-color: #833ab4;
            box-shadow: 0 4px 12px rgba(131, 58, 180, 0.3);
            z-index: 1000;
        }
        
        .text-block.resizing {
            border-color: #28a745;
        }
        
        .resize-handle {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 12px;
            height: 12px;
            background: #28a745;
            cursor: se-resize;
            border-radius: 2px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .control-group {
            background: #f8f9fa;
            padding: 16px;
            border-radius: 12px;
        }
        
        .control-group h3 {
            margin: 0 0 12px 0;
            color: #495057;
            font-size: 16px;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 4px;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: #833ab4;
            color: white;
        }
        
        .btn-primary:hover {
            background: #6d2d96;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .state-info {
            background: #e9ecef;
            padding: 16px;
            border-radius: 12px;
            font-size: 14px;
            font-family: monospace;
        }
        
        .state-info h4 {
            margin: 0 0 12px 0;
            color: #495057;
            font-family: Inter, sans-serif;
        }
        
        .block-info {
            margin-bottom: 8px;
            padding: 8px;
            background: white;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π Drag & Drop</h1>
        
        <div class="controls">
            <div class="control-group">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞–º–∏</h3>
                <button class="btn btn-primary" onclick="addTextBlock()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
                <button class="btn btn-success" onclick="resetBlocks()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
            
            <div class="control-group">
                <h3>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</h3>
                <button class="btn btn-primary" onclick="testDragBoundaries()">üéØ –¢–µ—Å—Ç –≥—Ä–∞–Ω–∏—Ü</button>
                <button class="btn btn-success" onclick="testResize()">üìè –¢–µ—Å—Ç —Ä–∞–∑–º–µ—Ä–∞</button>
            </div>
        </div>
        
        <div class="slide-container" id="slideContainer">
            <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JS -->
        </div>
        
        <div class="state-info" id="stateInfo">
            <h4>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:</h4>
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–ª–æ–∫–∞—Ö -->
        </div>
    </div>

    <script>
        // ===== –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê DRAG & DROP =====
        
        class FixedDragDropSystem {
            constructor() {
                this.textBlocks = [];
                this.dragState = {
                    isDragging: false,
                    isResizing: false,
                    activeBlockId: null,
                    startX: 0,
                    startY: 0,
                    startBlockX: 0,
                    startBlockY: 0,
                    startBlockWidth: 0
                };
                
                this.slideContainer = document.getElementById('slideContainer');
                this.init();
            }
            
            init() {
                this.createInitialBlocks();
                this.bindEvents();
                this.render();
                this.updateStateInfo();
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤
            createInitialBlocks() {
                this.textBlocks = [
                    {
                        id: 'block_1',
                        text: '–ü–µ—Ä–µ—Ç–∞—â–∏ –º–µ–Ω—è!',
                        x: 10,      // –ü—Ä–æ—Ü–µ–Ω—Ç—ã
                        y: 20,      // –ü—Ä–æ—Ü–µ–Ω—Ç—ã  
                        width: 30,  // –ü—Ä–æ—Ü–µ–Ω—Ç—ã
                        font: 'Inter',
                        size: 18
                    },
                    {
                        id: 'block_2',
                        text: '–ò–∑–º–µ–Ω–∏ –º–æ–π —Ä–∞–∑–º–µ—Ä!',
                        x: 50,
                        y: 40,
                        width: 35,
                        font: 'Inter',
                        size: 16
                    }
                ];
            }
            
            // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
            bindEvents() {
                // –û—Ç–∫–ª—é—á–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é
                this.slideContainer.addEventListener('contextmenu', (e) => e.preventDefault());
                
                // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –º—ã—à–∏
                document.addEventListener('mousemove', (e) => this.handleMouseMove(e));
                document.addEventListener('mouseup', (e) => this.handleMouseUp(e));
                
                // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
                document.addEventListener('selectstart', (e) => {
                    if (this.dragState.isDragging || this.dragState.isResizing) {
                        e.preventDefault();
                    }
                });
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            handleMouseDown(e, blockId, isResize = false) {
                e.preventDefault();
                e.stopPropagation();
                
                const block = this.getBlock(blockId);
                if (!block) return;
                
                const slideRect = this.slideContainer.getBoundingClientRect();
                
                this.dragState = {
                    isDragging: !isResize,
                    isResizing: isResize,
                    activeBlockId: blockId,
                    startX: e.clientX,
                    startY: e.clientY,
                    startBlockX: block.x,
                    startBlockY: block.y,
                    startBlockWidth: block.width,
                    slideRect: slideRect
                };
                
                console.log(`üéØ –ù–∞—á–∞–ª–æ ${isResize ? '–∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞' : '–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è'}: ${blockId}`);
                this.render();
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è –º—ã—à–∏
            handleMouseMove(e) {
                if (!this.dragState.isDragging && !this.dragState.isResizing) return;
                
                e.preventDefault();
                
                const block = this.getBlock(this.dragState.activeBlockId);
                if (!block) return;
                
                const slideRect = this.dragState.slideRect;
                const deltaX = e.clientX - this.dragState.startX;
                const deltaY = e.clientY - this.dragState.startY;
                
                if (this.dragState.isDragging) {
                    // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ - –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
                    const deltaXPercent = (deltaX / slideRect.width) * 100;
                    const deltaYPercent = (deltaY / slideRect.height) * 100;
                    
                    let newX = this.dragState.startBlockX + deltaXPercent;
                    let newY = this.dragState.startBlockY + deltaYPercent;
                    
                    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü —Å —É—á–µ—Ç–æ–º —à–∏—Ä–∏–Ω—ã –±–ª–æ–∫–∞
                    newX = Math.max(0, Math.min(100 - block.width, newX));
                    newY = Math.max(0, Math.min(100 - 15, newY)); // 15% –ø—Ä–∏–º–µ—Ä–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –±–ª–æ–∫–∞
                    
                    block.x = newX;
                    block.y = newY;
                    
                } else if (this.dragState.isResizing) {
                    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ - –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º —à–∏—Ä–∏–Ω—É –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
                    const deltaWidthPercent = (deltaX / slideRect.width) * 100;
                    let newWidth = this.dragState.startBlockWidth + deltaWidthPercent;
                    
                    // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
                    const minWidth = 15; // –ú–∏–Ω–∏–º—É–º 15%
                    const maxWidth = 100 - block.x; // –ù–µ –≤—ã—Ö–æ–¥–∏–º –∑–∞ –ø—Ä–∞–≤—É—é –≥—Ä–∞–Ω–∏—Ü—É
                    
                    newWidth = Math.max(minWidth, Math.min(maxWidth, newWidth));
                    block.width = newWidth;
                }
                
                this.render();
                this.updateStateInfo();
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—É—Å–∫–∞–Ω–∏—è –º—ã—à–∏
            handleMouseUp(e) {
                if (this.dragState.isDragging || this.dragState.isResizing) {
                    console.log(`‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ ${this.dragState.isResizing ? '–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞' : '–ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ'}`);
                    
                    this.dragState = {
                        isDragging: false,
                        isResizing: false,
                        activeBlockId: null,
                        startX: 0,
                        startY: 0,
                        startBlockX: 0,
                        startBlockY: 0,
                        startBlockWidth: 0
                    };
                    
                    this.render();
                    this.updateStateInfo();
                }
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –±–ª–æ–∫–∞ –ø–æ ID
            getBlock(blockId) {
                return this.textBlocks.find(block => block.id === blockId);
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±–ª–æ–∫–∞
            addBlock() {
                const newBlock = {
                    id: `block_${Date.now()}`,
                    text: `–ù–æ–≤—ã–π –±–ª–æ–∫ ${this.textBlocks.length + 1}`,
                    x: Math.random() * 50 + 10, // 10-60%
                    y: Math.random() * 50 + 10, // 10-60%
                    width: 25 + Math.random() * 20, // 25-45%
                    font: 'Inter',
                    size: 16 + Math.random() * 8 // 16-24px
                };
                
                this.textBlocks.push(newBlock);
                console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫: ${newBlock.id}`);
                
                this.render();
                this.updateStateInfo();
            }
            
            // –°–±—Ä–æ—Å –±–ª–æ–∫–æ–≤
            resetBlocks() {
                this.createInitialBlocks();
                this.render();
                this.updateStateInfo();
                console.log('üîÑ –ë–ª–æ–∫–∏ —Å–±—Ä–æ—à–µ–Ω—ã');
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –±–ª–æ–∫–æ–≤
            render() {
                this.slideContainer.innerHTML = '';
                
                this.textBlocks.forEach(block => {
                    const blockElement = document.createElement('div');
                    blockElement.className = 'text-block';
                    blockElement.id = block.id;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
                    if (this.dragState.activeBlockId === block.id) {
                        if (this.dragState.isDragging) {
                            blockElement.classList.add('dragging');
                        } else if (this.dragState.isResizing) {
                            blockElement.classList.add('resizing');
                        }
                    }
                    
                    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –∏ —Ä–∞–∑–º–µ—Ä –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
                    blockElement.style.left = `${block.x}%`;
                    blockElement.style.top = `${block.y}%`;
                    blockElement.style.width = `${block.width}%`;
                    blockElement.style.fontSize = `${block.size}px`;
                    blockElement.style.fontFamily = block.font;
                    
                    blockElement.textContent = block.text;
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
                    blockElement.addEventListener('mousedown', (e) => {
                        this.handleMouseDown(e, block.id, false);
                    });
                    
                    // –°–æ–∑–¥–∞–µ–º —Ä—É—á–∫—É –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
                    const resizeHandle = document.createElement('div');
                    resizeHandle.className = 'resize-handle';
                    resizeHandle.addEventListener('mousedown', (e) => {
                        this.handleMouseDown(e, block.id, true);
                    });
                    
                    blockElement.appendChild(resizeHandle);
                    this.slideContainer.appendChild(blockElement);
                });
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
            updateStateInfo() {
                const stateInfo = document.getElementById('stateInfo');
                
                let html = '<h4>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:</h4>';
                
                this.textBlocks.forEach((block, index) => {
                    const isActive = this.dragState.activeBlockId === block.id;
                    html += `
                        <div class="block-info" style="border-left: 4px solid ${isActive ? '#833ab4' : '#dee2e6'};">
                            <strong>–ë–ª–æ–∫ ${index + 1} (${block.id}):</strong><br>
                            –ü–æ–∑–∏—Ü–∏—è: ${block.x.toFixed(1)}%, ${block.y.toFixed(1)}%<br>
                            –®–∏—Ä–∏–Ω–∞: ${block.width.toFixed(1)}%<br>
                            –¢–µ–∫—Å—Ç: "${block.text}"
                            ${isActive ? '<br><em>üéØ –ê–∫—Ç–∏–≤–Ω—ã–π</em>' : ''}
                        </div>
                    `;
                });
                
                html += `
                    <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #dee2e6;">
                        <strong>Drag State:</strong><br>
                        –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ: ${this.dragState.isDragging ? '‚úÖ' : '‚ùå'}<br>
                        –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞: ${this.dragState.isResizing ? '‚úÖ' : '‚ùå'}<br>
                        –ê–∫—Ç–∏–≤–Ω—ã–π –±–ª–æ–∫: ${this.dragState.activeBlockId || '–Ω–µ—Ç'}
                    </div>
                `;
                
                stateInfo.innerHTML = html;
            }
            
            // –¢–µ—Å—Ç –≥—Ä–∞–Ω–∏—Ü
            testBoundaries() {
                // –†–∞–∑–º–µ—â–∞–µ–º –±–ª–æ–∫–∏ –ø–æ –∫—Ä–∞—è–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥—Ä–∞–Ω–∏—Ü
                if (this.textBlocks.length >= 4) {
                    this.textBlocks[0].x = 0;   // –õ–µ–≤—ã–π –∫—Ä–∞–π
                    this.textBlocks[0].y = 0;   // –í–µ—Ä—Ö–Ω–∏–π –∫—Ä–∞–π
                    
                    this.textBlocks[1].x = 70;  // –ü—Ä–∞–≤—ã–π –∫—Ä–∞–π (—Å —É—á–µ—Ç–æ–º —à–∏—Ä–∏–Ω—ã 30%)
                    this.textBlocks[1].y = 0;
                    
                    this.textBlocks[2].x = 0;
                    this.textBlocks[2].y = 85;  // –ù–∏–∂–Ω–∏–π –∫—Ä–∞–π
                    
                    this.textBlocks[3].x = 70;
                    this.textBlocks[3].y = 85;  // –ü—Ä–∞–≤—ã–π –Ω–∏–∂–Ω–∏–π —É–≥–æ–ª
                    
                    this.render();
                    this.updateStateInfo();
                    console.log('üéØ –¢–µ—Å—Ç –≥—Ä–∞–Ω–∏—Ü –≤—ã–ø–æ–ª–Ω–µ–Ω');
                }
            }
            
            // –¢–µ—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
            testResize() {
                this.textBlocks.forEach((block, index) => {
                    block.width = 15 + (index * 15); // –†–∞–∑–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã
                });
                
                this.render();
                this.updateStateInfo();
                console.log('üìè –¢–µ—Å—Ç —Ä–∞–∑–º–µ—Ä–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
        let dragSystem;
        
        document.addEventListener('DOMContentLoaded', () => {
            dragSystem = new FixedDragDropSystem();
            console.log('üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Drag & Drop –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        function addTextBlock() {
            dragSystem.addBlock();
        }
        
        function resetBlocks() {
            dragSystem.resetBlocks();
        }
        
        function testDragBoundaries() {
            dragSystem.testBoundaries();
        }
        
        function testResize() {
            dragSystem.testResize();
        }
    </script>
</body>
</html>