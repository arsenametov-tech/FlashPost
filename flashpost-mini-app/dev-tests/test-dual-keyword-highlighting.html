<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –¥–≤–æ–π–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤</title>
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            background: #fafafa;
        }

        .test-section h3 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #833ab4;
            padding-bottom: 10px;
        }

        .slide-preview {
            background: linear-gradient(135deg, #833ab4, #fd1d1d, #fcb045);
            border-radius: 12px;
            padding: 40px;
            margin: 20px 0;
            position: relative;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .text-block {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: white;
            font-size: 18px;
            line-height: 1.4;
            max-width: 80%;
        }

        /* –†—É—á–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (*—Å–ª–æ–≤–æ*) */
        .manual-keyword {
            background: linear-gradient(45deg, #48cae4, #0077b6);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            filter: drop-shadow(0 0 6px rgba(72, 202, 228, 0.8));
            animation: manual-keyword-glow 2s ease-in-out infinite alternate;
            display: inline;
            text-shadow: none;
        }

        /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (–∏–∑ autoKeywords) */
        .auto-keyword {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            filter: drop-shadow(0 0 6px rgba(255, 107, 107, 0.8));
            animation: auto-keyword-glow 2s ease-in-out infinite alternate;
            display: inline;
            text-shadow: none;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏–∏ —Å–≤–µ—á–µ–Ω–∏—è */
        @keyframes manual-keyword-glow {
            from { filter: drop-shadow(0 0 6px rgba(72, 202, 228, 0.8)); }
            to { filter: drop-shadow(0 0 12px rgba(72, 202, 228, 1)); }
        }

        @keyframes auto-keyword-glow {
            from { filter: drop-shadow(0 0 6px rgba(255, 107, 107, 0.8)); }
            to { filter: drop-shadow(0 0 12px rgba(255, 107, 107, 1)); }
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .control-group {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .control-group input[type="checkbox"] {
            margin-right: 8px;
        }

        .control-group input[type="color"] {
            width: 50px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .control-group input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }

        .range-value {
            font-weight: bold;
            color: #833ab4;
        }

        .test-results {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .test-results h4 {
            color: #2e7d32;
            margin-top: 0;
        }

        .test-item {
            margin: 10px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border-left: 4px solid #4caf50;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .legend-sample {
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: 700;
            font-size: 12px;
        }

        .btn {
            background: #833ab4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #6a2c91;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #545b62;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üé® –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –¥–≤–æ–π–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤</h1>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Ä—É—á–Ω–æ–π (*—Å–ª–æ–≤–æ*) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π (AI) –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤</p>
        </div>

        <div class="legend">
            <div class="legend-item">
                <span class="legend-sample manual-keyword">—Ä—É—á–Ω—ã–µ</span>
                <span>–†—É—á–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (*—Å–ª–æ–≤–æ*)</span>
            </div>
            <div class="legend-item">
                <span class="legend-sample auto-keyword">–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ</span>
                <span>AI –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</span>
            </div>
            <div class="legend-item">
                <span>–æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç</span>
                <span>–ë–µ–∑ –ø–æ–¥—Å–≤–µ—Ç–∫–∏</span>
            </div>
        </div>

        <div class="test-section">
            <h3>üìù –¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞</h3>
            <div class="slide-preview">
                <div class="text-block" id="testBlock1">
                    –ò–∑—É—á–∞–π—Ç–µ *—Ä—ã–Ω–æ–∫* –∏ –¥–µ–ª–∞–π—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏
                </div>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="autoHighlight1" checked>
                        –ê–≤—Ç–æ–ø–æ–¥—Å–≤–µ—Ç–∫–∞ AI
                    </label>
                </div>
                <div class="control-group">
                    <label>–¶–≤–µ—Ç —Ä—É—á–Ω—ã—Ö (*—Å–ª–æ–≤–æ*):</label>
                    <input type="color" id="manualColor1" value="#E74C3C">
                </div>
                <div class="control-group">
                    <label>–¶–≤–µ—Ç AI –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤:</label>
                    <input type="color" id="autoColor1" value="#4A90E2">
                </div>
                <div class="control-group">
                    <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Å–≤–µ—á–µ–Ω–∏—è: <span class="range-value" id="glowValue1">30%</span></label>
                    <input type="range" id="glowIntensity1" min="0" max="1" step="0.1" value="0.3">
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>üéØ –¢–µ—Å—Ç 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</h3>
            <div class="slide-preview">
                <div class="text-block" id="testBlock2">
                    *–£—Å–ø–µ—à–Ω—ã–µ* –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏ –∏–∑—É—á–∞—é—Ç —Ä—ã–Ω–æ–∫, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç *–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤* –∏ —Å–æ–∑–¥–∞—é—Ç –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏ –¥–ª—è —Ä–æ—Å—Ç–∞ –±–∏–∑–Ω–µ—Å–∞
                </div>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="autoHighlight2" checked>
                        –ê–≤—Ç–æ–ø–æ–¥—Å–≤–µ—Ç–∫–∞ AI
                    </label>
                </div>
                <div class="control-group">
                    <label>–¶–≤–µ—Ç —Ä—É—á–Ω—ã—Ö (*—Å–ª–æ–≤–æ*):</label>
                    <input type="color" id="manualColor2" value="#E74C3C">
                </div>
                <div class="control-group">
                    <label>–¶–≤–µ—Ç AI –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤:</label>
                    <input type="color" id="autoColor2" value="#4A90E2">
                </div>
                <div class="control-group">
                    <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Å–≤–µ—á–µ–Ω–∏—è: <span class="range-value" id="glowValue2">30%</span></label>
                    <input type="range" id="glowIntensity2" min="0" max="1" step="0.1" value="0.3">
                </div>
            </div>
        </div>

        <div class="test-section">
            <h3>üîß –¢–µ—Å—Ç 3: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–ø–æ–¥—Å–≤–µ—Ç–∫–∏</h3>
            <div class="slide-preview">
                <div class="text-block" id="testBlock3">
                    –¢–æ–ª—å–∫–æ *–≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ* —Å–ª–æ–≤–∞ –¥–æ–ª–∂–Ω—ã —Å–≤–µ—Ç–∏—Ç—å—Å—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä—ã–Ω–æ–∫ –∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–º–∏
                </div>
            </div>
            <div class="controls">
                <div class="control-group">
                    <label>
                        <input type="checkbox" id="autoHighlight3">
                        –ê–≤—Ç–æ–ø–æ–¥—Å–≤–µ—Ç–∫–∞ AI (–æ—Ç–∫–ª—é—á–µ–Ω–∞)
                    </label>
                </div>
                <div class="control-group">
                    <label>–¶–≤–µ—Ç —Ä—É—á–Ω—ã—Ö (*—Å–ª–æ–≤–æ*):</label>
                    <input type="color" id="manualColor3" value="#E74C3C">
                </div>
                <div class="control-group">
                    <label>–¶–≤–µ—Ç AI –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤:</label>
                    <input type="color" id="autoColor3" value="#4A90E2">
                </div>
                <div class="control-group">
                    <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Å–≤–µ—á–µ–Ω–∏—è: <span class="range-value" id="glowValue3">30%</span></label>
                    <input type="range" id="glowIntensity3" min="0" max="1" step="0.1" value="0.3">
                </div>
            </div>
        </div>

        <div class="test-results">
            <h4>‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h4>
            <div id="testResults"></div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <button class="btn" onclick="runAllTests()">üß™ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <button class="btn btn-secondary" onclick="resetTests()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
        </div>
    </div>

    <script>
        // –ò–º–∏—Ç–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        class MockRenderer {
            setTextWithKeywords(element, text, autoKeywords = [], keywordSettings = null) {
                console.log('üöÄ setTextWithKeywords called:', {
                    text: `"${text}"`,
                    autoKeywords: autoKeywords,
                    keywordSettings: keywordSettings
                });
                
                // –ü–æ–ª—É—á–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∏–∑ –±–ª–æ–∫–∞ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
                const settings = keywordSettings || {
                    autoHighlight: true,
                    keywordColor: '#E74C3C',
                    autoKeywordColor: '#4A90E2',
                    glowEnabled: true,
                    glowIntensity: 0.3
                };
                
                console.log('‚öôÔ∏è Using settings:', settings);
                
                // –û—á–∏—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
                element.innerHTML = '';
                
                let processedText = text;
                const fragments = [];
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä—É—á–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (*—Å–ª–æ–≤–æ*)
                const manualKeywordRegex = /\*([^*]+)\*/g;
                let lastIndex = 0;
                let match;
                
                console.log('üîç Looking for manual keywords with regex:', manualKeywordRegex);
                
                while ((match = manualKeywordRegex.exec(text)) !== null) {
                    console.log('‚úÖ Found manual keyword:', match[1], 'at position', match.index);
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –¥–æ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                    if (match.index > lastIndex) {
                        const beforeText = text.substring(lastIndex, match.index);
                        console.log('üìù Adding text before manual keyword:', `"${beforeText}"`);
                        fragments.push({
                            type: 'text',
                            content: beforeText
                        });
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ä—É—á–Ω–æ–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
                    fragments.push({
                        type: 'manual-keyword',
                        content: match[1],
                        color: settings.keywordColor
                    });
                    
                    lastIndex = match.index + match[0].length;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–π—Å—è —Ç–µ–∫—Å—Ç
                if (lastIndex < text.length) {
                    const remainingText = text.substring(lastIndex);
                    console.log('üìù Adding remaining text:', `"${remainingText}"`);
                    fragments.push({
                        type: 'text',
                        content: remainingText
                    });
                }
                
                console.log('üìä Total fragments created:', fragments.length);
                fragments.forEach((frag, i) => {
                    console.log(`  [${i}] ${frag.type}: "${frag.content}"`);
                });
                
                // –°–æ–∑–¥–∞–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã
                fragments.forEach((fragment, index) => {
                    console.log(`üîß Processing fragment [${index}]:`, fragment.type, `"${fragment.content}"`);
                    
                    if (fragment.type === 'manual-keyword') {
                        const span = document.createElement('span');
                        span.className = 'manual-keyword';
                        span.textContent = fragment.content;
                        
                        console.log('üé® Created manual-keyword span for:', fragment.content);
                        
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ü–≤–µ—Ç –µ—Å–ª–∏ –∑–∞–¥–∞–Ω
                        if (fragment.color && fragment.color !== '#E74C3C') {
                            span.style.background = fragment.color;
                        }
                        
                        // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–≤–µ—á–µ–Ω–∏–µ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
                        if (settings.glowEnabled && settings.glowIntensity > 0) {
                            const glowColor = this.hexToRgba(fragment.color || '#E74C3C', settings.glowIntensity);
                            span.style.filter = `drop-shadow(0 0 ${settings.glowIntensity * 20}px ${glowColor})`;
                        }
                        
                        element.appendChild(span);
                    } else {
                        console.log('üîÑ Calling addTextWithAutoKeywords for fragment:', `"${fragment.content}"`);
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –æ–±—ã—á–Ω–æ–º —Ç–µ–∫—Å—Ç–µ
                        this.addTextWithAutoKeywords(element, fragment.content, autoKeywords, settings);
                    }
                });
                
                console.log('‚úÖ setTextWithKeywords completed');
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
            addTextWithAutoKeywords(parent, text, autoKeywords, settings) {
                console.log('üîç addTextWithAutoKeywords called:', {
                    text: `"${text}"`,
                    autoKeywords: autoKeywords,
                    autoHighlight: settings.autoHighlight,
                    textLength: text.length
                });
                
                // –ï—Å–ª–∏ –∞–≤—Ç–æ–ø–æ–¥—Å–≤–µ—Ç–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∏–ª–∏ –Ω–µ—Ç –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, –¥–æ–±–∞–≤–ª—è–µ–º –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç
                if (!settings.autoHighlight || autoKeywords.length === 0) {
                    console.log('‚ö†Ô∏è Auto-highlight disabled or no keywords, adding plain text');
                    parent.appendChild(document.createTextNode(text));
                    return;
                }
                
                let processedText = text;
                console.log('üìù Starting with text:', `"${processedText}"`);
                
                autoKeywords.forEach((keyword, index) => {
                    // Create a regex that matches the keyword with word boundaries
                    // For Cyrillic text, we need to be more careful with word boundaries
                    const escapedKeyword = this.escapeRegex(keyword);
                    
                    // Try multiple regex patterns to handle different cases
                    const patterns = [
                        new RegExp(`\\b(${escapedKeyword})\\b`, 'gi'),  // Standard word boundaries
                        new RegExp(`(^|\\s)(${escapedKeyword})(\\s|$)`, 'gi'),  // Space boundaries
                        new RegExp(`(${escapedKeyword})`, 'gi')  // Simple match (fallback)
                    ];
                    
                    console.log(`üîç [${index}] Looking for keyword "${keyword}"`);
                    
                    let matched = false;
                    for (let p = 0; p < patterns.length; p++) {
                        const regex = patterns[p];
                        console.log(`   Trying pattern ${p + 1}:`, regex);
                        
                        const beforeReplace = processedText;
                        
                        if (p === 1) {
                            // For space boundaries, we need to preserve the spaces
                            processedText = processedText.replace(regex, '$1<AUTO_KEYWORD>$2</AUTO_KEYWORD>$3');
                        } else {
                            processedText = processedText.replace(regex, '<AUTO_KEYWORD>$1</AUTO_KEYWORD>');
                        }
                        
                        if (beforeReplace !== processedText) {
                            console.log(`‚úÖ [${index}] Pattern ${p + 1} worked! Found and replaced "${keyword}"`);
                            console.log(`   Before: "${beforeReplace}"`);
                            console.log(`   After:  "${processedText}"`);
                            matched = true;
                            break;
                        }
                    }
                    
                    if (!matched) {
                        console.log(`‚ùå [${index}] No patterns worked for "${keyword}"`);
                        console.log(`   Text contains "${keyword}"?`, processedText.includes(keyword));
                        console.log(`   Text toLowerCase contains "${keyword.toLowerCase()}"?`, processedText.toLowerCase().includes(keyword.toLowerCase()));
                    }
                });
                
                console.log('üéØ Final processed text:', `"${processedText}"`);
                
                // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏
                const segments = processedText.split(/<AUTO_KEYWORD>|<\/AUTO_KEYWORD>/);
                console.log('üìä Split segments:', segments);
                
                let isKeyword = false;
                let keywordCount = 0;
                
                segments.forEach((segment, index) => {
                    if (segment) {
                        console.log(`üìù [${index}] Processing segment: "${segment}", isKeyword: ${isKeyword}`);
                        
                        if (isKeyword) {
                            const span = document.createElement('span');
                            span.className = 'auto-keyword';
                            span.textContent = segment;
                            keywordCount++;
                            
                            console.log(`üé® Created auto-keyword span for: "${segment}"`);
                            
                            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ü–≤–µ—Ç –µ—Å–ª–∏ –∑–∞–¥–∞–Ω
                            if (settings.autoKeywordColor && settings.autoKeywordColor !== '#4A90E2') {
                                span.style.background = settings.autoKeywordColor;
                            }
                            
                            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Å–≤–µ—á–µ–Ω–∏–µ –µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–æ
                            if (settings.glowEnabled && settings.glowIntensity > 0) {
                                const glowColor = this.hexToRgba(settings.autoKeywordColor || '#4A90E2', settings.glowIntensity);
                                span.style.filter = `drop-shadow(0 0 ${settings.glowIntensity * 20}px ${glowColor})`;
                            }
                            
                            parent.appendChild(span);
                        } else {
                            console.log(`üìÑ Adding text node: "${segment}"`);
                            parent.appendChild(document.createTextNode(segment));
                        }
                    }
                    isKeyword = !isKeyword;
                });
                
                console.log(`üéâ Total auto-keywords created: ${keywordCount}`);
            }
            
            // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ü–≤–µ—Ç–∞–º–∏
            hexToRgba(hex, alpha) {
                const r = parseInt(hex.slice(1, 3), 16);
                const g = parseInt(hex.slice(3, 5), 16);
                const b = parseInt(hex.slice(5, 7), 16);
                return `rgba(${r}, ${g}, ${b}, ${alpha})`;
            }
            
            escapeRegex(string) {
                return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const renderer = new MockRenderer();
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const testData = {
            1: {
                text: "–ò–∑—É—á–∞–π—Ç–µ *—Ä—ã–Ω–æ–∫* –∏ –¥–µ–ª–∞–π—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏",
                autoKeywords: ["–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏", "–ø—Ä–∏–±—ã–ª–∏"] // –£–±—Ä–∞–ª–∏ "—Ä—ã–Ω–æ–∫" —Ç–∞–∫ –∫–∞–∫ –æ–Ω —É–∂–µ —Ä—É—á–Ω–æ–π
            },
            2: {
                text: "*–£—Å–ø–µ—à–Ω—ã–µ* –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏ –∏–∑—É—á–∞—é—Ç —Ä—ã–Ω–æ–∫, –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç *–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤* –∏ —Å–æ–∑–¥–∞—é—Ç –∏–Ω–Ω–æ–≤–∞—Ü–∏–∏ –¥–ª—è —Ä–æ—Å—Ç–∞ –±–∏–∑–Ω–µ—Å–∞",
                autoKeywords: ["–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–∏", "—Ä—ã–Ω–æ–∫", "–∏–Ω–Ω–æ–≤–∞—Ü–∏–∏", "–±–∏–∑–Ω–µ—Å–∞"]
            },
            3: {
                text: "–¢–æ–ª—å–∫–æ *–≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ* —Å–ª–æ–≤–∞ –¥–æ–ª–∂–Ω—ã —Å–≤–µ—Ç–∏—Ç—å—Å—è, –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ä—ã–Ω–æ–∫ –∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –æ—Å—Ç–∞—é—Ç—Å—è –æ–±—ã—á–Ω—ã–º–∏",
                autoKeywords: ["—Ä—ã–Ω–æ–∫", "–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏"]
            }
        };

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∞
        function updateBlock(blockNumber) {
            const blockEl = document.getElementById(`testBlock${blockNumber}`);
            const data = testData[blockNumber];
            
            const settings = {
                autoHighlight: document.getElementById(`autoHighlight${blockNumber}`).checked,
                keywordColor: document.getElementById(`manualColor${blockNumber}`).value,
                autoKeywordColor: document.getElementById(`autoColor${blockNumber}`).value,
                glowEnabled: true,
                glowIntensity: parseFloat(document.getElementById(`glowIntensity${blockNumber}`).value)
            };
            
            renderer.setTextWithKeywords(blockEl, data.text, data.autoKeywords, settings);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
            document.getElementById(`glowValue${blockNumber}`).textContent = 
                Math.round(settings.glowIntensity * 100) + '%';
        }

        // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
        function bindEvents() {
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`autoHighlight${i}`).addEventListener('change', () => updateBlock(i));
                document.getElementById(`manualColor${i}`).addEventListener('change', () => updateBlock(i));
                document.getElementById(`autoColor${i}`).addEventListener('change', () => updateBlock(i));
                document.getElementById(`glowIntensity${i}`).addEventListener('input', () => updateBlock(i));
            }
        }

        // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
        function runAllTests() {
            const results = [];
            
            // –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑–æ–≤–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏
            const block1 = document.getElementById('testBlock1');
            const manualKeywords1 = block1.querySelectorAll('.manual-keyword');
            const autoKeywords1 = block1.querySelectorAll('.auto-keyword');
            
            results.push({
                name: "–¢–µ—Å—Ç 1: –ë–∞–∑–æ–≤–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞",
                passed: manualKeywords1.length === 1 && autoKeywords1.length === 2, // 1 —Ä—É—á–Ω–æ–µ (*—Ä—ã–Ω–æ–∫*), 2 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö (–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏, –ø—Ä–∏–±—ã–ª–∏)
                details: `–†—É—á–Ω—ã—Ö: ${manualKeywords1.length} (–æ–∂–∏–¥–∞–µ—Ç—Å—è 1), –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö: ${autoKeywords1.length} (–æ–∂–∏–¥–∞–µ—Ç—Å—è 2)`
            });
            
            // –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
            const block2 = document.getElementById('testBlock2');
            const manualKeywords2 = block2.querySelectorAll('.manual-keyword');
            const autoKeywords2 = block2.querySelectorAll('.auto-keyword');
            
            results.push({
                name: "–¢–µ—Å—Ç 2: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞",
                passed: manualKeywords2.length === 2 && autoKeywords2.length === 4, // 2 —Ä—É—á–Ω—ã—Ö, 4 –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö
                details: `–†—É—á–Ω—ã—Ö: ${manualKeywords2.length} (–æ–∂–∏–¥–∞–µ—Ç—Å—è 2), –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö: ${autoKeywords2.length} (–æ–∂–∏–¥–∞–µ—Ç—Å—è 4)`
            });
            
            // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∞–≤—Ç–æ–ø–æ–¥—Å–≤–µ—Ç–∫–∏
            const block3 = document.getElementById('testBlock3');
            const manualKeywords3 = block3.querySelectorAll('.manual-keyword');
            const autoKeywords3 = block3.querySelectorAll('.auto-keyword');
            
            results.push({
                name: "–¢–µ—Å—Ç 3: –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–ø–æ–¥—Å–≤–µ—Ç–∫–∏",
                passed: manualKeywords3.length === 1 && autoKeywords3.length === 0,
                details: `–†—É—á–Ω—ã—Ö: ${manualKeywords3.length} (–æ–∂–∏–¥–∞–µ—Ç—Å—è 1), –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö: ${autoKeywords3.length} (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å 0)`
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            const resultsContainer = document.getElementById('testResults');
            resultsContainer.innerHTML = '';
            
            results.forEach(result => {
                const div = document.createElement('div');
                div.className = 'test-item';
                div.innerHTML = `
                    <strong>${result.passed ? '‚úÖ' : '‚ùå'} ${result.name}</strong><br>
                    ${result.details}
                `;
                resultsContainer.appendChild(div);
            });
            
            const passedTests = results.filter(r => r.passed).length;
            const totalTests = results.length;
            
            const summary = document.createElement('div');
            summary.style.marginTop = '15px';
            summary.style.fontWeight = 'bold';
            summary.style.color = passedTests === totalTests ? '#2e7d32' : '#d32f2f';
            summary.textContent = `–ü—Ä–æ–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: ${passedTests}/${totalTests}`;
            resultsContainer.appendChild(summary);
        }

        // –°–±—Ä–æ—Å —Ç–µ—Å—Ç–æ–≤
        function resetTests() {
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`autoHighlight${i}`).checked = i !== 3;
                document.getElementById(`manualColor${i}`).value = '#E74C3C';
                document.getElementById(`autoColor${i}`).value = '#4A90E2';
                document.getElementById(`glowIntensity${i}`).value = '0.3';
                updateBlock(i);
            }
            document.getElementById('testResults').innerHTML = '';
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            bindEvents();
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –≤—Å–µ –±–ª–æ–∫–∏
            for (let i = 1; i <= 3; i++) {
                updateBlock(i);
            }
            
            console.log('‚úÖ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –¥–≤–æ–π–Ω–æ–π –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
        });
    </script>
</body>
</html>