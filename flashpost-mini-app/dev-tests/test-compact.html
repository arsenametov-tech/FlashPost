<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compact Test - FlashPost</title>
    <link rel="stylesheet" href="../app.css">
    <style>
        body {
            padding: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .test-header h1 {
            margin: 0 0 5px 0;
            font-size: 24px;
            color: #333;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }
        
        .test-section {
            padding: 12px;
            border: 1px solid #e5e5e5;
            border-radius: 6px;
            background: #f8f9fa;
        }
        
        .test-section h3 {
            margin: 0 0 10px 0;
            font-size: 16px;
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .test-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }
        
        .test-btn {
            padding: 6px 10px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        
        .test-btn.run-all {
            background: #28a745;
            font-size: 14px;
            padding: 10px 20px;
        }
        
        .test-results {
            background: white;
            padding: 8px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 10px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }
        
        .status {
            padding: 2px 4px;
            border-radius: 2px;
            margin: 1px 0;
            display: block;
        }
        
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .status.warning { background: #fff3cd; color: #856404; }
        
        .summary-section {
            grid-column: 1 / -1;
            background: #e9ecef;
            border: 2px solid #667eea;
        }
        
        .summary-section .test-results {
            max-height: 200px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß™ FlashPost Compact Test</h1>
            <p>–ö–æ–º–ø–∞–∫—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π</p>
            <button class="test-btn run-all" onclick="runAllTests()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
        </div>

        <div class="test-grid">
            <!-- 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
            <div class="test-section">
                <h3>1. üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testModules()">–ú–æ–¥—É–ª–∏</button>
                    <button class="test-btn" onclick="testAppInit()">–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
                </div>
                <div id="init-results" class="test-results"></div>
            </div>

            <!-- 2. –°–æ—Å—Ç–æ—è–Ω–∏–µ -->
            <div class="test-section">
                <h3>2. üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testState()">State</button>
                    <button class="test-btn" onclick="testSlides()">–°–ª–∞–π–¥—ã</button>
                </div>
                <div id="state-results" class="test-results"></div>
            </div>
            <!-- 3. –¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ -->
            <div class="test-section">
                <h3>3. üìù –¢–µ–∫—Å—Ç</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testTextBlocks()">CRUD</button>
                    <button class="test-btn" onclick="testStyles()">–°—Ç–∏–ª–∏</button>
                </div>
                <div id="text-results" class="test-results"></div>
            </div>

            <!-- 4. –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ -->
            <div class="test-section">
                <h3>4. üîç –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testKeywords()">–ü–æ–¥—Å–≤–µ—Ç–∫–∞</button>
                    <button class="test-btn" onclick="testColors()">–¶–≤–µ—Ç–∞</button>
                </div>
                <div id="keywords-results" class="test-results"></div>
            </div>

            <!-- 5. –®–∞–±–ª–æ–Ω—ã -->
            <div class="test-section">
                <h3>5. üéØ –®–∞–±–ª–æ–Ω—ã</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testTemplates()">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ</button>
                    <button class="test-btn" onclick="testTemplateApply()">–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ</button>
                </div>
                <div id="template-results" class="test-results"></div>
            </div>

            <!-- 6. Drag & Drop -->
            <div class="test-section">
                <h3>6. üñ±Ô∏è Drag & Drop</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testDrag()">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ</button>
                    <button class="test-btn" onclick="testResize()">–†–∞–∑–º–µ—Ä</button>
                </div>
                <div id="drag-results" class="test-results"></div>
            </div>

            <!-- 7. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ -->
            <div class="test-section">
                <h3>7. üé® –†–µ–Ω–¥–µ—Ä–∏–Ω–≥</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testRendering()">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
                    <button class="test-btn" onclick="testModes()">–†–µ–∂–∏–º—ã</button>
                </div>
                <div id="render-results" class="test-results"></div>
            </div>

            <!-- 8. –≠–∫—Å–ø–æ—Ä—Ç -->
            <div class="test-section">
                <h3>8. üì§ –≠–∫—Å–ø–æ—Ä—Ç</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testExport()">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</button>
                    <button class="test-btn" onclick="testZip()">ZIP</button>
                </div>
                <div id="export-results" class="test-results"></div>
            </div>

            <!-- 9. AI -->
            <div class="test-section">
                <h3>9. ü§ñ AI</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testAI()">–ì–µ–Ω–µ—Ä–∞—Ü–∏—è</button>
                    <button class="test-btn" onclick="testKeywordAI()">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞</button>
                </div>
                <div id="ai-results" class="test-results"></div>
            </div>

            <!-- 10. UI/UX -->
            <div class="test-section">
                <h3>10. üé≠ UI/UX</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="testUI()">–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</button>
                    <button class="test-btn" onclick="testNavigation()">–ù–∞–≤–∏–≥–∞—Ü–∏—è</button>
                </div>
                <div id="ui-results" class="test-results"></div>
            </div>

            <!-- –ò—Ç–æ–≥–∏ -->
            <div class="test-section summary-section">
                <h3>üìä –ò—Ç–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <div class="test-buttons">
                    <button class="test-btn" onclick="generateReport()">üìã –û—Ç—á–µ—Ç</button>
                    <button class="test-btn" onclick="clearResults()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                <div id="summary-results" class="test-results"></div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥—É–ª–∏ -->
    <script src="../src/state.js"></script>
    <script src="../src/renderer.js"></script>
    <script src="../src/editor.js"></script>
    <script src="../src/drag.js"></script>
    <script src="../src/export.js"></script>
    <script src="../src/ai.js"></script>
    <script src="../src/template-manager.js"></script>
    <script src="../src/app.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let testResults = {};
        let testStats = { total: 0, passed: 0, failed: 0, warnings: 0 };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        const sections = ['init', 'state', 'text', 'keywords', 'template', 'drag', 'render', 'export', 'ai', 'ui', 'summary'];
        sections.forEach(section => testResults[section] = []);

        // –£—Ç–∏–ª–∏—Ç—ã –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(section, message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            
            testResults[section].push({ message: logMessage, type });
            updateResults(section);
            
            testStats.total++;
            if (type === 'success') testStats.passed++;
            else if (type === 'error') testStats.failed++;
            else if (type === 'warning') testStats.warnings++;
            
            console.log(`${type.toUpperCase()}: ${logMessage}`);
        }

        function updateResults(section) {
            const container = document.getElementById(`${section}-results`);
            if (!container) return;
            
            container.innerHTML = testResults[section]
                .map(result => `<div class="status ${result.type}">${result.message}</div>`)
                .join('');
            
            container.scrollTop = container.scrollHeight;
        }

        // 1. –¢–µ—Å—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
        function testModules() {
            log('init', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π...', 'info');
            
            const modules = ['StateManager', 'Renderer', 'Editor', 'DragManager', 'ExportManager', 'AIManager', 'TemplateManager'];
            
            modules.forEach(module => {
                if (typeof window[module] !== 'undefined') {
                    log('init', `‚úÖ ${module}`, 'success');
                } else {
                    log('init', `‚ùå ${module} –Ω–µ –Ω–∞–π–¥–µ–Ω`, 'error');
                }
            });
        }

        function testAppInit() {
            try {
                if (window.flashPostApp) {
                    log('init', '‚úÖ FlashPostApp –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ', 'success');
                    
                    const components = ['state', 'renderer', 'editor', 'templateManager'];
                    components.forEach(comp => {
                        if (window.flashPostApp[comp]) {
                            log('init', `‚úÖ ${comp} –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                        } else {
                            log('init', `‚ùå ${comp} –Ω–µ –Ω–∞–π–¥–µ–Ω`, 'error');
                        }
                    });
                } else {
                    log('init', '‚ùå FlashPostApp –Ω–µ –Ω–∞–π–¥–µ–Ω–æ', 'error');
                }
            } catch (error) {
                log('init', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // 2. –¢–µ—Å—Ç—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function testState() {
            try {
                const state = window.flashPostApp?.state;
                if (!state) {
                    log('state', '‚ùå StateManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                    return;
                }
                
                // –¢–µ—Å—Ç —Ä–µ–∂–∏–º–æ–≤
                const modes = ['start', 'preview', 'edit'];
                modes.forEach(mode => {
                    state.setMode(mode);
                    if (state.getMode() === mode) {
                        log('state', `‚úÖ –†–µ–∂–∏–º ${mode}`, 'success');
                    } else {
                        log('state', `‚ùå –û—à–∏–±–∫–∞ —Ä–µ–∂–∏–º–∞ ${mode}`, 'error');
                    }
                });
                
                state.clearProject();
                log('state', '‚úÖ –ü—Ä–æ–µ–∫—Ç –æ—á–∏—â–µ–Ω', 'success');
                
            } catch (error) {
                log('state', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function testSlides() {
            try {
                const state = window.flashPostApp?.state;
                if (!state) return;
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª–∞–π–¥—ã
                for (let i = 1; i <= 3; i++) {
                    const slide = state.createSlide({
                        title: `–°–ª–∞–π–¥ ${i}`,
                        text: `–°–æ–¥–µ—Ä–∂–∏–º–æ–µ ${i}`,
                        background: { type: 'color', color: '#833ab4' }
                    });
                    
                    if (slide) {
                        log('state', `‚úÖ –°–ª–∞–π–¥ ${i} —Å–æ–∑–¥–∞–Ω`, 'success');
                    } else {
                        log('state', `‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–∞–π–¥–∞ ${i}`, 'error');
                    }
                }
                
                const totalSlides = state.getSlidesCount();
                log('state', `‚úÖ –í—Å–µ–≥–æ —Å–ª–∞–π–¥–æ–≤: ${totalSlides}`, 'success');
                
            } catch (error) {
                log('state', `‚ùå –û—à–∏–±–∫–∞ —Å–ª–∞–π–¥–æ–≤: ${error.message}`, 'error');
            }
        }

        // 3. –¢–µ—Å—Ç—ã —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤
        function testTextBlocks() {
            try {
                const state = window.flashPostApp?.state;
                if (!state) return;
                
                const block = state.addTextBlock();
                if (block) {
                    log('text', `‚úÖ –ë–ª–æ–∫ —Å–æ–∑–¥–∞–Ω: ${block.id}`, 'success');
                    
                    // –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
                    const success = state.updateTextBlockProperty(block.id, 'text', '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç');
                    if (success) {
                        log('text', '‚úÖ –¢–µ–∫—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
                    } else {
                        log('text', '‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è', 'error');
                    }
                } else {
                    log('text', '‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –±–ª–æ–∫–∞', 'error');
                }
                
            } catch (error) {
                log('text', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function testStyles() {
            try {
                const state = window.flashPostApp?.state;
                if (!state) return;
                
                const block = state.addTextBlock();
                if (!block) return;
                
                const styles = [
                    { prop: 'font', value: 'Montserrat' },
                    { prop: 'size', value: 24 },
                    { prop: 'color', value: '#ff0000' }
                ];
                
                styles.forEach(({ prop, value }) => {
                    const success = state.updateTextBlockProperty(block.id, prop, value);
                    if (success) {
                        log('text', `‚úÖ ${prop}: ${value}`, 'success');
                    } else {
                        log('text', `‚ùå –û—à–∏–±–∫–∞ ${prop}`, 'error');
                    }
                });
                
            } catch (error) {
                log('text', `‚ùå –û—à–∏–±–∫–∞ —Å—Ç–∏–ª–µ–π: ${error.message}`, 'error');
            }
        }

        // 4. –¢–µ—Å—Ç—ã –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        function testKeywords() {
            try {
                const state = window.flashPostApp?.state;
                if (!state) return;
                
                const block = state.addTextBlock();
                if (!block) return;
                
                const testTexts = [
                    '–≠—Ç–æ *–≤–∞–∂–Ω—ã–π* —Ç–µ–∫—Å—Ç',
                    '*–ö–ª—é—á–µ–≤—ã–µ* —Å–ª–æ–≤–∞ —Ä–∞–±–æ—Ç–∞—é—Ç',
                    '–û–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç'
                ];
                
                testTexts.forEach((text, index) => {
                    state.updateTextBlockProperty(block.id, 'text', text);
                    const keywords = (text.match(/\*([^*]+)\*/g) || []).length;
                    log('keywords', `‚úÖ –¢–µ—Å—Ç ${index + 1}: ${keywords} –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤`, 'success');
                });
                
            } catch (error) {
                log('keywords', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function testColors() {
            try {
                const state = window.flashPostApp?.state;
                if (!state) return;
                
                const block = state.addTextBlock();
                if (!block) return;
                
                const colors = [
                    { prop: 'keywordHighlighting.keywordColor', value: '#ff0000' },
                    { prop: 'keywordHighlighting.autoKeywordColor', value: '#0000ff' }
                ];
                
                colors.forEach(({ prop, value }) => {
                    const success = state.updateTextBlockProperty(block.id, prop, value);
                    if (success) {
                        log('keywords', `‚úÖ ${prop.split('.')[1]}: ${value}`, 'success');
                    } else {
                        log('keywords', `‚ùå –û—à–∏–±–∫–∞ —Ü–≤–µ—Ç–∞`, 'error');
                    }
                });
                
            } catch (error) {
                log('keywords', `‚ùå –û—à–∏–±–∫–∞ —Ü–≤–µ—Ç–æ–≤: ${error.message}`, 'error');
            }
        }

        // 5. –¢–µ—Å—Ç—ã —à–∞–±–ª–æ–Ω–æ–≤ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)
        function testTemplates() {
            try {
                log('template', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤...', 'info');
                
                const templateManager = window.flashPostApp?.templateManager;
                if (!templateManager) {
                    log('template', '‚ùå TemplateManager –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω', 'error');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω
                const templateName = `–¢–µ—Å—Ç ${Date.now()}`;
                const success = templateManager.saveCurrentSlideAsTemplate(templateName);
                
                if (success) {
                    log('template', `‚úÖ –®–∞–±–ª–æ–Ω "${templateName}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω`, 'success');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
                    const templates = templateManager.getTemplatesFromStorage();
                    const saved = templates.find(t => t.name === templateName);
                    
                    if (saved) {
                        log('template', `‚úÖ –®–∞–±–ª–æ–Ω –Ω–∞–π–¥–µ–Ω –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ`, 'success');
                    } else {
                        log('template', '‚ùå –®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    }
                } else {
                    log('template', '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'error');
                }
                
            } catch (error) {
                log('template', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function testTemplateApply() {
            try {
                const templateManager = window.flashPostApp?.templateManager;
                if (!templateManager) return;
                
                const templates = templateManager.getTemplatesFromStorage();
                if (templates.length === 0) {
                    log('template', '‚ö†Ô∏è –ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è', 'warning');
                    return;
                }
                
                const template = templates[0];
                const success = templateManager.applyTemplateToCurrentSlide(template.id, true);
                
                if (success) {
                    log('template', `‚úÖ –®–∞–±–ª–æ–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω`, 'success');
                } else {
                    log('template', '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è', 'error');
                }
                
            } catch (error) {
                log('template', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        // 6. –¢–µ—Å—Ç—ã Drag & Drop
        function testDrag() {
            try {
                log('drag', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Drag & Drop...', 'info');
                
                const dragManager = window.flashPostApp?.dragManager;
                if (dragManager) {
                    log('drag', '‚úÖ DragManager –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    log('drag', '‚ùå DragManager –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
                
                // –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ —Å–µ—Ç–∫–µ
                function snapToGrid(value, gridSize = 5) {
                    return Math.round(value / gridSize) * gridSize;
                }
                
                const testValue = 17;
                const snapped = snapToGrid(testValue);
                log('drag', `‚úÖ –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Å–µ—Ç–∫–µ: ${testValue} ‚Üí ${snapped}`, 'success');
                
            } catch (error) {
                log('drag', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function testResize() {
            try {
                const state = window.flashPostApp?.state;
                if (!state) return;
                
                const block = state.addTextBlock();
                if (block) {
                    const originalWidth = block.width;
                    state.updateTextBlockProperty(block.id, 'width', originalWidth + 10);
                    
                    const updated = state.getActiveSlide()?.textBlocks.find(b => b.id === block.id);
                    if (updated && updated.width === originalWidth + 10) {
                        log('drag', '‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    } else {
                        log('drag', '‚ùå –û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞', 'error');
                    }
                }
                
            } catch (error) {
                log('drag', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // 7. –¢–µ—Å—Ç—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)
        function testRendering() {
            try {
                log('render', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞...', 'info');
                
                const renderer = window.flashPostApp?.renderer;
                if (renderer) {
                    log('render', '‚úÖ Renderer –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                    
                    // –¢–µ—Å—Ç —Ä–µ–Ω–¥–µ—Ä–∞ (–±–µ–∑–æ–ø–∞—Å–Ω—ã–π)
                    try {
                        renderer.render();
                        log('render', '‚úÖ –†–µ–Ω–¥–µ—Ä –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success');
                    } catch (renderError) {
                        log('render', `‚ö†Ô∏è –†–µ–Ω–¥–µ—Ä —Å –æ—à–∏–±–∫–æ–π: ${renderError.message}`, 'warning');
                    }
                } else {
                    log('render', '‚ùå Renderer –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
                
            } catch (error) {
                log('render', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function testModes() {
            try {
                const state = window.flashPostApp?.state;
                if (!state) return;
                
                const modes = ['start', 'preview', 'edit'];
                modes.forEach(mode => {
                    try {
                        state.setMode(mode);
                        log('render', `‚úÖ –†–µ–∂–∏–º ${mode} —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω`, 'success');
                    } catch (modeError) {
                        log('render', `‚ùå –û—à–∏–±–∫–∞ —Ä–µ–∂–∏–º–∞ ${mode}`, 'error');
                    }
                });
                
            } catch (error) {
                log('render', `‚ùå –û—à–∏–±–∫–∞ —Ä–µ–∂–∏–º–æ–≤: ${error.message}`, 'error');
            }
        }

        // 8. –¢–µ—Å—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞ (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)
        function testExport() {
            try {
                log('export', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —ç–∫—Å–ø–æ—Ä—Ç–∞...', 'info');
                
                const exportManager = window.flashPostApp?.exportManager;
                if (exportManager) {
                    log('export', '‚úÖ ExportManager –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    log('export', '‚ùå ExportManager –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                }
                
                // –¢–µ—Å—Ç Canvas API
                try {
                    const canvas = document.createElement('canvas');
                    canvas.width = 300;
                    canvas.height = 300;
                    const ctx = canvas.getContext('2d');
                    
                    ctx.fillStyle = '#833ab4';
                    ctx.fillRect(0, 0, 300, 300);
                    
                    const dataURL = canvas.toDataURL('image/png');
                    if (dataURL.startsWith('data:image/png')) {
                        log('export', '‚úÖ Canvas —ç–∫—Å–ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    } else {
                        log('export', '‚ùå –û—à–∏–±–∫–∞ Canvas —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                    }
                } catch (canvasError) {
                    log('export', `‚ùå Canvas –æ—à–∏–±–∫–∞: ${canvasError.message}`, 'error');
                }
                
            } catch (error) {
                log('export', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function testZip() {
            try {
                log('export', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ ZIP...', 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å JSZip (–º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞)
                if (typeof JSZip !== 'undefined') {
                    const zip = new JSZip();
                    zip.file('test.txt', '–¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª');
                    log('export', '‚úÖ JSZip –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    log('export', '‚ö†Ô∏è JSZip –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'warning');
                }
                
            } catch (error) {
                log('export', `‚ùå ZIP –æ—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // 9. –¢–µ—Å—Ç—ã AI (–ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï)
        function testAI() {
            try {
                log('ai', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ AI...', 'info');
                
                const aiManager = window.flashPostApp?.aiManager;
                if (aiManager) {
                    log('ai', '‚úÖ AIManager –¥–æ—Å—Ç—É–ø–µ–Ω', 'success');
                } else {
                    log('ai', '‚ùå AIManager –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
                    return;
                }
                
                // –¢–µ—Å—Ç –∑–∞–≥–ª—É—à–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
                try {
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–æ–≤
                    if (typeof aiManager.generateSlides === 'function') {
                        log('ai', '‚úÖ –ú–µ—Ç–æ–¥ generateSlides –Ω–∞–π–¥–µ–Ω', 'success');
                    } else {
                        log('ai', '‚ö†Ô∏è –ú–µ—Ç–æ–¥ generateSlides –Ω–µ –Ω–∞–π–¥–µ–Ω', 'warning');
                    }
                } catch (aiError) {
                    log('ai', `‚ö†Ô∏è AI –º–µ—Ç–æ–¥—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã: ${aiError.message}`, 'warning');
                }
                
            } catch (error) {
                log('ai', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        function testKeywordAI() {
            try {
                const aiManager = window.flashPostApp?.aiManager;
                if (!aiManager) return;
                
                const testText = '–ò—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç –∏ –º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ';
                
                try {
                    const keywords = aiManager.extractKeywordsLocally ? 
                        aiManager.extractKeywordsLocally(testText) : [];
                    
                    if (keywords && keywords.length > 0) {
                        log('ai', `‚úÖ –ù–∞–π–¥–µ–Ω–æ ${keywords.length} –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤`, 'success');
                    } else {
                        log('ai', '‚ö†Ô∏è –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'warning');
                    }
                } catch (keywordError) {
                    log('ai', `‚ö†Ô∏è –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ`, 'warning');
                }
                
            } catch (error) {
                log('ai', `‚ùå –û—à–∏–±–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤: ${error.message}`, 'error');
            }
        }

        // 10. –¢–µ—Å—Ç—ã UI
        function testUI() {
            try {
                log('ui', '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UI...', 'info');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã DOM
                const app = document.getElementById('app');
                if (app) {
                    log('ui', '‚úÖ –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞–π–¥–µ–Ω', 'success');
                } else {
                    log('ui', '‚ö†Ô∏è –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω', 'warning');
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º CSS
                const styles = getComputedStyle(document.body);
                if (styles.fontFamily) {
                    log('ui', '‚úÖ CSS —Å—Ç–∏–ª–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã', 'success');
                } else {
                    log('ui', '‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã —Å CSS', 'warning');
                }
                
            } catch (error) {
                log('ui', `‚ùå –û—à–∏–±–∫–∞ UI: ${error.message}`, 'error');
            }
        }

        function testNavigation() {
            try {
                const state = window.flashPostApp?.state;
                if (!state) return;
                
                // –¢–µ—Å—Ç –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ —Å–ª–∞–π–¥–∞–º
                const totalSlides = state.getSlidesCount();
                if (totalSlides > 0) {
                    state.setActiveSlideByIndex(0);
                    const activeIndex = state.getActiveSlideIndex();
                    
                    if (activeIndex === 0) {
                        log('ui', '‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–ª–∞–π–¥–∞–º —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    } else {
                        log('ui', '‚ùå –û—à–∏–±–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏', 'error');
                    }
                } else {
                    log('ui', '‚ö†Ô∏è –ù–µ—Ç —Å–ª–∞–π–¥–æ–≤ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏', 'warning');
                }
                
            } catch (error) {
                log('ui', `‚ùå –û—à–∏–±–∫–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }

        // –û–±—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function runAllTests() {
            log('summary', 'üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤...', 'info');
            
            // –û—á–∏—â–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
            testStats = { total: 0, passed: 0, failed: 0, warnings: 0 };
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ç–µ—Å—Ç—ã —Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
            const tests = [
                () => { testModules(); testAppInit(); },
                () => { testState(); testSlides(); },
                () => { testTextBlocks(); testStyles(); },
                () => { testKeywords(); testColors(); },
                () => { testTemplates(); testTemplateApply(); },
                () => { testDrag(); testResize(); },
                () => { testRendering(); testModes(); },
                () => { testExport(); testZip(); },
                () => { testAI(); testKeywordAI(); },
                () => { testUI(); testNavigation(); }
            ];
            
            tests.forEach((testGroup, index) => {
                setTimeout(() => {
                    try {
                        testGroup();
                        log('summary', `‚úÖ –ì—Ä—É–ø–ø–∞ ${index + 1} –∑–∞–≤–µ—Ä—à–µ–Ω–∞`, 'success');
                    } catch (error) {
                        log('summary', `‚ùå –û—à–∏–±–∫–∞ –≤ –≥—Ä—É–ø–ø–µ ${index + 1}: ${error.message}`, 'error');
                    }
                }, index * 500);
            });
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç—á–µ—Ç
            setTimeout(() => {
                generateReport();
            }, tests.length * 500 + 1000);
        }

        function generateReport() {
            log('summary', 'üìä –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç:', 'info');
            log('summary', `–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤: ${testStats.total}`, 'info');
            log('summary', `–£—Å–ø–µ—à–Ω–æ: ${testStats.passed}`, 'success');
            log('summary', `–û—à–∏–±–æ–∫: ${testStats.failed}`, testStats.failed > 0 ? 'error' : 'success');
            log('summary', `–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π: ${testStats.warnings}`, testStats.warnings > 0 ? 'warning' : 'success');
            
            const successRate = testStats.total > 0 ? Math.round((testStats.passed / testStats.total) * 100) : 0;
            log('summary', `–ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—Ö–∞: ${successRate}%`, successRate >= 80 ? 'success' : successRate >= 60 ? 'warning' : 'error');
            
            if (successRate >= 90) {
                log('summary', 'üéâ –û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!', 'success');
            } else if (successRate >= 70) {
                log('summary', 'üëç –•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!', 'success');
            } else {
                log('summary', '‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ!', 'warning');
            }
        }

        function clearResults() {
            sections.forEach(section => {
                testResults[section] = [];
                updateResults(section);
            });
            testStats = { total: 0, passed: 0, failed: 0, warnings: 0 };
            log('summary', 'üóëÔ∏è –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—á–∏—â–µ–Ω—ã', 'info');
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('summary', 'üîÑ –ö–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ç–µ—Å—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'info');
                testModules();
            }, 1000);
        });
    </script>
</body>
</html>