<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤ - FlashPost</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Inter, sans-serif;
            background: linear-gradient(135deg, #833ab4 0%, #fd1d1d 25%, #fcb045 50%, #f77737 75%, #e1306c 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .title {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        
        .main-layout {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
        }
        
        .editor-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
        }
        
        .templates-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
        }
        
        .section-title {
            margin: 0 0 16px 0;
            color: #495057;
            font-size: 18px;
            font-weight: 600;
        }
        
        .slide-editor {
            position: relative;
            width: 100%;
            height: 400px;
            border-radius: 12px;
            margin-bottom: 16px;
            overflow: hidden;
            cursor: pointer;
        }
        
        .text-block {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 12px;
            cursor: move;
            font-family: Inter, sans-serif;
            color: #333;
            min-width: 100px;
            min-height: 40px;
            transition: all 0.2s ease;
            box-sizing: border-box;
        }
        
        .text-block:hover {
            border-color: #833ab4;
        }
        
        .text-block.active {
            border-color: #833ab4;
            box-shadow: 0 0 12px rgba(131, 58, 180, 0.3);
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: #833ab4;
            color: white;
        }
        
        .btn-primary:hover {
            background: #6d2d96;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-success:hover {
            background: #218838;
        }
        
        .btn-info {
            background: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background: #138496;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning:hover {
            background: #e0a800;
        }
        
        .template-item {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .template-item:hover {
            border-color: #833ab4;
        }
        
        .template-item.active {
            border-color: #833ab4;
            background: #f8f9ff;
        }
        
        .template-preview {
            width: 100%;
            height: 80px;
            border-radius: 6px;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .template-preview .text-block {
            transform: scale(0.3);
            transform-origin: top left;
        }
        
        .template-info {
            font-size: 12px;
            color: #6c757d;
        }
        
        .template-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 4px;
        }
        
        .slide-info {
            background: #e9ecef;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-family: monospace;
        }
        
        .info-item {
            margin-bottom: 4px;
        }
        
        .color-picker {
            width: 40px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 8px;
        }
        
        .input-group {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .input-group label {
            min-width: 80px;
            font-size: 14px;
            color: #495057;
        }
        
        .input-group input {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üìã –°–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤ FlashPost</h1>
        
        <div class="main-layout">
            <!-- –†–µ–¥–∞–∫—Ç–æ—Ä —Å–ª–∞–π–¥–∞ -->
            <div class="editor-section">
                <h2 class="section-title">–†–µ–¥–∞–∫—Ç–æ—Ä —Å–ª–∞–π–¥–∞</h2>
                
                <div class="controls">
                    <button class="btn btn-primary" onclick="addTextBlock()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç</button>
                    <button class="btn btn-success" onclick="saveTemplate()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
                    <button class="btn btn-info" onclick="randomizeSlide()">üé≤ –°–ª—É—á–∞–π–Ω—ã–π –¥–∏–∑–∞–π–Ω</button>
                    <button class="btn btn-warning" onclick="clearSlide()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
                
                <div class="slide-editor" id="slideEditor" onclick="deselectBlocks()">
                    <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã JS -->
                </div>
                
                <div class="input-group">
                    <label>–§–æ–Ω:</label>
                    <input type="color" class="color-picker" id="backgroundPicker" value="#ff6b6b" onchange="changeBackground(this.value)">
                    <input type="text" id="backgroundInput" value="#ff6b6b" onchange="changeBackground(this.value)">
                </div>
                
                <div class="slide-info" id="slideInfo">
                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ª–∞–π–¥–µ -->
                </div>
            </div>
            
            <!-- –ü–∞–Ω–µ–ª—å —à–∞–±–ª–æ–Ω–æ–≤ -->
            <div class="templates-section">
                <h2 class="section-title">–®–∞–±–ª–æ–Ω—ã</h2>
                
                <div class="controls">
                    <button class="btn btn-success" onclick="loadTemplates()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
                    <button class="btn btn-warning" onclick="clearTemplates()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ</button>
                </div>
                
                <div id="templatesList">
                    <!-- –°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== –°–ò–°–¢–ï–ú–ê –®–ê–ë–õ–û–ù–û–í =====
        
        class TemplatesSystem {
            constructor() {
                this.currentSlide = {
                    id: 'current_slide',
                    background: { color: '#ff6b6b' },
                    textBlocks: []
                };
                
                this.activeBlockId = null;
                this.templates = {};
                
                console.log('üìã –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤');
                this.init();
            }
            
            init() {
                this.createInitialBlocks();
                this.loadTemplates();
                this.render();
                this.updateSlideInfo();
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–∞—á–∞–ª—å–Ω—ã—Ö –±–ª–æ–∫–æ–≤
            createInitialBlocks() {
                this.currentSlide.textBlocks = [
                    {
                        id: 'block_1',
                        text: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ª–∞–π–¥–∞',
                        x: 10, y: 20, width: 80,
                        font: 'Inter', size: 24, color: '#ffffff'
                    },
                    {
                        id: 'block_2',
                        text: '–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ',
                        x: 10, y: 60, width: 70,
                        font: 'Inter', size: 16, color: '#ffffff'
                    }
                ];
            }
            
            // ===== –°–û–•–†–ê–ù–ï–ù–ò–ï –®–ê–ë–õ–û–ù–ê =====
            
            saveTemplate() {
                const templateName = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞:', `–®–∞–±–ª–æ–Ω ${Object.keys(this.templates).length + 1}`);
                
                if (!templateName) return;
                
                // –°–æ–∑–¥–∞–µ–º –≥–ª—É–±–æ–∫—É—é –∫–æ–ø–∏—é —Ç–µ–∫—É—â–µ–≥–æ —Å–ª–∞–π–¥–∞
                const template = {
                    id: `template_${Date.now()}`,
                    name: templateName,
                    background: this.clone(this.currentSlide.background),
                    textBlocks: this.clone(this.currentSlide.textBlocks),
                    createdAt: new Date().toISOString(),
                    preview: this.generatePreview()
                };
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage
                const templateKey = `template_${template.id}`;
                localStorage.setItem(templateKey, JSON.stringify(template));
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à
                this.templates[template.id] = template;
                
                console.log(`üíæ –®–∞–±–ª–æ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω: ${templateName}`, template);
                
                this.renderTemplates();
                this.showNotification(`–®–∞–±–ª–æ–Ω "${templateName}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω!`);
            }
            
            // ===== –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –®–ê–ë–õ–û–ù–ê =====
            
            applyTemplate(templateId) {
                const template = this.templates[templateId];
                if (!template) {
                    console.error('–®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω:', templateId);
                    return;
                }
                
                // –ü—Ä–∏–º–µ–Ω—è–µ–º —à–∞–±–ª–æ–Ω –∫ —Ç–µ–∫—É—â–µ–º—É —Å–ª–∞–π–¥—É
                this.currentSlide.background = this.clone(template.background);
                this.currentSlide.textBlocks = this.clone(template.textBlocks);
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
                this.activeBlockId = null;
                
                console.log(`‚úÖ –®–∞–±–ª–æ–Ω –ø—Ä–∏–º–µ–Ω–µ–Ω: ${template.name}`, template);
                
                this.render();
                this.updateSlideInfo();
                this.showNotification(`–®–∞–±–ª–æ–Ω "${template.name}" –ø—Ä–∏–º–µ–Ω–µ–Ω!`);
            }
            
            // ===== –ó–ê–ì–†–£–ó–ö–ê –®–ê–ë–õ–û–ù–û–í =====
            
            loadTemplates() {
                this.templates = {};
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —à–∞–±–ª–æ–Ω—ã –∏–∑ localStorage
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    
                    if (key && key.startsWith('template_')) {
                        try {
                            const templateData = localStorage.getItem(key);
                            const template = JSON.parse(templateData);
                            
                            this.templates[template.id] = template;
                            console.log(`üì• –ó–∞–≥—Ä—É–∂–µ–Ω —à–∞–±–ª–æ–Ω: ${template.name}`);
                            
                        } catch (error) {
                            console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–∞ ${key}:`, error);
                        }
                    }
                }
                
                console.log(`üìã –ó–∞–≥—Ä—É–∂–µ–Ω–æ —à–∞–±–ª–æ–Ω–æ–≤: ${Object.keys(this.templates).length}`);
                this.renderTemplates();
            }
            
            // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –¢–ï–ö–°–¢–û–í–´–ú–ò –ë–õ–û–ö–ê–ú–ò =====
            
            addTextBlock() {
                const newBlock = {
                    id: `block_${Date.now()}`,
                    text: '–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç',
                    x: 20 + Math.random() * 40,
                    y: 30 + Math.random() * 40,
                    width: 50,
                    font: 'Inter',
                    size: 18,
                    color: '#ffffff'
                };
                
                this.currentSlide.textBlocks.push(newBlock);
                this.activeBlockId = newBlock.id;
                
                console.log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫: ${newBlock.id}`);
                
                this.render();
                this.updateSlideInfo();
            }
            
            selectBlock(blockId) {
                this.activeBlockId = blockId;
                console.log(`üéØ –í—ã–±—Ä–∞–Ω –±–ª–æ–∫: ${blockId}`);
                this.render();
            }
            
            deselectBlocks() {
                this.activeBlockId = null;
                this.render();
            }
            
            // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –§–û–ù–û–ú =====
            
            changeBackground(color) {
                this.currentSlide.background.color = color;
                
                // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –∏–Ω–ø—É—Ç—ã
                document.getElementById('backgroundPicker').value = color;
                document.getElementById('backgroundInput').value = color;
                
                this.render();
                this.updateSlideInfo();
            }
            
            // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
            
            // –ì–ª—É–±–æ–∫–æ–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
            clone(obj) {
                return JSON.parse(JSON.stringify(obj));
            }
            
            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–µ–≤—å—é —à–∞–±–ª–æ–Ω–∞
            generatePreview() {
                return {
                    backgroundColor: this.currentSlide.background.color,
                    blocksCount: this.currentSlide.textBlocks.length,
                    hasTitle: this.currentSlide.textBlocks.some(block => block.size > 20)
                };
            }
            
            // –°–ª—É—á–∞–π–Ω—ã–π –¥–∏–∑–∞–π–Ω
            randomizeSlide() {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', '#ff9ff3', '#a8e6cf', '#ffd93d'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                
                this.changeBackground(randomColor);
                
                // –°–ª—É—á–∞–π–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –±–ª–æ–∫–æ–≤
                this.currentSlide.textBlocks.forEach(block => {
                    block.x = 10 + Math.random() * 60;
                    block.y = 10 + Math.random() * 70;
                });
                
                this.render();
                this.updateSlideInfo();
            }
            
            // –û—á–∏—Å—Ç–∫–∞ —Å–ª–∞–π–¥–∞
            clearSlide() {
                this.currentSlide.textBlocks = [];
                this.activeBlockId = null;
                this.render();
                this.updateSlideInfo();
            }
            
            // –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö —à–∞–±–ª–æ–Ω–æ–≤
            clearTemplates() {
                if (!confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ —à–∞–±–ª–æ–Ω—ã? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.')) return;
                
                // –£–¥–∞–ª—è–µ–º –∏–∑ localStorage
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('template_')) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => localStorage.removeItem(key));
                
                // –û—á–∏—â–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π –∫—ç—à
                this.templates = {};
                
                console.log('üóëÔ∏è –í—Å–µ —à–∞–±–ª–æ–Ω—ã —É–¥–∞–ª–µ–Ω—ã');
                this.renderTemplates();
                this.showNotification('–í—Å–µ —à–∞–±–ª–æ–Ω—ã —É–¥–∞–ª–µ–Ω—ã');
            }
            
            // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            showNotification(message) {
                // –ü—Ä–æ—Å—Ç–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #28a745;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 1000;
                    font-weight: 600;
                `;
                notification.textContent = message;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 3000);
            }
            
            // ===== –†–ï–ù–î–ï–†–ò–ù–ì =====
            
            render() {
                this.renderSlide();
                this.renderTemplates();
            }
            
            renderSlide() {
                const editor = document.getElementById('slideEditor');
                editor.style.background = this.currentSlide.background.color;
                
                // –û—á–∏—â–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä
                editor.innerHTML = '';
                
                // –†–µ–Ω–¥–µ—Ä–∏–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏
                this.currentSlide.textBlocks.forEach(block => {
                    const blockElement = document.createElement('div');
                    blockElement.className = 'text-block';
                    blockElement.id = block.id;
                    
                    if (this.activeBlockId === block.id) {
                        blockElement.classList.add('active');
                    }
                    
                    blockElement.style.left = `${block.x}%`;
                    blockElement.style.top = `${block.y}%`;
                    blockElement.style.width = `${block.width}%`;
                    blockElement.style.fontSize = `${block.size}px`;
                    blockElement.style.fontFamily = block.font;
                    blockElement.style.color = block.color;
                    
                    blockElement.textContent = block.text;
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
                    blockElement.addEventListener('click', (e) => {
                        e.stopPropagation();
                        this.selectBlock(block.id);
                    });
                    
                    editor.appendChild(blockElement);
                });
            }
            
            renderTemplates() {
                const templatesList = document.getElementById('templatesList');
                
                if (Object.keys(this.templates).length === 0) {
                    templatesList.innerHTML = `
                        <div style="text-align: center; padding: 20px; color: #6c757d;">
                            <p>–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤</p>
                            <p>–°–æ–∑–¥–∞–π—Ç–µ –¥–∏–∑–∞–π–Ω –∏ –Ω–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω"</p>
                        </div>
                    `;
                    return;
                }
                
                templatesList.innerHTML = Object.values(this.templates).map(template => `
                    <div class="template-item" onclick="templatesSystem.applyTemplate('${template.id}')">
                        <div class="template-preview" style="background: ${template.background.color};">
                            ${template.textBlocks.map(block => `
                                <div class="text-block" style="
                                    left: ${block.x}%;
                                    top: ${block.y}%;
                                    width: ${block.width}%;
                                    font-size: ${block.size}px;
                                    color: ${block.color};
                                ">${block.text}</div>
                            `).join('')}
                        </div>
                        
                        <div class="template-name">${template.name}</div>
                        <div class="template-info">
                            ${template.textBlocks.length} –±–ª–æ–∫–æ–≤ ‚Ä¢ ${new Date(template.createdAt).toLocaleDateString()}
                        </div>
                    </div>
                `).join('');
            }
            
            updateSlideInfo() {
                const info = document.getElementById('slideInfo');
                
                info.innerHTML = `
                    <div class="info-item"><strong>–§–æ–Ω:</strong> ${this.currentSlide.background.color}</div>
                    <div class="info-item"><strong>–ë–ª–æ–∫–æ–≤:</strong> ${this.currentSlide.textBlocks.length}</div>
                    <div class="info-item"><strong>–ê–∫—Ç–∏–≤–Ω—ã–π –±–ª–æ–∫:</strong> ${this.activeBlockId || '–Ω–µ—Ç'}</div>
                    <div class="info-item"><strong>–®–∞–±–ª–æ–Ω–æ–≤:</strong> ${Object.keys(this.templates).length}</div>
                `;
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã
        let templatesSystem;
        
        document.addEventListener('DOMContentLoaded', () => {
            templatesSystem = new TemplatesSystem();
            console.log('üìã –°–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
        });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        function addTextBlock() {
            templatesSystem.addTextBlock();
        }
        
        function saveTemplate() {
            templatesSystem.saveTemplate();
        }
        
        function loadTemplates() {
            templatesSystem.loadTemplates();
        }
        
        function clearTemplates() {
            templatesSystem.clearTemplates();
        }
        
        function randomizeSlide() {
            templatesSystem.randomizeSlide();
        }
        
        function clearSlide() {
            templatesSystem.clearSlide();
        }
        
        function changeBackground(color) {
            templatesSystem.changeBackground(color);
        }
        
        function deselectBlocks() {
            templatesSystem.deselectBlocks();
        }
    </script>
</body>
</html>