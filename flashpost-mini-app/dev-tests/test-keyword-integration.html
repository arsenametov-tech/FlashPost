<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤</title>
    <link rel="stylesheet" href="../app.css">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .test-slide {
            background: linear-gradient(135deg, #833ab4, #fd1d1d, #fcb045);
            border-radius: 12px;
            padding: 40px;
            margin: 20px 0;
            position: relative;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .test-text-block {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: white;
            font-size: 18px;
            line-height: 1.4;
            max-width: 80%;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .control-group label {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }

        .control-group input[type="checkbox"] {
            margin-right: 8px;
        }

        .control-group input[type="color"] {
            width: 50px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .control-group input[type="range"] {
            width: 100%;
        }

        .btn {
            background: #833ab4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #6a2c91;
        }

        .test-results {
            background: #e8f5e8;
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .test-results h4 {
            color: #2e7d32;
            margin-top: 0;
        }

        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-weight: 600;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üîó –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤</h1>
            <p>–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –º–æ–¥—É–ª—è–º–∏ FlashPost</p>
        </div>

        <div class="test-slide">
            <div class="test-text-block" id="integrationTestBlock">
                –ò–∑—É—á–∞–π—Ç–µ *—Ä—ã–Ω–æ–∫* –∏ –¥–µ–ª–∞–π—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏ –æ—Ç –±–∏–∑–Ω–µ—Å–∞
            </div>
        </div>

        <div class="controls">
            <div class="control-group">
                <label>
                    <input type="checkbox" id="autoHighlightToggle" checked>
                    –ê–≤—Ç–æ–ø–æ–¥—Å–≤–µ—Ç–∫–∞ AI
                </label>
            </div>
            <div class="control-group">
                <label>–¶–≤–µ—Ç —Ä—É—á–Ω—ã—Ö (*—Å–ª–æ–≤–æ*):</label>
                <input type="color" id="manualColorPicker" value="#E74C3C">
            </div>
            <div class="control-group">
                <label>–¶–≤–µ—Ç AI –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤:</label>
                <input type="color" id="autoColorPicker" value="#4A90E2">
            </div>
            <div class="control-group">
                <label>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å —Å–≤–µ—á–µ–Ω–∏—è: <span id="glowValue">30%</span></label>
                <input type="range" id="glowIntensityRange" min="0" max="1" step="0.1" value="0.3">
            </div>
        </div>

        <div style="text-align: center;">
            <button class="btn" onclick="testIntegration()">üß™ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</button>
            <button class="btn" onclick="testStateManager()">üìä –¢–µ—Å—Ç StateManager</button>
            <button class="btn" onclick="testRenderer()">üé® –¢–µ—Å—Ç Renderer</button>
        </div>

        <div id="testResults"></div>
    </div>

    <!-- –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–¥—É–ª–∏ FlashPost -->
    <script src="../src/state.js"></script>
    <script src="../src/renderer.js"></script>
    <script src="../src/ai.js"></script>

    <script>
        let state, renderer, ai;
        const testResults = document.getElementById('testResults');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
        function initializeModules() {
            try {
                state = new StateManager();
                renderer = new Renderer(state);
                ai = new AIManager(state);
                
                showStatus('‚úÖ –ú–æ–¥—É–ª–∏ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã', 'success');
                return true;
            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π: ${error.message}`, 'error');
                return false;
            }
        }

        // –ü–æ–∫–∞–∑ —Å—Ç–∞—Ç—É—Å–∞
        function showStatus(message, type) {
            const status = document.createElement('div');
            status.className = `status ${type}`;
            status.textContent = message;
            testResults.appendChild(status);
        }

        // –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
        function testIntegration() {
            testResults.innerHTML = '';
            
            if (!initializeModules()) return;

            try {
                // –°–æ–∑–¥–∞–µ–º —Å–ª–∞–π–¥ —Å —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –±–ª–æ–∫–∞–º–∏
                const slide = state.createSlide({
                    title: '–¢–µ—Å—Ç–æ–≤—ã–π —Å–ª–∞–π–¥',
                    text: '–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏'
                });

                showStatus(`‚úÖ –°–ª–∞–π–¥ —Å–æ–∑–¥–∞–Ω: ${slide.id}`, 'success');

                // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                const block = state.createTextBlock(slide.id, {
                    text: '–ò–∑—É—á–∞–π—Ç–µ *—Ä—ã–Ω–æ–∫* –∏ –¥–µ–ª–∞–π—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏ –æ—Ç –±–∏–∑–Ω–µ—Å–∞',
                    keywordHighlighting: {
                        autoHighlight: true,
                        keywordColor: '#E74C3C',
                        autoKeywordColor: '#4A90E2',
                        glowEnabled: true,
                        glowIntensity: 0.3
                    }
                });

                showStatus(`‚úÖ –¢–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ —Å–æ–∑–¥–∞–Ω: ${block.id}`, 'success');

                // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                const testElement = document.getElementById('integrationTestBlock');
                const autoKeywords = ['–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', '–ø—Ä–∏–±—ã–ª–∏', '–±–∏–∑–Ω–µ—Å–∞'];
                
                renderer.setTextWithKeywords(testElement, block.text, autoKeywords, block.keywordHighlighting);

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                const manualKeywords = testElement.querySelectorAll('.manual-keyword');
                const autoKeywords_found = testElement.querySelectorAll('.auto-keyword');

                showStatus(`‚úÖ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω. –†—É—á–Ω—ã—Ö: ${manualKeywords.length}, –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö: ${autoKeywords_found.length}`, 'success');

                if (manualKeywords.length > 0 && autoKeywords_found.length > 0) {
                    showStatus('üéâ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!', 'success');
                } else {
                    showStatus('‚ö†Ô∏è –ù–µ –≤—Å–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ–¥—Å–≤–µ—á–µ–Ω—ã', 'error');
                }

            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }

        // –¢–µ—Å—Ç StateManager
        function testStateManager() {
            testResults.innerHTML = '';
            
            if (!initializeModules()) return;

            try {
                // –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–∞–π–¥–∞
                const slide = state.createSlide();
                showStatus(`‚úÖ StateManager: –°–ª–∞–π–¥ —Å–æ–∑–¥–∞–Ω`, 'success');

                // –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è –±–ª–æ–∫–∞ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                const block = state.createTextBlock(slide.id, {
                    text: '–¢–µ—Å—Ç *–∫–ª—é—á–µ–≤—ã—Ö* —Å–ª–æ–≤',
                    keywordHighlighting: {
                        autoHighlight: true,
                        keywordColor: '#FF5722',
                        autoKeywordColor: '#2196F3'
                    }
                });

                showStatus(`‚úÖ StateManager: –ë–ª–æ–∫ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ —Å–æ–∑–¥–∞–Ω`, 'success');

                // –¢–µ—Å—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
                state.updateTextBlockProperty(block.id, 'keywordHighlighting.glowIntensity', 0.8);
                
                const updatedBlock = state.getActiveSlide().textBlocks.find(b => b.id === block.id);
                if (updatedBlock.keywordHighlighting.glowIntensity === 0.8) {
                    showStatus(`‚úÖ StateManager: –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω—ã`, 'success');
                } else {
                    showStatus(`‚ùå StateManager: –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫`, 'error');
                }

            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞ StateManager: ${error.message}`, 'error');
            }
        }

        // –¢–µ—Å—Ç Renderer
        function testRenderer() {
            testResults.innerHTML = '';
            
            if (!initializeModules()) return;

            try {
                const testElement = document.createElement('div');
                const testText = '–ü—Ä–æ–≤–µ—Ä–∫–∞ *—Ä—É—á–Ω—ã—Ö* –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö';
                const autoKeywords = ['–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö', '–ø—Ä–æ–≤–µ—Ä–∫–∞'];
                const settings = {
                    autoHighlight: true,
                    keywordColor: '#E91E63',
                    autoKeywordColor: '#9C27B0',
                    glowEnabled: true,
                    glowIntensity: 0.5
                };

                renderer.setTextWithKeywords(testElement, testText, autoKeywords, settings);

                const manualKeywords = testElement.querySelectorAll('.manual-keyword');
                const autoKeywords_found = testElement.querySelectorAll('.auto-keyword');

                showStatus(`‚úÖ Renderer: –û–±—Ä–∞–±–æ—Ç–∞–Ω–æ —Ä—É—á–Ω—ã—Ö: ${manualKeywords.length}, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö: ${autoKeywords_found.length}`, 'success');

                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Ü–≤–µ—Ç–æ–≤
                if (manualKeywords.length > 0) {
                    const manualStyle = manualKeywords[0].style.background;
                    if (manualStyle.includes('rgb')) {
                        showStatus(`‚úÖ Renderer: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ü–≤–µ—Ç–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã`, 'success');
                    }
                }

                if (manualKeywords.length > 0 && autoKeywords_found.length > 0) {
                    showStatus('üéâ Renderer —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!', 'success');
                }

            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞ Renderer: ${error.message}`, 'error');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        function updateBlock() {
            const testElement = document.getElementById('integrationTestBlock');
            const settings = {
                autoHighlight: document.getElementById('autoHighlightToggle').checked,
                keywordColor: document.getElementById('manualColorPicker').value,
                autoKeywordColor: document.getElementById('autoColorPicker').value,
                glowEnabled: true,
                glowIntensity: parseFloat(document.getElementById('glowIntensityRange').value)
            };

            const autoKeywords = ['–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏', '–ø—Ä–∏–±—ã–ª–∏', '–±–∏–∑–Ω–µ—Å–∞'];
            const text = '–ò–∑—É—á–∞–π—Ç–µ *—Ä—ã–Ω–æ–∫* –∏ –¥–µ–ª–∞–π—Ç–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏ –æ—Ç –±–∏–∑–Ω–µ—Å–∞';

            if (renderer) {
                renderer.setTextWithKeywords(testElement, text, autoKeywords, settings);
            }

            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç–∏
            document.getElementById('glowValue').textContent = Math.round(settings.glowIntensity * 100) + '%';
        }

        // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('autoHighlightToggle').addEventListener('change', updateBlock);
            document.getElementById('manualColorPicker').addEventListener('change', updateBlock);
            document.getElementById('autoColorPicker').addEventListener('change', updateBlock);
            document.getElementById('glowIntensityRange').addEventListener('input', updateBlock);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –±–ª–æ–∫
            setTimeout(updateBlock, 100);
        });
    </script>
</body>
</html>