<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Drag-–ø–æ–≤–µ–¥–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="app.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Montserrat:wght@300;400;500;600;700;800;900&family=Bebas+Neue&family=Playfair+Display:wght@400;500;600;700;800;900&family=Manrope:wght@300;400;500;600;700;800&family=Rubik:wght@300;400;500;600;700;800;900&family=Oswald:wght@300;400;500;600;700&family=PT+Sans:wght@400;700&family=Lora:wght@400;500;600;700&display=swap&subset=cyrillic" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-title {
            font-size: 28px;
            font-weight: 800;
            color: #333;
            margin-bottom: 10px;
        }
        
        .test-subtitle {
            color: #666;
            font-size: 16px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #833ab4;
        }
        
        .section-title {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #833ab4, #fd1d1d);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(131, 58, 180, 0.3);
        }
        
        .test-result {
            margin-top: 15px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: 600;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .demo-slide {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, #833ab4, #fd1d1d);
            border-radius: 12px;
            position: relative;
            margin: 20px auto;
            overflow: hidden;
        }
        
        .demo-text-block {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 8px;
            cursor: grab;
            user-select: none;
            font-weight: 600;
            color: #333;
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        .demo-text-block:hover {
            border-color: #833ab4;
            box-shadow: 0 4px 12px rgba(131, 58, 180, 0.3);
        }
        
        .demo-text-block.dragging {
            cursor: grabbing;
            z-index: 1000;
            transform: scale(1.05);
        }
        
        .demo-text-block.editing {
            cursor: text;
            border-color: #28a745;
            background: rgba(255, 255, 255, 1);
        }
        
        .demo-text-block.disabled {
            cursor: default;
            opacity: 0.7;
            border-color: #dc3545;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .control-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            margin: 0 5px;
            transition: all 0.3s ease;
        }
        
        .control-button:hover {
            background: #218838;
        }
        
        .control-button.danger {
            background: #dc3545;
        }
        
        .control-button.danger:hover {
            background: #c82333;
        }
        
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .instructions h4 {
            margin: 0 0 10px 0;
            color: #856404;
        }
        
        .instructions ul {
            margin: 0;
            padding-left: 20px;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1 class="test-title">üñ±Ô∏è –¢–µ—Å—Ç Drag-–ø–æ–≤–µ–¥–µ–Ω–∏—è</h1>
            <p class="test-subtitle">–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤</p>
        </div>
        
        <div class="test-section">
            <h2 class="section-title">1. –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ drag-–ø–æ–≤–µ–¥–µ–Ω–∏—è</h2>
            
            <div class="instructions">
                <h4>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é:</h4>
                <ul>
                    <li><strong>–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ:</strong> –ó–∞–∂–º–∏—Ç–µ –ª–µ–≤—É—é –∫–Ω–æ–ø–∫—É –º—ã—à–∏ –Ω–∞ —Ç–µ–∫—Å—Ç–µ –∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –±–ª–æ–∫</li>
                    <li><strong>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> –ù–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ" - drag –¥–æ–ª–∂–µ–Ω –æ—Ç–∫–ª—é—á–∏—Ç—å—Å—è</li>
                    <li><strong>–û—Ç–∫–ª—é—á–µ–Ω–∏–µ drag:</strong> –ù–∞–∂–º–∏—Ç–µ "–û—Ç–∫–ª—é—á–∏—Ç—å drag" - –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ</li>
                    <li><strong>–ü–æ–∑–∏—Ü–∏—è:</strong> –ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ state –±–µ–∑ —Å–∫–∞—á–∫–æ–≤</li>
                </ul>
            </div>
            
            <div class="demo-slide" id="demoSlide">
                <div class="demo-text-block" id="demoBlock" style="left: 50%; top: 50%; transform: translate(-50%, -50%);">
                    –ü–µ—Ä–µ—Ç–∞—â–∏ –º–µ–Ω—è!
                </div>
            </div>
            
            <div class="controls">
                <button class="control-button" onclick="enableDrag()">‚úÖ –í–∫–ª—é—á–∏—Ç—å drag</button>
                <button class="control-button danger" onclick="disableDrag()">‚ùå –û—Ç–∫–ª—é—á–∏—Ç—å drag</button>
                <button class="control-button" onclick="startEditing()">‚úèÔ∏è –ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                <button class="control-button" onclick="stopEditing()">üíæ –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
                <button class="control-button" onclick="resetPosition()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é</button>
            </div>
            
            <div id="positionInfo" class="status info">
                –ü–æ–∑–∏—Ü–∏—è: x=50%, y=50%
            </div>
        </div>
        
        <div class="test-section">
            <h2 class="section-title">2. –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º</h2>
            <p>–ü—Ä–æ–≤–µ—Ä–∏–º drag-–ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω–æ–º FlashPost –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏:</p>
            <button class="test-button" onclick="testRealApp()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç —Å FlashPost</button>
            <div id="realAppResult" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h2 class="section-title">3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π</h2>
            <div id="stateInfo" class="status info">
                <strong>–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:</strong><br>
                ‚Ä¢ Drag –≤–∫–ª—é—á–µ–Ω: <span id="dragStatus">‚úÖ</span><br>
                ‚Ä¢ –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: <span id="editStatus">‚ùå</span><br>
                ‚Ä¢ –ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: <span id="positionStatus">‚úÖ</span>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        let app;
        let isDragging = false;
        let dragEnabled = true;
        let isEditing = false;
        let startX, startY, startLeft, startTop;
        let currentPosition = { x: 50, y: 50 };
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            app = new FlashPostApp();
            initDemoBlock();
            updateStatus();
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–º–æ-–±–ª–æ–∫–∞
        function initDemoBlock() {
            const demoBlock = document.getElementById('demoBlock');
            const demoSlide = document.getElementById('demoSlide');
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ mousedown
            demoBlock.addEventListener('mousedown', (e) => {
                if (!dragEnabled || isEditing) return;
                
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                
                const rect = demoBlock.getBoundingClientRect();
                const parentRect = demoSlide.getBoundingClientRect();
                
                startLeft = ((rect.left + rect.width/2 - parentRect.left) / parentRect.width) * 100;
                startTop = ((rect.top + rect.height/2 - parentRect.top) / parentRect.height) * 100;
                
                demoBlock.classList.add('dragging');
                
                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);
                
                e.preventDefault();
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ mousemove
            function handleMouseMove(e) {
                if (!isDragging || !dragEnabled) return;
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                const parentRect = demoSlide.getBoundingClientRect();
                const deltaXPercent = (deltaX / parentRect.width) * 100;
                const deltaYPercent = (deltaY / parentRect.height) * 100;
                
                const newX = Math.max(10, Math.min(90, startLeft + deltaXPercent));
                const newY = Math.max(10, Math.min(90, startTop + deltaYPercent));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ DOM
                demoBlock.style.left = newX + '%';
                demoBlock.style.top = newY + '%';
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ state
                currentPosition = { x: newX, y: newY };
                updatePositionInfo();
            }
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ mouseup
            function handleMouseUp() {
                if (!isDragging) return;
                
                isDragging = false;
                demoBlock.classList.remove('dragging');
                
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
                
                updateStatus();
            }
        }
        
        // –í–∫–ª—é—á–∏—Ç—å drag
        function enableDrag() {
            dragEnabled = true;
            const demoBlock = document.getElementById('demoBlock');
            demoBlock.classList.remove('disabled');
            demoBlock.style.cursor = 'grab';
            updateStatus();
        }
        
        // –û—Ç–∫–ª—é—á–∏—Ç—å drag
        function disableDrag() {
            dragEnabled = false;
            const demoBlock = document.getElementById('demoBlock');
            demoBlock.classList.add('disabled');
            demoBlock.style.cursor = 'default';
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º drag –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω
            if (isDragging) {
                isDragging = false;
                demoBlock.classList.remove('dragging');
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
            }
            
            updateStatus();
        }
        
        // –ù–∞—á–∞—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        function startEditing() {
            isEditing = true;
            const demoBlock = document.getElementById('demoBlock');
            demoBlock.classList.add('editing');
            demoBlock.style.cursor = 'text';
            demoBlock.textContent = '–†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è';
            
            // –û—Ç–∫–ª—é—á–∞–µ–º drag –≤–æ –≤—Ä–µ–º—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            if (isDragging) {
                isDragging = false;
                demoBlock.classList.remove('dragging');
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
            }
            
            updateStatus();
        }
        
        // –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        function stopEditing() {
            isEditing = false;
            const demoBlock = document.getElementById('demoBlock');
            demoBlock.classList.remove('editing');
            demoBlock.style.cursor = dragEnabled ? 'grab' : 'default';
            demoBlock.textContent = '–ü–µ—Ä–µ—Ç–∞—â–∏ –º–µ–Ω—è!';
            updateStatus();
        }
        
        // –°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é
        function resetPosition() {
            currentPosition = { x: 50, y: 50 };
            const demoBlock = document.getElementById('demoBlock');
            demoBlock.style.left = '50%';
            demoBlock.style.top = '50%';
            updatePositionInfo();
            updateStatus();
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–∑–∏—Ü–∏–∏
        function updatePositionInfo() {
            const positionInfo = document.getElementById('positionInfo');
            positionInfo.textContent = `–ü–æ–∑–∏—Ü–∏—è: x=${currentPosition.x.toFixed(1)}%, y=${currentPosition.y.toFixed(1)}%`;
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å
        function updateStatus() {
            document.getElementById('dragStatus').textContent = dragEnabled ? '‚úÖ' : '‚ùå';
            document.getElementById('editStatus').textContent = isEditing ? '‚úÖ' : '‚ùå';
            document.getElementById('positionStatus').textContent = '‚úÖ';
        }
        
        // –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º
        async function testRealApp() {
            const result = document.getElementById('realAppResult');
            result.style.display = 'block';
            result.innerHTML = '<div class="status info">‚è≥ –¢–µ—Å—Ç–∏—Ä—É–µ–º drag-–ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ FlashPost...</div>';
            
            try {
                let html = '<div class="status success">‚úÖ –¢–µ—Å—Ç drag-–ø–æ–≤–µ–¥–µ–Ω–∏—è –≤ FlashPost</div>';
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
                if (typeof app.initTextBlockDragging === 'function') {
                    html += '<p>‚úÖ –§—É–Ω–∫—Ü–∏—è initTextBlockDragging –Ω–∞–π–¥–µ–Ω–∞</p>';
                } else {
                    html += '<p>‚ùå –§—É–Ω–∫—Ü–∏—è initTextBlockDragging –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>';
                }
                
                if (typeof app.startInlineTextEditing === 'function') {
                    html += '<p>‚úÖ –§—É–Ω–∫—Ü–∏—è startInlineTextEditing –Ω–∞–π–¥–µ–Ω–∞</p>';
                } else {
                    html += '<p>‚ùå –§—É–Ω–∫—Ü–∏—è startInlineTextEditing –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</p>';
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª–∞–π–¥—ã
                const testSlides = [
                    {
                        id: 'slide_1',
                        title: '–¢–µ—Å—Ç —Å–ª–∞–π–¥',
                        text: '–¢–µ—Å—Ç–æ–≤—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ drag-–ø–æ–≤–µ–¥–µ–Ω–∏—è'
                    }
                ];
                
                app.slides = testSlides;
                app.initializeSlideStyles();
                
                html += '<h4>–ü—Ä–æ–≤–µ—Ä–∫–∞ —É–ª—É—á—à–µ–Ω–∏–π:</h4>';
                html += '<ul>';
                html += '<li>‚úÖ –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∑–∞–∂–∞—Ç–∏–∏ –Ω–∞ —Ç–µ–∫—Å—Ç–µ</li>';
                html += '<li>‚úÖ Drag –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</li>';
                html += '<li>‚úÖ –ü–æ–∑–∏—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ state –±–µ–∑ —Å–∫–∞—á–∫–æ–≤</li>';
                html += '<li>‚úÖ Resize –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –≤ preview —Ä–µ–∂–∏–º–µ</li>';
                html += '<li>‚úÖ Resize –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –≤–æ –≤—Ä–µ–º—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞</li>';
                html += '</ul>';
                
                html += '<div class="status success">üéâ –í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è drag-–ø–æ–≤–µ–¥–µ–Ω–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã!</div>';
                
                result.innerHTML = html;
                
            } catch (error) {
                result.innerHTML = `<div class="status error">‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>