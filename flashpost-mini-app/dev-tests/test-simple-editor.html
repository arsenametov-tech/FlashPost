<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ - FlashPost</title>
    <link rel="stylesheet" href="app.css">
    <style>
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ */
        .test-controls {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.95);
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 10000;
            font-size: 12px;
        }
        
        .test-controls h4 {
            margin: 0 0 10px 0;
            color: #333;
        }
        
        .test-controls button {
            margin: 3px;
            padding: 6px 10px;
            border: 1px solid #833ab4;
            background: white;
            color: #833ab4;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            display: block;
            width: 100%;
        }
        
        .test-controls button:hover {
            background: #833ab4;
            color: white;
        }
        
        .test-info {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 11px;
            font-family: monospace;
            z-index: 10000;
            max-width: 250px;
        }
        
        .test-info h4 {
            margin: 0 0 10px 0;
            color: #4ecdc4;
        }
        
        .info-item {
            margin: 5px 0;
        }
        
        .info-value {
            color: #ffeb3b;
        }
        
        .success {
            color: #4caf50;
        }
        
        .warning {
            color: #ff9800;
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ FlashPost...</div>
    </div>

    <div id="app" class="app"></div>
    
    <!-- –ö–æ–Ω—Ç—Ä–æ–ª—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
    <div class="test-controls">
        <h4>üß™ –¢–µ—Å—Ç —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</h4>
        <button onclick="createTestData()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
        <button onclick="openEditor()">–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä</button>
        <button onclick="testAddBlock()">–î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫</button>
        <button onclick="testSelectBlock()">–í—ã–±—Ä–∞—Ç—å –±–ª–æ–∫</button>
        <button onclick="testEditBlock()">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±–ª–æ–∫</button>
        <button onclick="validateEditor()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–æ—Ä</button>
    </div>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ -->
    <div class="test-info">
        <h4>üìä –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞</h4>
        <div class="info-item">–†–µ–∂–∏–º: <span class="info-value" id="currentMode">start</span></div>
        <div class="info-item">–°–ª–∞–π–¥–æ–≤: <span class="info-value" id="slidesCount">0</span></div>
        <div class="info-item">–ê–∫—Ç–∏–≤–Ω—ã–π —Å–ª–∞–π–¥: <span class="info-value" id="activeSlide">null</span></div>
        <div class="info-item">–ê–∫—Ç–∏–≤–Ω—ã–π –±–ª–æ–∫: <span class="info-value" id="activeBlock">null</span></div>
        <div class="info-item">–ë–ª–æ–∫–æ–≤ –≤ —Å–ª–∞–π–¥–µ: <span class="info-value" id="blocksCount">0</span></div>
        <div class="info-item">–ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è: <span id="addButtonStatus" class="warning">–ù–µ –Ω–∞–π–¥–µ–Ω–∞</span></div>
        <div class="info-item">–ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: <span id="panelStatus" class="warning">–ù–µ –∞–∫—Ç–∏–≤–Ω–∞</span></div>
    </div>

    <script src="app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        const app = new FlashPostApp();
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function createTestData() {
            // –û—á–∏—â–∞–µ–º –ø—Ä–æ–µ–∫—Ç
            app.project.slides = [];
            app.project.activeSlideId = null;
            app.project.activeTextBlockId = null;
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª–∞–π–¥—ã
            for (let i = 0; i < 2; i++) {
                const slide = app.createSlide({
                    title: `–¢–µ—Å—Ç–æ–≤—ã–π —Å–ª–∞–π–¥ ${i + 1}`,
                    text: `–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–ª–∞–π–¥–∞ ${i + 1}`,
                    background: {
                        type: 'color',
                        color: ['#833ab4', '#fd1d1d'][i],
                        x: 50,
                        y: 50,
                        brightness: 100
                    }
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ–¥–∏–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –≤ –ø–µ—Ä–≤—ã–π —Å–ª–∞–π–¥
                if (i === 0) {
                    app.createTextBlock(slide.id, {
                        text: '–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–ª–∞–π–¥–∞',
                        x: 50,
                        y: 30,
                        width: 80,
                        font: 'Montserrat',
                        size: 24,
                        weight: 700,
                        color: '#ffffff'
                    });
                }
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —Å–ª–∞–π–¥ –∫–∞–∫ –∞–∫—Ç–∏–≤–Ω—ã–π
            if (app.project.slides.length > 0) {
                app.setActiveSlideByIndex(0);
            }
            
            updateInfo();
            console.log('üß™ –°–æ–∑–¥–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ');
        }
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        function openEditor() {
            if (app.project.slides.length === 0) {
                alert('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ!');
                return;
            }
            app.enterEditMode();
            updateInfo();
        }
        
        // –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∞
        function testAddBlock() {
            if (!app.isMode('edit')) {
                alert('–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä!');
                return;
            }
            
            const addBtn = document.getElementById('addTextBlockBtn');
            if (addBtn) {
                addBtn.click();
                console.log('üß™ –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∞');
            } else {
                alert('–ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!');
            }
            updateInfo();
        }
        
        // –¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –±–ª–æ–∫–∞
        function testSelectBlock() {
            if (!app.isMode('edit')) {
                alert('–°–Ω–∞—á–∞–ª–∞ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä!');
                return;
            }
            
            const blocks = document.querySelectorAll('.preview-text-block');
            if (blocks.length > 0) {
                blocks[0].click();
                console.log('üß™ –¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ –±–ª–æ–∫–∞');
            } else {
                alert('–ù–µ—Ç –±–ª–æ–∫–æ–≤ –¥–ª—è –≤—ã–±–æ—Ä–∞!');
            }
            updateInfo();
        }
        
        // –¢–µ—Å—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–∞
        function testEditBlock() {
            const activeBlock = app.getActiveTextBlock();
            if (!activeBlock) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –±–ª–æ–∫!');
                return;
            }
            
            const textEditor = document.getElementById('blockTextEditor');
            const fontSelector = document.getElementById('blockFontSelector');
            const sizeSlider = document.getElementById('blockSizeSlider');
            
            if (textEditor) {
                textEditor.value = '–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç';
                textEditor.dispatchEvent(new Event('input'));
            }
            
            if (fontSelector) {
                fontSelector.value = 'Bebas Neue';
                fontSelector.dispatchEvent(new Event('change'));
            }
            
            if (sizeSlider) {
                sizeSlider.value = '36';
                sizeSlider.dispatchEvent(new Event('input'));
            }
            
            console.log('üß™ –¢–µ—Å—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–ª–æ–∫–∞');
            updateInfo();
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        function validateEditor() {
            let issues = [];
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            const addBtn = document.getElementById('addTextBlockBtn');
            if (!addBtn && app.isMode('edit')) {
                issues.push('–ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const textEditor = document.getElementById('blockTextEditor');
            const activeBlock = app.getActiveTextBlock();
            
            if (activeBlock && !textEditor) {
                issues.push('–ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞');
            }
            
            if (!activeBlock && textEditor) {
                issues.push('–ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞');
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É —Å activeTextBlockId
            if (activeBlock && app.project.activeTextBlockId !== activeBlock.id) {
                issues.push('activeTextBlockId –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–º—É –±–ª–æ–∫—É');
            }
            
            if (issues.length === 0) {
                alert('‚úÖ –†–µ–¥–∞–∫—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!');
                console.log('‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ');
            } else {
                alert('‚ùå –ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ–±–ª–µ–º—ã:\n' + issues.join('\n'));
                console.error('‚ùå –ü—Ä–æ–±–ª–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏:', issues);
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
        function updateInfo() {
            document.getElementById('currentMode').textContent = app.project.mode;
            document.getElementById('slidesCount').textContent = app.project.slides.length;
            document.getElementById('activeSlide').textContent = app.project.activeSlideId || 'null';
            document.getElementById('activeBlock').textContent = app.project.activeTextBlockId || 'null';
            
            const activeSlide = app.getActiveSlide();
            const blocksCount = activeSlide ? activeSlide.textBlocks.length : 0;
            document.getElementById('blocksCount').textContent = blocksCount;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
            const addBtn = document.getElementById('addTextBlockBtn');
            const addButtonStatus = document.getElementById('addButtonStatus');
            if (addBtn) {
                addButtonStatus.textContent = '–ù–∞–π–¥–µ–Ω–∞';
                addButtonStatus.className = 'success';
            } else {
                addButtonStatus.textContent = '–ù–µ –Ω–∞–π–¥–µ–Ω–∞';
                addButtonStatus.className = 'warning';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
            const textEditor = document.getElementById('blockTextEditor');
            const panelStatus = document.getElementById('panelStatus');
            const activeBlock = app.getActiveTextBlock();
            
            if (activeBlock && textEditor) {
                panelStatus.textContent = '–ê–∫—Ç–∏–≤–Ω–∞';
                panelStatus.className = 'success';
            } else if (activeBlock && !textEditor) {
                panelStatus.textContent = '–û—à–∏–±–∫–∞';
                panelStatus.className = 'warning';
            } else {
                panelStatus.textContent = '–ù–µ –∞–∫—Ç–∏–≤–Ω–∞';
                panelStatus.className = 'warning';
            }
        }
        
        // –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º render –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
        const originalRender = app.render.bind(app);
        app.render = function() {
            const result = originalRender();
            setTimeout(updateInfo, 100);
            return result;
        };
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(updateInfo, 2000);
        
        // –ù–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        setTimeout(updateInfo, 1000);
        
        console.log('üß™ –¢–µ—Å—Ç —É–ø—Ä–æ—â–µ–Ω–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –∑–∞–ø—É—â–µ–Ω');
        console.log('‚ûï –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É addTextBlock()');
        console.log('üéØ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–∞–±–æ—Ç—É —Å activeTextBlockId');
        console.log('‚úèÔ∏è –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è: block.font, block.size, block.text');
    </script>
</body>
</html>