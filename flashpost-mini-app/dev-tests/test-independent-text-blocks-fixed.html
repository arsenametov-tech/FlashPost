<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ - FlashPost</title>
    <link rel="stylesheet" href="app.css">
    <style>
        body {
            background: linear-gradient(135deg, #833ab4 0%, #fd1d1d 25%, #fcb045 50%, #f77737 75%, #e1306c 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .test-container {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .test-title {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        
        .test-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .start-btn {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .start-btn:hover {
            background: #6d2d96;
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="test-title">üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏</h1>
        
        <div class="test-info">
            <strong>–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:</strong><br>
            ‚úÖ –ö–∞–∂–¥—ã–π —Å–ª–∞–π–¥ –∏–º–µ–µ—Ç —Å–≤–æ–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏<br>
            ‚úÖ –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å activeTextBlockId<br>
            ‚úÖ –ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–Ω—è–µ—Ç —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –±–ª–æ–∫<br>
            ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ addTextBlock() –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤
        </div>
        
        <button class="start-btn" onclick="startTest()">üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
    </div>

    <script>
        // ===== –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –¢–ï–ö–°–¢–û–í–´–• –ë–õ–û–ö–û–í =====
        
        class FixedFlashPostApp {
            constructor() {
                // === –ü–†–ê–í–ò–õ–¨–ù–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê ===
                this.project = {
                    slides: [],
                    activeSlideId: null,
                    activeTextBlockId: null,
                    mode: 'edit'
                };
                
                this.applyToAll = false;
                
                console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã...');
                this.init();
            }
            
            init() {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–ª–∞–π–¥—ã —Å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –±–ª–æ–∫–∞–º–∏
                this.createTestSlides();
                this.showApp();
            }
            
            // –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª–∞–π–¥–æ–≤
            createTestSlides() {
                this.project.slides = [
                    {
                        id: 'slide_1',
                        background: { color: '#ff6b6b' },
                        textBlocks: [
                            {
                                id: 'block_1_1',
                                text: '–¢–µ–∫—Å—Ç —Å–ª–∞–π–¥–∞ 1 - –±–ª–æ–∫ 1',
                                x: 20, y: 20, width: 60,
                                font: 'Inter', size: 24, color: '#ffffff'
                            },
                            {
                                id: 'block_1_2', 
                                text: '–¢–µ–∫—Å—Ç —Å–ª–∞–π–¥–∞ 1 - –±–ª–æ–∫ 2',
                                x: 20, y: 60, width: 60,
                                font: 'Inter', size: 18, color: '#ffffff'
                            }
                        ]
                    },
                    {
                        id: 'slide_2',
                        background: { color: '#4ecdc4' },
                        textBlocks: [
                            {
                                id: 'block_2_1',
                                text: '–¢–µ–∫—Å—Ç —Å–ª–∞–π–¥–∞ 2 - –±–ª–æ–∫ 1',
                                x: 30, y: 30, width: 50,
                                font: 'Inter', size: 28, color: '#ffffff'
                            }
                        ]
                    },
                    {
                        id: 'slide_3',
                        background: { color: '#45b7d1' },
                        textBlocks: [
                            {
                                id: 'block_3_1',
                                text: '–¢–µ–∫—Å—Ç —Å–ª–∞–π–¥–∞ 3 - –±–ª–æ–∫ 1',
                                x: 10, y: 40, width: 80,
                                font: 'Inter', size: 20, color: '#ffffff'
                            },
                            {
                                id: 'block_3_2',
                                text: '–¢–µ–∫—Å—Ç —Å–ª–∞–π–¥–∞ 3 - –±–ª–æ–∫ 2', 
                                x: 10, y: 70, width: 80,
                                font: 'Inter', size: 16, color: '#ffffff'
                            },
                            {
                                id: 'block_3_3',
                                text: '–¢–µ–∫—Å—Ç —Å–ª–∞–π–¥–∞ 3 - –±–ª–æ–∫ 3',
                                x: 50, y: 10, width: 40,
                                font: 'Inter', size: 14, color: '#ffffff'
                            }
                        ]
                    }
                ];
                
                this.project.activeSlideId = 'slide_1';
                this.project.activeTextBlockId = 'block_1_1';
                
                console.log('‚úÖ –°–æ–∑–¥–∞–Ω–æ 3 —Å–ª–∞–π–¥–∞ —Å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–º–∏ –±–ª–æ–∫–∞–º–∏');
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–ª–∞–π–¥–∞
            getActiveSlide() {
                return this.project.slides.find(slide => slide.id === this.project.activeSlideId);
            }
            
            // –ü–æ–ª—É—á–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –±–ª–æ–∫–∞
            getActiveTextBlock() {
                if (!this.project.activeTextBlockId) return null;
                
                const activeSlide = this.getActiveSlide();
                if (!activeSlide) return null;
                
                return activeSlide.textBlocks.find(block => block.id === this.project.activeTextBlockId);
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –±–ª–æ–∫–∞
            addTextBlock() {
                const activeSlide = this.getActiveSlide();
                if (!activeSlide) return;
                
                const newBlock = {
                    id: `block_${Date.now()}_${Math.random().toString(36).substr(2, 6)}`,
                    text: '–ù–æ–≤—ã–π —Ç–µ–∫—Å—Ç',
                    x: 50, y: 50, width: 80,
                    font: 'Inter', size: 32, color: '#ffffff'
                };
                
                activeSlide.textBlocks.push(newBlock);
                this.project.activeTextBlockId = newBlock.id;
                
                console.log(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π –±–ª–æ–∫: ${newBlock.id} –≤ —Å–ª–∞–π–¥: ${activeSlide.id}`);
                this.render();
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–ª–∞–π–¥–∞
            setActiveSlide(slideId) {
                this.project.activeSlideId = slideId;
                this.project.activeTextBlockId = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä –±–ª–æ–∫–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ —Å–ª–∞–π–¥–∞
                console.log(`üîÑ –ê–∫—Ç–∏–≤–Ω—ã–π —Å–ª–∞–π–¥: ${slideId}`);
                this.render();
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –±–ª–æ–∫–∞
            setActiveTextBlock(blockId) {
                this.project.activeTextBlockId = blockId;
                console.log(`üîÑ –ê–∫—Ç–∏–≤–Ω—ã–π –±–ª–æ–∫: ${blockId}`);
                this.render();
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞
            updateActiveBlockText(newText) {
                const activeBlock = this.getActiveTextBlock();
                if (activeBlock) {
                    activeBlock.text = newText;
                    console.log(`‚úèÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω —Ç–µ–∫—Å—Ç –±–ª–æ–∫–∞: ${activeBlock.id}`);
                    this.render();
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞
            updateActiveBlockFont(newFont) {
                const activeBlock = this.getActiveTextBlock();
                if (activeBlock) {
                    activeBlock.font = newFont;
                    console.log(`üî§ –û–±–Ω–æ–≤–ª–µ–Ω —à—Ä–∏—Ñ—Ç –±–ª–æ–∫–∞: ${activeBlock.id} -> ${newFont}`);
                    this.render();
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞
            updateActiveBlockSize(newSize) {
                const activeBlock = this.getActiveTextBlock();
                if (activeBlock) {
                    activeBlock.size = newSize;
                    console.log(`üìè –û–±–Ω–æ–≤–ª–µ–Ω —Ä–∞–∑–º–µ—Ä –±–ª–æ–∫–∞: ${activeBlock.id} -> ${newSize}px`);
                    this.render();
                }
            }
            
            // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            render() {
                const activeSlide = this.getActiveSlide();
                const activeBlock = this.getActiveTextBlock();
                
                document.body.innerHTML = `
                    <div class="fixed-app">
                        <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å–ª–∞–π–¥–∞–º -->
                        <div class="slides-nav">
                            <h3>–°–ª–∞–π–¥—ã:</h3>
                            ${this.project.slides.map(slide => `
                                <button class="slide-nav-btn ${slide.id === this.project.activeSlideId ? 'active' : ''}"
                                        onclick="app.setActiveSlide('${slide.id}')">
                                    –°–ª–∞–π–¥ ${slide.id.split('_')[1]} (${slide.textBlocks.length} –±–ª–æ–∫–æ–≤)
                                </button>
                            `).join('')}
                        </div>
                        
                        <!-- –ü—Ä–µ–≤—å—é –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–ª–∞–π–¥–∞ -->
                        <div class="slide-preview">
                            <div class="slide-container" style="background: ${activeSlide.background.color};">
                                ${activeSlide.textBlocks.map(block => `
                                    <div class="text-block ${block.id === this.project.activeTextBlockId ? 'active' : ''}"
                                         onclick="app.setActiveTextBlock('${block.id}')"
                                         style="
                                             position: absolute;
                                             left: ${block.x}%;
                                             top: ${block.y}%;
                                             width: ${block.width}%;
                                             font-family: ${block.font};
                                             font-size: ${block.size}px;
                                             color: ${block.color};
                                             border: ${block.id === this.project.activeTextBlockId ? '2px solid #fff' : '1px solid rgba(255,255,255,0.3)'};
                                             padding: 8px;
                                             cursor: pointer;
                                             border-radius: 4px;
                                         ">
                                        ${block.text}
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- –°–ø–∏—Å–æ–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ -->
                        <div class="blocks-list">
                            <div class="blocks-header">
                                <h3>–¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ —Å–ª–∞–π–¥–∞ ${this.project.activeSlideId.split('_')[1]}:</h3>
                                <button class="add-block-btn" onclick="app.addTextBlock()">
                                    ‚ûï –î–æ–±–∞–≤–∏—Ç—å –±–ª–æ–∫
                                </button>
                            </div>
                            
                            ${activeSlide.textBlocks.map((block, index) => `
                                <div class="block-item ${block.id === this.project.activeTextBlockId ? 'active' : ''}"
                                     onclick="app.setActiveTextBlock('${block.id}')">
                                    <span class="block-number">${index + 1}.</span>
                                    <span class="block-text">${block.text.substring(0, 20)}...</span>
                                    <span class="block-font">${block.font} ${block.size}px</span>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- –ü–∞–Ω–µ–ª—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞ -->
                        ${activeBlock ? `
                            <div class="edit-panel">
                                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞: ${activeBlock.id}</h3>
                                
                                <div class="edit-group">
                                    <label>–¢–µ–∫—Å—Ç:</label>
                                    <textarea onchange="app.updateActiveBlockText(this.value)">${activeBlock.text}</textarea>
                                </div>
                                
                                <div class="edit-group">
                                    <label>–®—Ä–∏—Ñ—Ç:</label>
                                    <select onchange="app.updateActiveBlockFont(this.value)" value="${activeBlock.font}">
                                        <option value="Inter" ${activeBlock.font === 'Inter' ? 'selected' : ''}>Inter</option>
                                        <option value="Arial" ${activeBlock.font === 'Arial' ? 'selected' : ''}>Arial</option>
                                        <option value="Georgia" ${activeBlock.font === 'Georgia' ? 'selected' : ''}>Georgia</option>
                                    </select>
                                </div>
                                
                                <div class="edit-group">
                                    <label>–†–∞–∑–º–µ—Ä: ${activeBlock.size}px</label>
                                    <input type="range" min="12" max="48" value="${activeBlock.size}" 
                                           onchange="app.updateActiveBlockSize(parseInt(this.value))">
                                </div>
                            </div>
                        ` : `
                            <div class="edit-panel">
                                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</p>
                            </div>
                        `}
                        
                        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ -->
                        <div class="state-info">
                            <h4>–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã:</h4>
                            <p><strong>–ê–∫—Ç–∏–≤–Ω—ã–π —Å–ª–∞–π–¥:</strong> ${this.project.activeSlideId}</p>
                            <p><strong>–ê–∫—Ç–∏–≤–Ω—ã–π –±–ª–æ–∫:</strong> ${this.project.activeTextBlockId || '–Ω–µ –≤—ã–±—Ä–∞–Ω'}</p>
                            <p><strong>–í—Å–µ–≥–æ —Å–ª–∞–π–¥–æ–≤:</strong> ${this.project.slides.length}</p>
                            <p><strong>–ë–ª–æ–∫–æ–≤ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º —Å–ª–∞–π–¥–µ:</strong> ${activeSlide.textBlocks.length}</p>
                        </div>
                    </div>
                `;
            }
            
            showApp() {
                // –°–∫—Ä—ã–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                document.querySelector('.test-container').style.display = 'none';
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                const style = document.createElement('style');
                style.textContent = `
                    .fixed-app {
                        display: grid;
                        grid-template-columns: 1fr 2fr 1fr;
                        grid-template-rows: auto 1fr auto;
                        gap: 20px;
                        padding: 20px;
                        background: white;
                        min-height: 100vh;
                        font-family: Inter, sans-serif;
                    }
                    
                    .slides-nav {
                        grid-column: 1;
                        grid-row: 1 / 3;
                    }
                    
                    .slide-nav-btn {
                        display: block;
                        width: 100%;
                        margin-bottom: 8px;
                        padding: 12px;
                        border: 1px solid #ddd;
                        background: white;
                        border-radius: 8px;
                        cursor: pointer;
                        transition: all 0.2s;
                    }
                    
                    .slide-nav-btn.active {
                        background: #833ab4;
                        color: white;
                        border-color: #833ab4;
                    }
                    
                    .slide-preview {
                        grid-column: 2;
                        grid-row: 1 / 3;
                    }
                    
                    .slide-container {
                        position: relative;
                        width: 100%;
                        height: 400px;
                        border-radius: 12px;
                        overflow: hidden;
                    }
                    
                    .text-block {
                        transition: all 0.2s;
                    }
                    
                    .text-block:hover {
                        transform: scale(1.02);
                    }
                    
                    .blocks-list {
                        grid-column: 3;
                        grid-row: 1;
                    }
                    
                    .blocks-header {
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        margin-bottom: 16px;
                    }
                    
                    .add-block-btn {
                        padding: 8px 12px;
                        background: #28a745;
                        color: white;
                        border: none;
                        border-radius: 6px;
                        cursor: pointer;
                        font-size: 12px;
                    }
                    
                    .block-item {
                        padding: 12px;
                        border: 1px solid #ddd;
                        border-radius: 8px;
                        margin-bottom: 8px;
                        cursor: pointer;
                        transition: all 0.2s;
                    }
                    
                    .block-item.active {
                        background: #f0f8ff;
                        border-color: #833ab4;
                    }
                    
                    .block-number {
                        font-weight: bold;
                        color: #833ab4;
                    }
                    
                    .block-text {
                        display: block;
                        margin: 4px 0;
                        font-size: 14px;
                    }
                    
                    .block-font {
                        font-size: 12px;
                        color: #666;
                    }
                    
                    .edit-panel {
                        grid-column: 3;
                        grid-row: 2;
                        padding: 16px;
                        border: 1px solid #ddd;
                        border-radius: 12px;
                        background: #f8f9fa;
                    }
                    
                    .edit-group {
                        margin-bottom: 16px;
                    }
                    
                    .edit-group label {
                        display: block;
                        margin-bottom: 4px;
                        font-weight: 600;
                        font-size: 14px;
                    }
                    
                    .edit-group textarea,
                    .edit-group select,
                    .edit-group input {
                        width: 100%;
                        padding: 8px;
                        border: 1px solid #ddd;
                        border-radius: 6px;
                        font-family: inherit;
                    }
                    
                    .edit-group textarea {
                        height: 60px;
                        resize: vertical;
                    }
                    
                    .state-info {
                        grid-column: 1 / 4;
                        grid-row: 3;
                        padding: 16px;
                        background: #e9ecef;
                        border-radius: 12px;
                        font-size: 14px;
                    }
                    
                    .state-info h4 {
                        margin: 0 0 12px 0;
                        color: #495057;
                    }
                    
                    .state-info p {
                        margin: 4px 0;
                        color: #6c757d;
                    }
                `;
                document.head.appendChild(style);
                
                this.render();
            }
        }
        
        function startTest() {
            console.log('üîß –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã');
            window.app = new FixedFlashPostApp();
        }
        
        console.log('üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
    </script>
</body>
</html>