<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template System Test - FlashPost</title>
    <link rel="stylesheet" href="../app.css">
    <style>
        body {
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .test-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
        }
        
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        
        .test-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .test-btn {
            padding: 10px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .test-btn:hover {
            background: #5a6fd8;
            transform: translateY(-1px);
        }
        
        .test-results {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            font-weight: 600;
            margin: 5px 0;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üéØ Template System Test</h1>
            <p>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤ FlashPost</p>
        </div>

        <!-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è -->
        <div class="test-section">
            <h3>1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="initializeModules()">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª–∏</button>
                <button class="test-btn" onclick="checkModules()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥—É–ª–∏</button>
            </div>
            <div id="init-results" class="test-results"></div>
        </div>

        <!-- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
        <div class="test-section">
            <h3>2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="createTestProject()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</button>
                <button class="test-btn" onclick="addTestSlides()">–î–æ–±–∞–≤–∏—Ç—å —Å–ª–∞–π–¥—ã</button>
                <button class="test-btn" onclick="addTextBlocks()">–î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏</button>
            </div>
            <div id="data-results" class="test-results"></div>
        </div>

        <!-- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤ -->
        <div class="test-section">
            <h3>3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —à–∞–±–ª–æ–Ω–æ–≤</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="testSaveTemplate()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
                <button class="test-btn" onclick="testLoadTemplates()">–ó–∞–≥—Ä—É–∑–∏—Ç—å —à–∞–±–ª–æ–Ω—ã</button>
                <button class="test-btn" onclick="testApplyTemplate()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
                <button class="test-btn" onclick="testApplyToAll()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –≤—Å–µ–º</button>
                <button class="test-btn" onclick="testDeleteTemplate()">–£–¥–∞–ª–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
            </div>
            <div id="template-results" class="test-results"></div>
        </div>

        <!-- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UI -->
        <div class="test-section">
            <h3>4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UI —à–∞–±–ª–æ–Ω–æ–≤</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="testSaveModal()">–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è</button>
                <button class="test-btn" onclick="testSelectModal()">–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞</button>
                <button class="test-btn" onclick="testTemplateButtons()">–ö–Ω–æ–ø–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤</button>
            </div>
            <div id="ui-results" class="test-results"></div>
        </div>

        <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="test-section">
            <h3>5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏ —ç–∫—Å–ø–æ—Ä—Ç</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="showTemplateStats()">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤</button>
                <button class="test-btn" onclick="exportTemplates()">–≠–∫—Å–ø–æ—Ä—Ç —à–∞–±–ª–æ–Ω–æ–≤</button>
                <button class="test-btn" onclick="clearAllTemplates()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ —à–∞–±–ª–æ–Ω—ã</button>
            </div>
            <div id="stats-results" class="test-results"></div>
        </div>
    </div>

    <!-- –ú–æ–¥—É–ª–∏ -->
    <script src="../src/state.js"></script>
    <script src="../src/renderer.js"></script>
    <script src="../src/editor.js"></script>
    <script src="../src/drag.js"></script>
    <script src="../src/export.js"></script>
    <script src="../src/ai.js"></script>
    <script src="../src/template-manager.js"></script>
    <script src="../src/app.js"></script>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        let state, renderer, editor, templateManager;
        let testResults = {
            init: [],
            data: [],
            template: [],
            ui: [],
            stats: []
        };

        // –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function log(section, message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}`;
            
            testResults[section].push({ message: logMessage, type });
            updateResults(section);
            
            console.log(`${type.toUpperCase()}: ${logMessage}`);
        }

        function updateResults(section) {
            const container = document.getElementById(`${section}-results`);
            if (!container) return;
            
            container.innerHTML = testResults[section]
                .map(result => `<div class="status ${result.type}">${result.message}</div>`)
                .join('');
            
            container.scrollTop = container.scrollHeight;
        }

        // 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª–µ–π
        function initializeModules() {
            try {
                log('init', '–ù–∞—á–∞–ª–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π...', 'info');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –º–æ–¥—É–ª–∏
                state = new StateManager();
                renderer = new Renderer(state);
                editor = new Editor(state, renderer);
                templateManager = new TemplateManager(state);
                
                // –î–µ–ª–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ
                window.state = state;
                window.renderer = renderer;
                window.editor = editor;
                window.templateManager = templateManager;
                
                log('init', '‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã', 'success');
                
            } catch (error) {
                log('init', `‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
            }
        }

        function checkModules() {
            const modules = [
                { name: 'StateManager', instance: window.StateManager },
                { name: 'Renderer', instance: window.Renderer },
                { name: 'Editor', instance: window.Editor },
                { name: 'TemplateManager', instance: window.TemplateManager },
                { name: 'state', instance: window.state },
                { name: 'templateManager', instance: window.templateManager }
            ];
            
            modules.forEach(module => {
                if (module.instance) {
                    log('init', `‚úÖ ${module.name} –¥–æ—Å—Ç—É–ø–µ–Ω`, 'success');
                } else {
                    log('init', `‚ùå ${module.name} –Ω–µ –Ω–∞–π–¥–µ–Ω`, 'error');
                }
            });
        }

        // 2. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        function createTestProject() {
            try {
                if (!state) {
                    log('data', '‚ùå StateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                state.clearProject();
                log('data', '‚úÖ –¢–µ—Å—Ç–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω', 'success');
                
            } catch (error) {
                log('data', `‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞: ${error.message}`, 'error');
            }
        }

        function addTestSlides() {
            try {
                if (!state) {
                    log('data', '‚ùå StateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                // –°–æ–∑–¥–∞–µ–º 3 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ª–∞–π–¥–∞
                for (let i = 1; i <= 3; i++) {
                    const slide = state.createSlide({
                        title: `–¢–µ—Å—Ç–æ–≤—ã–π —Å–ª–∞–π–¥ ${i}`,
                        text: `–°–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–ª–∞–π–¥–∞ ${i}`,
                        background: {
                            type: 'color',
                            color: i === 1 ? '#833ab4' : i === 2 ? '#fd1d1d' : '#fcb045',
                            image: null,
                            x: 50,
                            y: 50,
                            brightness: 100
                        },
                        textBlocks: [],
                        autoKeywords: [`–∫–ª—é—á–µ–≤–æ–µ${i}`, `—Å–ª–æ–≤–æ${i}`]
                    });
                    
                    log('data', `‚úÖ –°–æ–∑–¥–∞–Ω —Å–ª–∞–π–¥ ${i}: ${slide.id}`, 'success');
                }
                
                state.setActiveSlideByIndex(0);
                log('data', `‚úÖ –°–æ–∑–¥–∞–Ω–æ ${state.getSlidesCount()} —Å–ª–∞–π–¥–æ–≤`, 'success');
                
            } catch (error) {
                log('data', `‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–ª–∞–π–¥–æ–≤: ${error.message}`, 'error');
            }
        }

        function addTextBlocks() {
            try {
                if (!state) {
                    log('data', '‚ùå StateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                const slides = state.getAllSlides();
                
                slides.forEach((slide, slideIndex) => {
                    // –î–æ–±–∞–≤–ª—è–µ–º 2-3 —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –±–ª–æ–∫–∞ –Ω–∞ –∫–∞–∂–¥—ã–π —Å–ª–∞–π–¥
                    const blocksCount = 2 + slideIndex; // 2, 3, 4 –±–ª–æ–∫–∞
                    
                    for (let i = 0; i < blocksCount; i++) {
                        const block = state.createTextBlock(slide.id, {
                            text: `–¢–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ ${i + 1} –Ω–∞ —Å–ª–∞–π–¥–µ ${slideIndex + 1}`,
                            x: 20 + (i * 25),
                            y: 20 + (i * 15),
                            width: 60,
                            height: 'auto',
                            font: i === 0 ? 'Inter' : i === 1 ? 'Montserrat' : 'Oswald',
                            size: 16 + (i * 4),
                            weight: 700,
                            color: '#ffffff',
                            backgroundColor: 'transparent'
                        });
                        
                        log('data', `‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫ ${block.id} –Ω–∞ —Å–ª–∞–π–¥ ${slideIndex + 1}`, 'success');
                    }
                });
                
                log('data', '‚úÖ –¢–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–∞ –≤—Å–µ —Å–ª–∞–π–¥—ã', 'success');
                
            } catch (error) {
                log('data', `‚ùå –û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–ª–æ–∫–æ–≤: ${error.message}`, 'error');
            }
        }

        // 3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–æ–≤
        function testSaveTemplate() {
            try {
                if (!templateManager) {
                    log('template', '‚ùå TemplateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                const templateName = `–¢–µ—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω ${Date.now()}`;
                const success = templateManager.saveCurrentSlideAsTemplate(templateName);
                
                if (success) {
                    log('template', `‚úÖ –®–∞–±–ª–æ–Ω "${templateName}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω`, 'success');
                } else {
                    log('template', '‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞', 'error');
                }
                
            } catch (error) {
                log('template', `‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        function testLoadTemplates() {
            try {
                if (!templateManager) {
                    log('template', '‚ùå TemplateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                const templates = templateManager.getTemplatesFromStorage();
                log('template', `‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${templates.length} —à–∞–±–ª–æ–Ω–æ–≤`, 'success');
                
                templates.forEach((template, index) => {
                    log('template', `  ${index + 1}. "${template.name}" (${template.textBlocksLayout.length} –±–ª–æ–∫–æ–≤)`, 'info');
                });
                
            } catch (error) {
                log('template', `‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}`, 'error');
            }
        }

        function testApplyTemplate() {
            try {
                if (!templateManager) {
                    log('template', '‚ùå TemplateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                const templates = templateManager.getTemplatesFromStorage();
                if (templates.length === 0) {
                    log('template', '‚ùå –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è', 'error');
                    return;
                }
                
                const template = templates[0];
                const success = templateManager.applyTemplateToCurrentSlide(template.id, true);
                
                if (success) {
                    log('template', `‚úÖ –®–∞–±–ª–æ–Ω "${template.name}" –ø—Ä–∏–º–µ–Ω–µ–Ω –∫ —Ç–µ–∫—É—â–µ–º—É —Å–ª–∞–π–¥—É`, 'success');
                } else {
                    log('template', '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞', 'error');
                }
                
            } catch (error) {
                log('template', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        function testApplyToAll() {
            try {
                if (!templateManager) {
                    log('template', '‚ùå TemplateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                const templates = templateManager.getTemplatesFromStorage();
                if (templates.length === 0) {
                    log('template', '‚ùå –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è', 'error');
                    return;
                }
                
                const template = templates[0];
                const success = templateManager.applyTemplateToAllSlides(template.id, true);
                
                if (success) {
                    log('template', `‚úÖ –®–∞–±–ª–æ–Ω "${template.name}" –ø—Ä–∏–º–µ–Ω–µ–Ω –∫–æ –≤—Å–µ–º —Å–ª–∞–π–¥–∞–º`, 'success');
                } else {
                    log('template', '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞ –∫–æ –≤—Å–µ–º —Å–ª–∞–π–¥–∞–º', 'error');
                }
                
            } catch (error) {
                log('template', `‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫–æ –≤—Å–µ–º: ${error.message}`, 'error');
            }
        }

        function testDeleteTemplate() {
            try {
                if (!templateManager) {
                    log('template', '‚ùå TemplateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                const templates = templateManager.getTemplatesFromStorage();
                if (templates.length === 0) {
                    log('template', '‚ùå –ù–µ—Ç —à–∞–±–ª–æ–Ω–æ–≤ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'error');
                    return;
                }
                
                const template = templates[templates.length - 1]; // –£–¥–∞–ª—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π
                const success = templateManager.deleteTemplate(template.id);
                
                if (success) {
                    log('template', `‚úÖ –®–∞–±–ª–æ–Ω "${template.name}" —É–¥–∞–ª–µ–Ω`, 'success');
                } else {
                    log('template', '‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞', 'error');
                }
                
            } catch (error) {
                log('template', `‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        // 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UI
        function testSaveModal() {
            try {
                if (!renderer) {
                    log('ui', '‚ùå Renderer –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                renderer.showSaveTemplateModal();
                log('ui', '‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–Ω–æ', 'success');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    renderer.closeSaveTemplateModal();
                    log('ui', '‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–∫—Ä—ã—Ç–æ', 'success');
                }, 3000);
                
            } catch (error) {
                log('ui', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞: ${error.message}`, 'error');
            }
        }

        function testSelectModal() {
            try {
                if (!renderer) {
                    log('ui', '‚ùå Renderer –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                renderer.showSelectTemplateModal('–¢–µ—Å—Ç–æ–≤–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞', 'üéØ –ü—Ä–∏–º–µ–Ω–∏—Ç—å');
                log('ui', '‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –ø–æ–∫–∞–∑–∞–Ω–æ', 'success');
                
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    renderer.closeSelectTemplateModal();
                    log('ui', '‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∑–∞–∫—Ä—ã—Ç–æ', 'success');
                }, 3000);
                
            } catch (error) {
                log('ui', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–∫–∞–∑–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≤—ã–±–æ—Ä–∞: ${error.message}`, 'error');
            }
        }

        function testTemplateButtons() {
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏
                const testContainer = document.createElement('div');
                testContainer.innerHTML = `
                    <div class="template-actions">
                        <button class="btn btn-template" id="saveTemplateBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —à–∞–±–ª–æ–Ω</button>
                        <button class="btn btn-template" id="applyTemplateToSlideBtn">üéØ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ —Å–ª–∞–π–¥—É</button>
                        <button class="btn btn-template" id="applyTemplateToAllBtn">üìÑ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫–æ –≤—Å–µ–º</button>
                    </div>
                `;
                
                document.body.appendChild(testContainer);
                log('ui', '‚úÖ –ö–Ω–æ–ø–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤ —Å–æ–∑–¥–∞–Ω—ã', 'success');
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∫–Ω–æ–ø–æ–∫
                const buttons = ['saveTemplateBtn', 'applyTemplateToSlideBtn', 'applyTemplateToAllBtn'];
                buttons.forEach(buttonId => {
                    const button = document.getElementById(buttonId);
                    if (button) {
                        log('ui', `‚úÖ –ö–Ω–æ–ø–∫–∞ ${buttonId} –Ω–∞–π–¥–µ–Ω–∞`, 'success');
                    } else {
                        log('ui', `‚ùå –ö–Ω–æ–ø–∫–∞ ${buttonId} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`, 'error');
                    }
                });
                
                // –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    testContainer.remove();
                    log('ui', '‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω—ã', 'success');
                }, 5000);
                
            } catch (error) {
                log('ui', `‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–Ω–æ–ø–æ–∫: ${error.message}`, 'error');
            }
        }

        // 5. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        function showTemplateStats() {
            try {
                if (!templateManager) {
                    log('stats', '‚ùå TemplateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                const stats = templateManager.getTemplateStats();
                log('stats', `‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤:`, 'success');
                log('stats', `  –í—Å–µ–≥–æ —à–∞–±–ª–æ–Ω–æ–≤: ${stats.total}`, 'info');
                
                if (stats.newest) {
                    log('stats', `  –ù–æ–≤–µ–π—à–∏–π: "${stats.newest.name}" (${new Date(stats.newest.createdAt).toLocaleString()})`, 'info');
                }
                
                if (stats.oldest) {
                    log('stats', `  –°—Ç–∞—Ä–µ–π—à–∏–π: "${stats.oldest.name}" (${new Date(stats.oldest.createdAt).toLocaleString()})`, 'info');
                }
                
            } catch (error) {
                log('stats', `‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: ${error.message}`, 'error');
            }
        }

        function exportTemplates() {
            try {
                if (!templateManager) {
                    log('stats', '‚ùå TemplateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                const exportData = templateManager.exportTemplates();
                log('stats', `‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω (${exportData.length} —Å–∏–º–≤–æ–ª–æ–≤)`, 'success');
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 200 —Å–∏–º–≤–æ–ª–æ–≤
                const preview = exportData.substring(0, 200) + (exportData.length > 200 ? '...' : '');
                log('stats', `–ü—Ä–µ–≤—å—é: ${preview}`, 'info');
                
            } catch (error) {
                log('stats', `‚ùå –û—à–∏–±–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞: ${error.message}`, 'error');
            }
        }

        function clearAllTemplates() {
            try {
                if (!templateManager) {
                    log('stats', '‚ùå TemplateManager –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω', 'error');
                    return;
                }
                
                const success = templateManager.clearAllTemplates();
                
                if (success) {
                    log('stats', '‚úÖ –í—Å–µ —à–∞–±–ª–æ–Ω—ã —É–¥–∞–ª–µ–Ω—ã', 'success');
                } else {
                    log('stats', '‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤', 'error');
                }
                
            } catch (error) {
                log('stats', `‚ùå –û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏: ${error.message}`, 'error');
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            setTimeout(() => {
                log('init', '–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞, –≥–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é', 'info');
            }, 500);
        });
    </script>
</body>
</html>