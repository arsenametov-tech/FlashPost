<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regex Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .success { background: #d4edda; }
        .error { background: #f8d7da; }
    </style>
</head>
<body>
    <h1>Regex Debug Test for Russian Keywords</h1>
    
    <div id="results"></div>
    
    <script>
        function escapeRegex(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        function testKeywordMatching() {
            const results = document.getElementById('results');
            
            const testCases = [
                {
                    text: "Изучайте и делайте инвестиции для получения прибыли",
                    keywords: ["инвестиции", "прибыли"],
                    description: "Test 1: Basic Russian keywords"
                },
                {
                    text: " и делайте инвестиции для получения прибыли",
                    keywords: ["инвестиции", "прибыли"],
                    description: "Test 1 Fragment: After manual keyword removal"
                },
                {
                    text: "предприниматели изучают рынок, анализируют и создают инновации для роста бизнеса",
                    keywords: ["предприниматели", "рынок", "инновации", "бизнеса"],
                    description: "Test 2: Multiple Russian keywords"
                }
            ];
            
            testCases.forEach((testCase, index) => {
                const div = document.createElement('div');
                div.className = 'test';
                div.innerHTML = `<h3>${testCase.description}</h3>`;
                
                const textDiv = document.createElement('div');
                textDiv.innerHTML = `<strong>Text:</strong> "${testCase.text}"`;
                div.appendChild(textDiv);
                
                const keywordsDiv = document.createElement('div');
                keywordsDiv.innerHTML = `<strong>Keywords:</strong> [${testCase.keywords.join(', ')}]`;
                div.appendChild(keywordsDiv);
                
                let processedText = testCase.text;
                let totalMatches = 0;
                
                testCase.keywords.forEach(keyword => {
                    const escapedKeyword = escapeRegex(keyword);
                    
                    const patterns = [
                        { name: 'Word boundaries', regex: new RegExp(`\\b(${escapedKeyword})\\b`, 'gi') },
                        { name: 'Space boundaries', regex: new RegExp(`(^|\\s)(${escapedKeyword})(\\s|$)`, 'gi') },
                        { name: 'Simple match', regex: new RegExp(`(${escapedKeyword})`, 'gi') }
                    ];
                    
                    let matched = false;
                    
                    for (let p = 0; p < patterns.length; p++) {
                        const pattern = patterns[p];
                        const beforeReplace = processedText;
                        
                        if (p === 1) {
                            processedText = processedText.replace(pattern.regex, '$1<AUTO_KEYWORD>$2</AUTO_KEYWORD>$3');
                        } else {
                            processedText = processedText.replace(pattern.regex, '<AUTO_KEYWORD>$1</AUTO_KEYWORD>');
                        }
                        
                        if (beforeReplace !== processedText) {
                            const resultDiv = document.createElement('div');
                            resultDiv.className = 'result success';
                            resultDiv.innerHTML = `✅ "${keyword}" matched with ${pattern.name}`;
                            div.appendChild(resultDiv);
                            matched = true;
                            totalMatches++;
                            break;
                        }
                    }
                    
                    if (!matched) {
                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'result error';
                        resultDiv.innerHTML = `❌ "${keyword}" not matched`;
                        div.appendChild(resultDiv);
                    }
                });
                
                const finalDiv = document.createElement('div');
                finalDiv.innerHTML = `<strong>Final text:</strong> ${processedText}`;
                div.appendChild(finalDiv);
                
                const countDiv = document.createElement('div');
                countDiv.innerHTML = `<strong>Matches found:</strong> ${totalMatches}/${testCase.keywords.length}`;
                countDiv.className = totalMatches === testCase.keywords.length ? 'result success' : 'result error';
                div.appendChild(countDiv);
                
                results.appendChild(div);
            });
        }
        
        // Run tests when page loads
        document.addEventListener('DOMContentLoaded', testKeywordMatching);
    </script>
</body>
</html>