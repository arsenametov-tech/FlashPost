<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pure DOM Render System - FlashPost</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Inter, sans-serif;
            background: linear-gradient(135deg, #833ab4 0%, #fd1d1d 25%, #fcb045 50%, #f77737 75%, #e1306c 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .title {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        
        .mode-controls {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s ease;
        }
        
        .btn-primary { background: #833ab4; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .btn.active { transform: scale(1.05); box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
        
        .btn:hover { transform: translateY(-2px); }
        
        .demo-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .demo-block {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 16px;
        }
        
        .slide-container {
            position: relative;
            width: 100%;
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #dee2e6;
            margin-bottom: 16px;
        }
        
        .slide {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .slide-text-block {
            position: absolute;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 8px 12px;
            font-weight: 600;
            color: #333;
            text-align: center;
            transform: translate(-50%, -50%);
            user-select: none;
            transition: all 0.2s ease;
            cursor: default;
        }
        
        /* EDIT —Ä–µ–∂–∏–º */
        .mode-edit .slide-text-block {
            cursor: grab;
            border: 2px dashed transparent;
        }
        
        .mode-edit .slide-text-block:hover {
            border-color: #833ab4;
            box-shadow: 0 4px 12px rgba(131, 58, 180, 0.3);
        }
        
        .mode-edit .slide-text-block.active {
            border-color: #833ab4;
            box-shadow: 0 4px 12px rgba(131, 58, 180, 0.5);
        }
        
        .mode-edit .slide-text-block.dragging {
            cursor: grabbing;
            z-index: 1000;
            transform: translate(-50%, -50%) scale(1.05);
        }
        
        /* PREVIEW —Ä–µ–∂–∏–º */
        .mode-preview .slide-text-block {
            pointer-events: none;
            border: none;
        }
        
        /* EXPORT —Ä–µ–∂–∏–º */
        .mode-export .slide-text-block {
            pointer-events: none;
            border: none;
            background: transparent;
        }
        
        .slide-text-block.glow {
            filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.6));
        }
        
        .auto-keyword {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 700;
        }
        
        .manual-keyword {
            background: linear-gradient(45deg, #48cae4, #0077b6);
            color: white;
            padding: 2px 4px;
            border-radius: 4px;
            font-weight: 700;
        }
        
        .mode-indicator {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .mode-edit { background: #833ab4; color: white; }
        .mode-preview { background: #28a745; color: white; }
        .mode-export { background: #dc3545; color: white; }
        
        .info-panel {
            background: #e9ecef;
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            font-family: monospace;
            margin-top: 16px;
        }
        
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 12px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-bottom: 16px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üîß –ß–∏—Å—Ç–∞—è DOM —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞</h1>
        
        <div class="mode-controls">
            <button class="btn btn-success active" onclick="testApp.setMode('preview')" id="previewBtn">üëÅÔ∏è Preview</button>
            <button class="btn btn-primary" onclick="testApp.setMode('edit')" id="editBtn">‚úèÔ∏è Edit</button>
            <button class="btn btn-info" onclick="testApp.setMode('export')" id="exportBtn">üì• Export</button>
        </div>
        
        <div class="demo-section">
            <!-- –°–ª–∞–π–¥ –¥–µ–º–æ -->
            <div class="demo-block">
                <h3>–°–ª–∞–π–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥</h3>
                <div class="mode-indicator" id="modeIndicator">preview</div>
                
                <div class="slide-container" id="slideContainer">
                    <!-- –°–ª–∞–π–¥ –±—É–¥–µ—Ç –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω —á–µ—Ä–µ–∑ DOM -->
                </div>
                
                <div class="info-panel">
                    <strong>–¢–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º:</strong> <span id="currentMode">preview</span><br>
                    <strong>Drag & Drop:</strong> <span id="dragStatus">–æ—Ç–∫–ª—é—á–µ–Ω</span><br>
                    <strong>–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:</strong> <span id="interactiveStatus">—Ç–æ–ª—å–∫–æ –Ω–∞–≤–∏–≥–∞—Ü–∏—è</span>
                </div>
            </div>
            
            <!-- –õ–æ–≥ –æ–ø–µ—Ä–∞—Ü–∏–π -->
            <div class="demo-block">
                <h3>–õ–æ–≥ DOM –æ–ø–µ—Ä–∞—Ü–∏–π</h3>
                
                <div class="log" id="operationLog">
                    –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ...<br>
                </div>
                
                <div class="mode-controls">
                    <button class="btn btn-info" onclick="testApp.clearLog()" style="width: 100%;">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —á–∏—Å—Ç–æ–π DOM —Å–∏—Å—Ç–µ–º—ã —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
        class PureDOMRenderApp {
            constructor() {
                this.mode = 'preview'; // 'preview' | 'edit' | 'export'
                this.activeBlockId = null;
                this.isDragging = false;
                this.dragOffset = { x: 0, y: 0 };
                
                // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
                this.slide = {
                    id: 'slide_1',
                    background: { type: 'color', color: '#4ecdc4' },
                    textBlocks: [
                        {
                            id: 'block_1',
                            text: '–ò–∑—É—á–∞–π—Ç–µ *—Ä—ã–Ω–æ–∫* –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–±—ã–ª–∏',
                            x: 30, y: 30, width: 40,
                            font: 'Inter', size: 16, weight: 600, color: '#ffffff',
                            glow: false, highlightEnabled: true
                        },
                        {
                            id: 'block_2',
                            text: '–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –≤ –±—É–¥—É—â–µ–µ',
                            x: 70, y: 70, width: 35,
                            font: 'Inter', size: 14, weight: 600, color: '#ffffff',
                            glow: true, highlightEnabled: true
                        }
                    ],
                    autoKeywords: ['–ø—Ä–∏–±—ã–ª—å', '–∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏']
                };
                
                this.init();
            }
            
            init() {
                this.render();
                this.bindEvents();
                this.log('üöÄ –ß–∏—Å—Ç–∞—è DOM —Å–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
            }
            
            // ===== –û–°–ù–û–í–ù–´–ï –ú–ï–¢–û–î–´ –†–ï–ù–î–ï–†–ò–ù–ì–ê =====
            
            // –ì–ª–∞–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä
            render() {
                const container = document.getElementById('slideContainer');
                if (!container) return;
                
                // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                container.innerHTML = '';
                container.className = `slide-container mode-${this.mode}`;
                
                // –†–µ–Ω–¥–µ—Ä–∏–º —Å–ª–∞–π–¥ —á–µ—Ä–µ–∑ DOM
                const slideElement = this.renderSlide(this.slide, this.mode);
                container.appendChild(slideElement);
                
                this.updateModeUI();
                this.log(`‚úÖ –°–ª–∞–π–¥ –æ—Ç—Ä–µ–Ω–¥–µ—Ä–µ–Ω –≤ —Ä–µ–∂–∏–º–µ: ${this.mode}`);
            }
            
            // –†–µ–Ω–¥–µ—Ä —Å–ª–∞–π–¥–∞ (—á–∏—Å—Ç—ã–π DOM)
            renderSlide(slide, mode) {
                const slideEl = document.createElement('div');
                slideEl.className = 'slide';
                slideEl.dataset.slideId = slide.id;
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–æ–Ω
                if (slide.background.type === 'color') {
                    slideEl.style.background = slide.background.color;
                } else if (slide.background.type === 'image' && slide.background.image) {
                    slideEl.style.backgroundImage = `url(${slide.background.image})`;
                    slideEl.style.backgroundSize = 'cover';
                    slideEl.style.backgroundPosition = `${slide.background.x || 50}% ${slide.background.y || 50}%`;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –±–ª–æ–∫–∏
                slide.textBlocks.forEach(block => {
                    const blockElement = this.renderTextBlock(block, mode, slide.autoKeywords || []);
                    slideEl.appendChild(blockElement);
                });
                
                this.log(`üì¶ –°–æ–∑–¥–∞–Ω —Å–ª–∞–π–¥ ${slide.id} —Å ${slide.textBlocks.length} –±–ª–æ–∫–∞–º–∏`);
                return slideEl;
            }
            
            // –†–µ–Ω–¥–µ—Ä —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –±–ª–æ–∫–∞ (—á–∏—Å—Ç—ã–π DOM)
            renderTextBlock(block, mode, autoKeywords = []) {
                const blockEl = document.createElement('div');
                blockEl.className = 'slide-text-block';
                blockEl.dataset.blockId = block.id;
                
                // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
                blockEl.style.left = block.x + '%';
                blockEl.style.top = block.y + '%';
                blockEl.style.width = block.width + '%';
                
                // –°—Ç–∏–ª–∏ —Ç–µ–∫—Å—Ç–∞
                blockEl.style.fontSize = block.size + 'px';
                blockEl.style.fontFamily = block.font;
                blockEl.style.fontWeight = block.weight;
                blockEl.style.color = block.color;
                
                // –°–≤–µ—á–µ–Ω–∏–µ
                if (block.glow) {
                    blockEl.classList.add('glow');
                }
                
                // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
                if (block.highlightEnabled) {
                    this.setTextWithKeywords(blockEl, block.text, autoKeywords);
                } else {
                    blockEl.textContent = block.text;
                }
                
                // –†–µ–∂–∏–º–æ-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
                if (mode === 'edit') {
                    this.setupEditMode(blockEl, block);
                } else if (mode === 'preview') {
                    this.setupPreviewMode(blockEl, block);
                } else if (mode === 'export') {
                    this.setupExportMode(blockEl, block);
                }
                
                this.log(`üî§ –°–æ–∑–¥–∞–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫ ${block.id} –≤ —Ä–µ–∂–∏–º–µ ${mode}`);
                return blockEl;
            }
            
            // ===== –†–ï–ñ–ò–ú–û-–°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò =====
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ EDIT —Ä–µ–∂–∏–º–∞
            setupEditMode(blockEl, block) {
                // Drag & Drop
                blockEl.addEventListener('mousedown', (e) => this.startDrag(e, block.id));
                
                // –í—ã–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞
                blockEl.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.setActiveBlock(block.id);
                });
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
                if (this.activeBlockId === block.id) {
                    blockEl.classList.add('active');
                }
                
                this.log(`‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–µ–Ω EDIT —Ä–µ–∂–∏–º –¥–ª—è –±–ª–æ–∫–∞ ${block.id}`);
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PREVIEW —Ä–µ–∂–∏–º–∞
            setupPreviewMode(blockEl, block) {
                // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
                blockEl.style.pointerEvents = 'none';
                this.log(`üëÅÔ∏è –ù–∞—Å—Ç—Ä–æ–µ–Ω PREVIEW —Ä–µ–∂–∏–º –¥–ª—è –±–ª–æ–∫–∞ ${block.id}`);
            }
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ EXPORT —Ä–µ–∂–∏–º–∞
            setupExportMode(blockEl, block) {
                // –ß–∏—Å—Ç—ã–π –≤–∏–¥ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
                blockEl.style.pointerEvents = 'none';
                blockEl.style.border = 'none';
                blockEl.style.background = 'transparent';
                this.log(`üì• –ù–∞—Å—Ç—Ä–æ–µ–Ω EXPORT —Ä–µ–∂–∏–º –¥–ª—è –±–ª–æ–∫–∞ ${block.id}`);
            }
            
            // ===== –û–ë–†–ê–ë–û–¢–ö–ê –ö–õ–Æ–ß–ï–í–´–• –°–õ–û–í =====
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—Å—Ç–∞ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏ (—á–∏—Å—Ç—ã–π DOM)
            setTextWithKeywords(element, text, autoKeywords = []) {
                // –û—á–∏—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç
                element.innerHTML = '';
                
                let processedText = text;
                const fragments = [];
                
                // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ä—É—á–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (*—Å–ª–æ–≤–æ*)
                const manualKeywordRegex = /\*([^*]+)\*/g;
                let lastIndex = 0;
                let match;
                
                while ((match = manualKeywordRegex.exec(text)) !== null) {
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç –¥–æ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
                    if (match.index > lastIndex) {
                        fragments.push({
                            type: 'text',
                            content: text.substring(lastIndex, match.index)
                        });
                    }
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º —Ä—É—á–Ω–æ–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ
                    fragments.push({
                        type: 'manual-keyword',
                        content: match[1]
                    });
                    
                    lastIndex = match.index + match[0].length;
                }
                
                // –î–æ–±–∞–≤–ª—è–µ–º –æ—Å—Ç–∞–≤—à–∏–π—Å—è —Ç–µ–∫—Å—Ç
                if (lastIndex < text.length) {
                    fragments.push({
                        type: 'text',
                        content: text.substring(lastIndex)
                    });
                }
                
                // –°–æ–∑–¥–∞–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã
                fragments.forEach(fragment => {
                    if (fragment.type === 'manual-keyword') {
                        const span = document.createElement('span');
                        span.className = 'manual-keyword';
                        span.textContent = fragment.content;
                        element.appendChild(span);
                    } else {
                        // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –≤ –æ–±—ã—á–Ω–æ–º —Ç–µ–∫—Å—Ç–µ
                        this.addTextWithAutoKeywords(element, fragment.content, autoKeywords);
                    }
                });
            }
            
            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º–∏ –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
            addTextWithAutoKeywords(parent, text, autoKeywords) {
                if (autoKeywords.length === 0) {
                    parent.appendChild(document.createTextNode(text));
                    return;
                }
                
                let processedText = text;
                const parts = [];
                
                autoKeywords.forEach(keyword => {
                    const regex = new RegExp(`\\b(${keyword})\\b`, 'gi');
                    processedText = processedText.replace(regex, `<AUTO_KEYWORD>$1</AUTO_KEYWORD>`);
                });
                
                // –†–∞–∑–±–∏–≤–∞–µ–º –Ω–∞ —á–∞—Å—Ç–∏
                const segments = processedText.split(/<AUTO_KEYWORD>|<\/AUTO_KEYWORD>/);
                let isKeyword = false;
                
                segments.forEach(segment => {
                    if (segment) {
                        if (isKeyword) {
                            const span = document.createElement('span');
                            span.className = 'auto-keyword';
                            span.textContent = segment;
                            parent.appendChild(span);
                        } else {
                            parent.appendChild(document.createTextNode(segment));
                        }
                    }
                    isKeyword = !isKeyword;
                });
            }
            
            // ===== DRAG & DROP –°–ò–°–¢–ï–ú–ê =====
            
            // –ù–∞—á–∞–ª–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            startDrag(e, blockId) {
                if (this.mode !== 'edit') return;
                
                e.preventDefault();
                this.isDragging = true;
                this.activeBlockId = blockId;
                
                const blockEl = e.target;
                const rect = blockEl.getBoundingClientRect();
                const containerRect = blockEl.parentElement.getBoundingClientRect();
                
                this.dragOffset = {
                    x: e.clientX - rect.left - rect.width / 2,
                    y: e.clientY - rect.top - rect.height / 2
                };
                
                blockEl.classList.add('dragging');
                
                // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                document.addEventListener('mousemove', this.onDragMove);
                document.addEventListener('mouseup', this.stopDrag);
                
                this.log(`üñ±Ô∏è –ù–∞—á–∞—Ç–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ ${blockId}`);
            }
            
            // –ü—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            onDragMove = (e) => {
                if (!this.isDragging || this.mode !== 'edit') return;
                
                const blockEl = document.querySelector(`[data-block-id="${this.activeBlockId}"]`);
                if (!blockEl) return;
                
                const containerRect = blockEl.parentElement.getBoundingClientRect();
                
                // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
                const newX = ((e.clientX - this.dragOffset.x - containerRect.left) / containerRect.width) * 100;
                const newY = ((e.clientY - this.dragOffset.y - containerRect.top) / containerRect.height) * 100;
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                const clampedX = Math.max(0, Math.min(100, newX));
                const clampedY = Math.max(0, Math.min(100, newY));
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é
                blockEl.style.left = clampedX + '%';
                blockEl.style.top = clampedY + '%';
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                const block = this.slide.textBlocks.find(b => b.id === this.activeBlockId);
                if (block) {
                    block.x = clampedX;
                    block.y = clampedY;
                }
            }
            
            // –û–∫–æ–Ω—á–∞–Ω–∏–µ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è
            stopDrag = () => {
                if (!this.isDragging) return;
                
                this.isDragging = false;
                
                const blockEl = document.querySelector(`[data-block-id="${this.activeBlockId}"]`);
                if (blockEl) {
                    blockEl.classList.remove('dragging');
                }
                
                // –£–¥–∞–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                document.removeEventListener('mousemove', this.onDragMove);
                document.removeEventListener('mouseup', this.stopDrag);
                
                this.log(`‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –±–ª–æ–∫–∞ ${this.activeBlockId}`);
            }
            
            // ===== –£–ü–†–ê–í–õ–ï–ù–ò–ï –†–ï–ñ–ò–ú–ê–ú–ò =====
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∂–∏–º–∞
            setMode(newMode) {
                if (this.mode === newMode) return;
                
                const oldMode = this.mode;
                this.mode = newMode;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏
                document.querySelectorAll('.mode-controls .btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                if (newMode === 'preview') document.getElementById('previewBtn').classList.add('active');
                else if (newMode === 'edit') document.getElementById('editBtn').classList.add('active');
                else if (newMode === 'export') document.getElementById('exportBtn').classList.add('active');
                
                // –ü–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏–≤–∞–µ–º
                this.render();
                
                this.log(`üîÑ –†–µ–∂–∏–º –∏–∑–º–µ–Ω–µ–Ω: ${oldMode} ‚Üí ${newMode}`);
            }
            
            // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞
            setActiveBlock(blockId) {
                this.activeBlockId = blockId;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                document.querySelectorAll('.slide-text-block').forEach(el => {
                    el.classList.remove('active');
                });
                
                const activeEl = document.querySelector(`[data-block-id="${blockId}"]`);
                if (activeEl) {
                    activeEl.classList.add('active');
                }
                
                this.log(`üéØ –ê–∫—Ç–∏–≤–Ω—ã–π –±–ª–æ–∫: ${blockId}`);
            }
            
            // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´ =====
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Ä–µ–∂–∏–º–∞
            updateModeUI() {
                const modeIndicator = document.getElementById('modeIndicator');
                const currentMode = document.getElementById('currentMode');
                const dragStatus = document.getElementById('dragStatus');
                const interactiveStatus = document.getElementById('interactiveStatus');
                
                if (modeIndicator) {
                    modeIndicator.textContent = this.mode;
                    modeIndicator.className = `mode-indicator mode-${this.mode}`;
                }
                
                if (currentMode) currentMode.textContent = this.mode;
                
                if (dragStatus) {
                    dragStatus.textContent = this.mode === 'edit' ? '–≤–∫–ª—é—á–µ–Ω' : '–æ—Ç–∫–ª—é—á–µ–Ω';
                }
                
                if (interactiveStatus) {
                    if (this.mode === 'edit') interactiveStatus.textContent = '–ø–æ–ª–Ω–∞—è';
                    else if (this.mode === 'preview') interactiveStatus.textContent = '—Ç–æ–ª—å–∫–æ –Ω–∞–≤–∏–≥–∞—Ü–∏—è';
                    else interactiveStatus.textContent = '–æ—Ç–∫–ª—é—á–µ–Ω–∞';
                }
            }
            
            // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
            bindEvents() {
                // –ö–ª–∏–∫ –≤–Ω–µ –±–ª–æ–∫–æ–≤ —Å–Ω–∏–º–∞–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏–µ
                document.addEventListener('click', (e) => {
                    if (this.mode === 'edit' && !e.target.closest('.slide-text-block')) {
                        this.activeBlockId = null;
                        document.querySelectorAll('.slide-text-block').forEach(el => {
                            el.classList.remove('active');
                        });
                        this.log('‚ùå –°–Ω—è—Ç–æ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞');
                    }
                });
            }
            
            // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
            log(message) {
                const logElement = document.getElementById('operationLog');
                if (logElement) {
                    const timestamp = new Date().toLocaleTimeString();
                    logElement.innerHTML += `[${timestamp}] ${message}<br>`;
                    logElement.scrollTop = logElement.scrollHeight;
                }
            }
            
            // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–∞
            clearLog() {
                const logElement = document.getElementById('operationLog');
                if (logElement) {
                    logElement.innerHTML = '–õ–æ–≥ –æ—á–∏—â–µ–Ω...<br>';
                }
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let testApp;
        
        document.addEventListener('DOMContentLoaded', () => {
            testApp = new PureDOMRenderApp();
            console.log('üîß Pure DOM Render System –∑–∞–≥—Ä—É–∂–µ–Ω');
        });
    </script>
</body>
</html>