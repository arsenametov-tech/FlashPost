<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FlashPost - Telegram Mini App Layout Test</title>
    <link rel="stylesheet" href="app.css">
    <style>
        /* –°–∏–º—É–ª—è—Ü–∏—è Telegram Mini App */
        :root {
            --tg-bg: #ffffff;
            --tg-text: #000000;
            --primary: #833ab4;
        }
        
        /* –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –ø–∞–Ω–µ–ª—å */
        .debug-overlay {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255, 0, 0, 0.8);
            color: white;
            padding: 8px;
            border-radius: 4px;
            font-size: 10px;
            z-index: 1000;
            font-family: monospace;
            max-width: 150px;
        }
        
        .debug-item {
            margin: 2px 0;
        }
        
        /* –°–∏–º—É–ª—è—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü Mini App */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: #007AFF;
            z-index: 9999;
        }
        
        body::after {
            content: 'Telegram Mini App Viewport';
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 20px;
            background: #007AFF;
            color: white;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        /* –¢–µ—Å—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ */
        .test-controls {
            position: fixed;
            bottom: 25px;
            left: 10px;
            display: flex;
            gap: 5px;
            z-index: 1000;
        }
        
        .test-btn {
            padding: 4px 8px;
            background: #007AFF;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
        }
        
        .test-btn:hover {
            background: #0056CC;
        }
    </style>
</head>
<body class="tg-viewport">
    <div class="debug-overlay">
        <div class="debug-item" id="viewportHeight">VH: 0px</div>
        <div class="debug-item" id="appHeight">App: 0px</div>
        <div class="debug-item" id="toolsHeight">Tools: 0px</div>
        <div class="debug-item" id="overflow">Overflow: OK</div>
    </div>
    
    <div class="test-controls">
        <button class="test-btn" onclick="testCarousel()">–ö–∞—Ä—É—Å–µ–ª—å</button>
        <button class="test-btn" onclick="testEditor()">–†–µ–¥–∞–∫—Ç–æ—Ä</button>
        <button class="test-btn" onclick="checkLayout()">–ü—Ä–æ–≤–µ—Ä–∫–∞</button>
    </div>

    <div id="app">
        <div style="padding: 40px; text-align: center; height: 100vh; display: flex; flex-direction: column; justify-content: center;">
            <h2>Telegram Mini App</h2>
            <p>–¢–µ—Å—Ç layout –¥–ª—è –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</p>
            <p style="font-size: 12px; color: #666;">–ü—Ä–æ–≤–µ—Ä—è–µ–º viewport height –∏ sticky –ø–∞–Ω–µ–ª—å</p>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        const app = new FlashPostApp();
        
        // –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        app.slides = [
            {
                title: "Hook",
                text: "üî• Mini App Test 1\n\n–ü—Ä–æ–≤–µ—Ä—è–µ–º layout –≤ Telegram Mini App —Å viewport height –∏ sticky –ø–∞–Ω–µ–ª—å—é –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤."
            },
            {
                title: "Problem", 
                text: "‚ùå Mini App Test 2\n\n–ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –Ω–∏–∫–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –≤—ã—Ö–æ–¥—è—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞."
            },
            {
                title: "Solution",
                text: "‚úÖ Mini App Test 3\n\n–ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É sticky –ø–∞–Ω–µ–ª–∏ —Å max-height: 40vh –∏ overflow-y: auto."
            }
        ];
        
        app.initializeSlideStyles();
        
        // –î–æ–±–∞–≤–ª—è–µ–º Instagram –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const instagramInput = document.createElement('input');
        instagramInput.id = 'instagramInput';
        instagramInput.value = '@mini_app_test';
        instagramInput.style.display = 'none';
        document.body.appendChild(instagramInput);
        
        // –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–ª–∞–¥–∫–∏
        function updateDebugInfo() {
            const viewportHeightEl = document.getElementById('viewportHeight');
            const appHeightEl = document.getElementById('appHeight');
            const toolsHeightEl = document.getElementById('toolsHeight');
            const overflowEl = document.getElementById('overflow');
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã viewport
            const vh = window.innerHeight;
            viewportHeightEl.textContent = `VH: ${vh}px`;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä—ã app
            const appEl = document.getElementById('app');
            if (appEl) {
                const appRect = appEl.getBoundingClientRect();
                appHeightEl.textContent = `App: ${Math.round(appRect.height)}px`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º overflow
                const hasOverflow = appRect.height > vh || appEl.scrollHeight > vh;
                overflowEl.textContent = `Overflow: ${hasOverflow ? 'ERROR' : 'OK'}`;
                overflowEl.style.color = hasOverflow ? '#ff0000' : '#00ff00';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
            const toolsEl = document.querySelector('.editor-tools');
            if (toolsEl) {
                const toolsRect = toolsEl.getBoundingClientRect();
                toolsHeightEl.textContent = `Tools: ${Math.round(toolsRect.height)}px`;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø–∞–Ω–µ–ª—å –Ω–µ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 40vh
                const maxHeight = vh * 0.4;
                const isWithinLimit = toolsRect.height <= maxHeight + 10; // +10px –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å
                toolsHeightEl.style.color = isWithinLimit ? '#00ff00' : '#ff0000';
            } else {
                toolsHeightEl.textContent = 'Tools: N/A';
            }
        }
        
        function testCarousel() {
            console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∫–∞—Ä—É—Å–µ–ª—å –≤ Mini App...');
            app.showCarousel();
            setTimeout(updateDebugInfo, 300);
        }
        
        function testEditor() {
            console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –≤ Mini App...');
            app.openEditor();
            setTimeout(updateDebugInfo, 300);
        }
        
        function checkLayout() {
            console.log('üß™ –ü—Ä–æ–≤–µ—Ä—è–µ–º layout Mini App...');
            
            const vh = window.innerHeight;
            const body = document.body;
            const app = document.getElementById('app');
            
            console.log('üìè –†–∞–∑–º–µ—Ä—ã:', {
                viewport: vh,
                bodyHeight: body.offsetHeight,
                appHeight: app.offsetHeight,
                bodyOverflow: window.getComputedStyle(body).overflow,
                appOverflow: window.getComputedStyle(app).overflow
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º sticky –ø–∞–Ω–µ–ª—å
            const toolsEl = document.querySelector('.editor-tools');
            if (toolsEl) {
                const toolsStyle = window.getComputedStyle(toolsEl);
                console.log('üîß –ü–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:', {
                    position: toolsStyle.position,
                    bottom: toolsStyle.bottom,
                    maxHeight: toolsStyle.maxHeight,
                    overflowY: toolsStyle.overflowY,
                    height: toolsEl.offsetHeight
                });
            }
            
            updateDebugInfo();
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—É—Å–µ–ª—å
        setTimeout(() => {
            console.log('üöÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Ä—É—Å–µ–ª—å...');
            testCarousel();
        }, 1000);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞
        window.addEventListener('resize', updateDebugInfo);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
        setInterval(updateDebugInfo, 2000);
        
        // –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
        updateDebugInfo();
        
        console.log(`
üì± TELEGRAM MINI APP LAYOUT TEST

–ü—Ä–æ–≤–µ—Ä—è–µ–º:
‚úÖ height: 100vh, max-height: 100vh, overflow: hidden –Ω–∞ root
‚úÖ Sticky –ø–∞–Ω–µ–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å max-height: 40vh
‚úÖ –ù–∏–∫–∞–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –≤—ã—Ö–æ–¥—è—Ç –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã —ç–∫—Ä–∞–Ω–∞
‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ viewport Mini App

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –≤–Ω–∏–∑—É –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!
        `);
        
        console.log('‚úÖ Mini App layout test –≥–æ—Ç–æ–≤');
    </script>
</body>
</html>