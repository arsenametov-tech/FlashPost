# –ê–ù–ê–õ–ò–ó –°–ö–†–´–¢–´–• –ë–ê–ì–û–í –ú–ï–ñ–î–£ CORE –ú–û–î–£–õ–Ø–ú–ò

## –û–ë–ù–ê–†–£–ñ–ï–ù–ù–´–ï –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 1. üö® –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï –ú–ï–¢–û–î–û–í –ò –ö–û–ù–§–õ–ò–ö–¢–´ –û–¢–í–ï–¢–°–¢–í–ï–ù–ù–û–°–¢–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: Renderer —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- `renderer.js` —Å–æ–¥–µ—Ä–∂–∏—Ç –º–µ—Ç–æ–¥—ã `handleToolbarAction()`, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ `editor.js`
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –≤ –∫–æ–¥–µ: "‚ö†Ô∏è handleToolbarAction –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –∏–∑ Editor, –∞ –Ω–µ Renderer"
- –≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

#### –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM
- `state.js` —Å–æ–¥–µ—Ä–∂–∏—Ç `updateElementFromState()` –∏ `triggerLivePreviewUpdate()`
- `renderer.js` —Å–æ–¥–µ—Ä–∂–∏—Ç `updateTextBlockStyles()` –∏ `updateTextBlockContent()`
- –î–≤–∞ —Ä–∞–∑–Ω—ã—Ö –ø—É—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM –º–æ–≥—É—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å

### 2. üö® –¶–ò–ö–õ–ò–ß–ï–°–ö–ò–ï –ó–ê–í–ò–°–ò–ú–û–°–¢–ò –ò –ù–ï–û–ü–†–ï–î–ï–õ–ï–ù–ù–´–ï –°–°–´–õ–ö–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: Editor —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –Ω–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π Renderer
```javascript
// –í editor.js:
this.renderer.updateTextBlockStyles(activeBlock.id);  // renderer –º–æ–∂–µ—Ç –±—ã—Ç—å undefined
this.renderer.setTextWithKeywords(blockEl, block.text, slide?.autoKeywords || []);
```

#### –ü—Ä–æ–±–ª–µ–º–∞: State —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã–π window.renderer
```javascript
// –í state.js:
if (window.renderer && window.renderer.setTextWithKeywords) {
    window.renderer.setTextWithKeywords(blockEl, block.text, slide?.autoKeywords || []);
}
```

### 3. üö® –°–û–°–¢–û–Ø–ù–ò–ï –ì–û–ù–ö–ò (RACE CONDITIONS)

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è DOM
- `state.updateTextBlockProperty()` –≤—ã–∑—ã–≤–∞–µ—Ç `triggerLivePreviewUpdate()`
- `editor.updateActiveTextBlockFont()` –≤—ã–∑—ã–≤–∞–µ—Ç `state.updateTextBlockProperty()` 
- `renderer.updateTextBlockStyles()` –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–∑–≤–∞–Ω –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ DOM –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

#### –ü—Ä–æ–±–ª–µ–º–∞: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```javascript
// –í state.js:
async setMode(newMode) {
    // –ò–∑–º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    this.project.mode = newMode;
    // –ñ–¥–µ—Ç DOM –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    if (newMode === 'export') {
        await this.nextTick();
    }
}
```
–ù–æ –¥—Ä—É–≥–∏–µ –º–æ–¥—É–ª–∏ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å DOM –≤ —ç—Ç–æ –≤—Ä–µ–º—è.

### 4. üö® –£–¢–ï–ß–ö–ò –ü–ê–ú–Ø–¢–ò –ò –ù–ï–û–ß–ò–©–ï–ù–ù–´–ï –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò

#### –ü—Ä–æ–±–ª–µ–º–∞: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –Ω–µ –æ—á–∏—â–∞—é—Ç—Å—è
```javascript
// –í editor.js:
bindTextBlockEvents() {
    textBlocks.forEach(blockEl => {
        blockEl.addEventListener('click', (e) => {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è, –Ω–æ –Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–µ
        });
    });
}
```

#### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∏–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç–æ–≤ –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è
```javascript
// –í renderer.js:
applyTextBlockEffects() {
    const styleElement = document.createElement('style');
    styleElement.id = `block-effects-${blockId}`;
    document.head.appendChild(styleElement);
    // –°—Ç–∞—Ä—ã–µ —Å—Ç–∏–ª–∏ —É–¥–∞–ª—è—é—Ç—Å—è, –Ω–æ –º–æ–≥—É—Ç –æ—Å—Ç–∞—Ç—å—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
}
```

### 5. üö® –ù–ï–°–û–ì–õ–ê–°–û–í–ê–ù–ù–û–°–¢–¨ –°–û–°–¢–û–Ø–ù–ò–Ø

#### –ü—Ä–æ–±–ª–µ–º–∞: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞
- `state.project.activeTextBlockId` - –≤ StateManager
- DOM –∫–ª–∞—Å—Å `.text-block-selected` - –≤ Renderer
- `block.isEditing` - –≤ –¥–∞–Ω–Ω—ã—Ö –±–ª–æ–∫–∞
- –≠—Ç–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–≥—É—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è

#### –ü—Ä–æ–±–ª–µ–º–∞: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤ –±–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
```javascript
// –í editor.js:
updateControlValue(controlId, value) {
    // –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    Object.keys(handlers).forEach(event => {
        control.removeEventListener(event, handlers[event]);
    });
    // –ù–æ –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—à–∏–±–∫–∞, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è
}
```

### 6. üö® –ü–†–û–ë–õ–ï–ú–´ –° –§–û–ö–£–°–û–ú –ò –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï–ú

#### –ü—Ä–æ–±–ª–µ–º–∞: –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –∂–∏–≤—ã–º –ø—Ä–µ–≤—å—é –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
```javascript
// –í editor.js:
bindInlineEditingEventsWithLivePreview() {
    const handleInput = (e) => {
        const newText = blockEl.textContent || blockEl.innerText;
        // –û–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —á—Ç–æ –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä
        this.state.updateTextBlockProperty(blockId, 'text', newText);
    };
}
```
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–∂–µ—Ç –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç –∏ –ø–æ—Ç–µ—Ä—è—Ç—å —Ñ–æ–∫—É—Å.

#### –ü—Ä–æ–±–ª–µ–º–∞: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞ –º–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è
```javascript
// –í renderer.js:
restoreSelection(element, savedSelection) {
    // –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞
    // –ú–æ–∂–µ—Ç —Å–ª–æ–º–∞—Ç—å—Å—è –µ—Å–ª–∏ DOM –∏–∑–º–µ–Ω–∏–ª—Å—è –º–µ–∂–¥—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ–º
}
```

### 7. üö® –û–®–ò–ë–ö–ò –í –ö–û–î–ï

#### –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –≤ state.js
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ "';' expected" –∏–∑-–∑–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ–¥–∞
- –ù–µ–¥–æ—Å—Ç–∏–∂–∏–º—ã–π –∫–æ–¥ –ø–æ—Å–ª–µ —ç–∫—Å–ø–æ—Ä—Ç–∞ –º–æ–¥—É–ª—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–µ–≥–æ `substr()` –≤–º–µ—Å—Ç–æ `substring()`

#### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```javascript
// –í editor.js:
updateInputCounter() {
    const length = topicInput.value.lengt  // –û–ø–µ—á–∞—Ç–∫–∞: lengt –≤–º–µ—Å—Ç–æ length
}
```

## –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Æ

### 1. –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- State: –¢–û–õ–¨–ö–û —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏
- Editor: –¢–û–õ–¨–ö–û –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π  
- Renderer: –¢–û–õ–¨–ö–û —Å–æ–∑–¥–∞–Ω–∏–µ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ DOM

### 2. –ï–¥–∏–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–¥—É—Ç —á–µ—Ä–µ–∑ State
- State —É–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- Renderer –æ–±–Ω–æ–≤–ª—è–µ—Ç DOM —Ç–æ–ª—å–∫–æ –ø–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –ü–µ—Ä–µ–¥–∞–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä
- –ò–∑–±–µ–≥–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å—Å—ã–ª–æ–∫ —á–µ—Ä–µ–∑ window

### 4. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—á–µ—Ä–µ–¥—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –ë–∞—Ç—á–∏–Ω–≥ –∏–∑–º–µ–Ω–µ–Ω–∏–π DOM
- –î–µ–±–∞—É–Ω—Å–∏–Ω–≥ —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 5. –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
- –£–¥–∞–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –ø—Ä–∏ –ø–µ—Ä–µ—Ä–µ–Ω–¥–µ—Ä–µ
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∏–ª–µ–π –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- Try-catch –±–ª–æ–∫–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π