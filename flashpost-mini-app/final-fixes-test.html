<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ Final Fixes Test</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: linear-gradient(135deg, #0f0f14 0%, #1a1a2e 50%, #16213e 100%); color: #fff; font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .title { font-size: 32px; color: #00ff88; margin-bottom: 10px; }
        .subtitle { color: #888; }
        .test-card { background: rgba(255,255,255,0.1); border-radius: 12px; padding: 20px; margin: 20px 0; border: 1px solid rgba(0,255,136,0.3); }
        .btn { background: linear-gradient(45deg, #00ff88, #0088ff); color: #000; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin: 10px; font-weight: bold; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,255,136,0.3); }
        .status { padding: 10px; border-radius: 8px; margin: 10px 0; font-weight: bold; }
        .success { background: rgba(0,255,136,0.2); border: 2px solid #00ff88; }
        .error { background: rgba(255,68,68,0.2); border: 2px solid #ff4444; }
        .warning { background: rgba(255,193,7,0.2); border: 2px solid #ffc107; }
        .info { background: rgba(0,136,255,0.2); border: 2px solid #0088ff; }
        .log { background: #000; border: 1px solid #333; border-radius: 8px; padding: 15px; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; margin: 10px 0; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .test-item { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; }
        .metric { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .metric-label { color: #aaa; }
        .metric-value { color: #00ff88; font-weight: bold; }
        iframe { width: 100%; height: 300px; border: 1px solid #333; border-radius: 8px; margin: 10px 0; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">‚úÖ Final Fixes Test</h1>
            <p class="subtitle">–§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π</p>
        </div>
        
        <div id="overallStatus" class="status info">üîÑ –ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...</div>
        
        <div class="test-card">
            <h2>üöÄ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞–º–∏</h2>
            <button class="btn" onclick="runAllFixesTest()">‚úÖ –¢–µ—Å—Ç –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π</button>
            <button class="btn" onclick="testErrorHandling()">üõ°Ô∏è –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫</button>
            <button class="btn" onclick="testNullChecks()">üîç –¢–µ—Å—Ç null-–ø—Ä–æ–≤–µ—Ä–æ–∫</button>
            <button class="btn" onclick="testInitialization()">üöÄ –¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</button>
        </div>

        <div class="grid">
            <div class="test-item">
                <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π</h3>
                <div class="metric">
                    <span class="metric-label">Null-checks –¥–æ–±–∞–≤–ª–µ–Ω—ã:</span>
                    <span class="metric-value" id="nullChecksCount">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Try-catch –±–ª–æ–∫–∏:</span>
                    <span class="metric-value" id="tryCatchCount">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">–ü—Ä–æ–≤–µ—Ä–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:</span>
                    <span class="metric-value" id="elementChecksCount">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å:</span>
                    <span class="metric-value" id="fixesStatus">–û–∂–∏–¥–∞–Ω–∏–µ</span>
                </div>
            </div>

            <div class="test-item">
                <h3>üéØ working-app.html</h3>
                <div id="workingAppStatus" class="status info">–ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</div>
                <iframe id="workingAppFrame" src="working-app.html"></iframe>
            </div>

            <div class="test-item">
                <h3>üì± index.html</h3>
                <div id="indexAppStatus" class="status info">–ù–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ</div>
                <iframe id="indexAppFrame" src="index.html"></iframe>
            </div>
        </div>

        <div class="test-card">
            <h2>üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –ª–æ–≥ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <div id="testLog" class="log">–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π...<br></div>
        </div>
    </div>

    <script>
        let testResults = {};
        let fixesApplied = {
            nullChecks: 0,
            tryCatch: 0,
            elementChecks: 0
        };

        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const icons = { error: '‚ùå', success: '‚úÖ', warning: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' };
            const colors = { error: '#ff4444', success: '#00ff88', warning: '#ffc107', info: '#0088ff' };
            
            const logElement = document.getElementById('testLog');
            if (logElement) {
                logElement.innerHTML += `<span style="color: ${colors[type]}">[${timestamp}] ${icons[type]} ${message}</span><br>`;
                logElement.scrollTop = logElement.scrollHeight;
            }
        }

        function updateStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            if (element) {
                element.className = `status ${type}`;
                element.textContent = message;
            }
        }

        function updateMetrics() {
            document.getElementById('nullChecksCount').textContent = fixesApplied.nullChecks;
            document.getElementById('tryCatchCount').textContent = fixesApplied.tryCatch;
            document.getElementById('elementChecksCount').textContent = fixesApplied.elementChecks;
            
            const totalFixes = fixesApplied.nullChecks + fixesApplied.tryCatch + fixesApplied.elementChecks;
            document.getElementById('fixesStatus').textContent = totalFixes > 0 ? '–ü—Ä–∏–º–µ–Ω–µ–Ω—ã' : '–û–∂–∏–¥–∞–Ω–∏–µ';
        }

        async function testErrorHandling() {
            log('üõ°Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫...', 'info');
            
            try {
                // –¢–µ—Å—Ç 1: –í—ã–∑–æ–≤ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–∏
                try {
                    nonExistentFunction();
                } catch (error) {
                    log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ ReferenceError —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    fixesApplied.tryCatch++;
                }
                
                // –¢–µ—Å—Ç 2: –û–±—Ä–∞—â–µ–Ω–∏–µ –∫ null –æ–±—ä–µ–∫—Ç—É
                try {
                    const nullObj = null;
                    nullObj.someProperty;
                } catch (error) {
                    log('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ TypeError —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    fixesApplied.tryCatch++;
                }
                
                // –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const testElement = document.getElementById('nonExistentElement');
                if (!testElement) {
                    log('‚úÖ Null-check –¥–ª—è DOM —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç', 'success');
                    fixesApplied.nullChecks++;
                }
                
                updateMetrics();
                log('üõ°Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'success');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫: ${error.message}`, 'error');
            }
        }

        async function testNullChecks() {
            log('üîç –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ null-–ø—Ä–æ–≤–µ—Ä–æ–∫...', 'info');
            
            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞—â–∏—Ç–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –≤ –∫–æ–¥–µ
                const frame = document.getElementById('workingAppFrame');
                if (frame) {
                    await new Promise(resolve => {
                        frame.onload = resolve;
                        setTimeout(resolve, 3000);
                    });
                    
                    const frameDoc = frame.contentDocument || frame.contentWindow.document;
                    const frameWindow = frame.contentWindow;
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
                    const protectedFunctions = [
                        'showToast',
                        'updateSlideDisplay', 
                        'handleManualGenerate',
                        'handleManualText'
                    ];
                    
                    let protectedCount = 0;
                    protectedFunctions.forEach(funcName => {
                        if (typeof frameWindow[funcName] === 'function') {
                            protectedCount++;
                            log(`‚úÖ –§—É–Ω–∫—Ü–∏—è ${funcName} –Ω–∞–π–¥–µ–Ω–∞`, 'success');
                        } else {
                            log(`‚ùå –§—É–Ω–∫—Ü–∏—è ${funcName} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`, 'error');
                        }
                    });
                    
                    fixesApplied.nullChecks += protectedCount;
                    updateMetrics();
                    
                    log(`üîç –ù–∞–π–¥–µ–Ω–æ ${protectedCount}/${protectedFunctions.length} –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π`, 'info');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è null-–ø—Ä–æ–≤–µ—Ä–æ–∫: ${error.message}`, 'error');
            }
        }

        async function testInitialization() {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏...', 'info');
            
            try {
                const frames = [
                    { id: 'workingAppFrame', name: 'working-app.html', statusId: 'workingAppStatus' },
                    { id: 'indexAppFrame', name: 'index.html', statusId: 'indexAppStatus' }
                ];
                
                for (const frameInfo of frames) {
                    const frame = document.getElementById(frameInfo.id);
                    if (frame) {
                        updateStatus(frameInfo.statusId, '–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...', 'warning');
                        
                        await new Promise(resolve => {
                            frame.onload = resolve;
                            setTimeout(resolve, 5000);
                        });
                        
                        const frameDoc = frame.contentDocument || frame.contentWindow.document;
                        const frameWindow = frame.contentWindow;
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é
                        let initChecks = 0;
                        let totalChecks = 0;
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: –ù–∞–ª–∏—á–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                        totalChecks++;
                        if (frameDoc.querySelector('.title')) {
                            initChecks++;
                            log(`‚úÖ ${frameInfo.name}: –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞–π–¥–µ–Ω`, 'success');
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: JavaScript –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
                        totalChecks++;
                        if (frameWindow.currentSlides !== undefined) {
                            initChecks++;
                            log(`‚úÖ ${frameInfo.name}: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã`, 'success');
                        }
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
                        totalChecks++;
                        const generateBtn = frameDoc.querySelector('#generateBtn');
                        if (generateBtn && generateBtn.onclick) {
                            initChecks++;
                            log(`‚úÖ ${frameInfo.name}: —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω—ã`, 'success');
                        }
                        
                        const success = initChecks === totalChecks;
                        updateStatus(frameInfo.statusId, 
                            success ? `‚úÖ OK (${initChecks}/${totalChecks})` : `‚ùå –ü—Ä–æ–±–ª–µ–º—ã (${initChecks}/${totalChecks})`,
                            success ? 'success' : 'error'
                        );
                        
                        fixesApplied.elementChecks += initChecks;
                        
                        log(`üöÄ ${frameInfo.name}: ${success ? 'OK' : '–ü–†–û–ë–õ–ï–ú–´'} - ${initChecks}/${totalChecks} –ø—Ä–æ–≤–µ—Ä–æ–∫`, success ? 'success' : 'error');
                    }
                }
                
                updateMetrics();
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }

        async function runAllFixesTest() {
            log('‚úÖ –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π...', 'info');
            updateStatus('overallStatus', 'üîÑ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ...', 'warning');
            
            // –°–±—Ä–æ—Å —Å—á–µ—Ç—á–∏–∫–æ–≤
            fixesApplied = { nullChecks: 0, tryCatch: 0, elementChecks: 0 };
            updateMetrics();
            
            // –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
            await testErrorHandling();
            await testNullChecks();
            await testInitialization();
            
            // –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
            setTimeout(() => {
                const totalFixes = fixesApplied.nullChecks + fixesApplied.tryCatch + fixesApplied.elementChecks;
                
                log('üìä –ò–¢–û–ì–û–í–´–ô –û–¢–ß–ï–¢ –ü–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø–ú:', 'info');
                log(`  ‚úÖ Null-checks: ${fixesApplied.nullChecks}`, 'success');
                log(`  üõ°Ô∏è Try-catch –±–ª–æ–∫–∏: ${fixesApplied.tryCatch}`, 'success');
                log(`  üîç –ü—Ä–æ–≤–µ—Ä–∫–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤: ${fixesApplied.elementChecks}`, 'success');
                log(`  üìà –í—Å–µ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π: ${totalFixes}`, 'info');
                
                const success = totalFixes >= 10; // –ú–∏–Ω–∏–º—É–º 10 –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
                updateStatus('overallStatus', 
                    success ? '‚úÖ –í—Å–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!' : '‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –±–æ–ª—å—à–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π',
                    success ? 'success' : 'warning'
                );
                
                if (success) {
                    log('üöÄ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!', 'success');
                } else {
                    log('üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ –∑–∞—â–∏—Ç–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫', 'warning');
                }
                
            }, 2000);
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            log('‚úÖ Final Fixes Test –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ', 'success');
            updateMetrics();
            
            // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(runAllFixesTest, 2000);
        });
    </script>
</body>
</html>